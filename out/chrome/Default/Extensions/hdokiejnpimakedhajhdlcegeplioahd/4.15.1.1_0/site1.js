var data=null,existing=null,origusername=null,origpassword=null,attachnum=0,attaches=[],removedattach=[],g_eye_show=!0,g_eyeimgid=null,g_start_time=null,POLL_MAXTIME=3e5,g_pwlen=0,pass=!0,g_sharedfromaid=!1,g_pw_field_ids=[],ENABLE_ONLY=!0,g_do_keyaccel=!0,KEY_S=83,event_handlers={};function fix_event_handlers(){for(var e in lpdbg("site","fixing event handlers"),event_handlers){lpdbg("site","setting event handler for "+e);var t=document.getElementById("fields").contentWindow.document.getElementById(e);t?(t.onclick=event_handlers[e],lpdbg("site","set event handler for "+e)):lpdbg("site","could not find "+e)}}function onLoad(e){if(clearData(),e){var t,a=getBG();if(a.g_site_data&&(t=a.g_site_data.aid),void 0===t)data=a.g_site_data;else{data=a.g_site_data;var n=!1;void 0!==a.g_site_data.save_all&&1==a.g_site_data.save_all&&(n=!0);var d=get_record(t);for(var i in d)data[i]=d[i]}if(a.g_generatedpw&&(document.getElementById("pwprotect").style.visibility="hidden",document.getElementById("pwprotectlabel").style.visibility="hidden"),(existing=data&&void 0!==get_record_id(data)&&get_record_id(data)&&""!=get_record_id(data)&&"0"!=get_record_id(data))&&!a.LPISLOC&&a.g_showhistorylinks&&(document.getElementById("usernamehistory").style.display="inline",document.getElementById("passwordhistory").style.display="inline"),data){var l=issharedfolder(a.g_shares,data.group),s=0==l?a.g_local_key:l.sharekey;"http://sn"==data.url&&a.loglogin(get_record_id(data));var r=!1;if(is_application(data)){document.getElementById("usernamehistory").style.display="none",document.getElementById("passwordhistory").style.display="none",set_innertext(document.getElementById("urltext"),gs("Application:")),document.getElementById("url").value=data.appname;var o=0,c=0;for(var p in data.fields)if(data.fields.hasOwnProperty(p))if(""==data.fields[p].type){if(++o>1)break}else if("password"==data.fields[p].type&&++c>1)break;1==o&&1==c||(r=!0)}else{var g=AES._utf8_decode(data.url);!existing&&g.indexOf("homelocal")>=0||(document.getElementById("url").value=g)}if(event_handlers={},data.editfields)document.title=is_application(data)?gs("Edit Application Fields"):gs("Edit Site Fields"),document.getElementById("siteactions").style.display="none",document.getElementById("urlrow").style.display="none",document.getElementById("namegrouprow").style.display="none",document.getElementById("usernamepasswordrow").style.display="none",document.getElementById("notesrow1").style.display="none",document.getElementById("notesrow2").style.display="none",document.getElementById("advsettingswrap").style.display="none",document.getElementById("cpwfieldbtn").style.display="none",document.getElementById("fieldsrow2").style.display="block",document.getElementById("fields").contentWindow.document.body.appendChild(getFieldsHTMLNodes(s));else if(data.save_all||r)document.getElementById("usernamepasswordrow").style.display="none",document.getElementById("fieldsrow1").style.display="block",document.getElementById("fieldsrow2").style.display="block",existing?(document.title=is_application(data)?gs("Edit Application"):gs("Edit Site"),document.getElementById("fields").contentWindow.document.body.appendChild(getFieldsHTMLNodes(s))):(document.title=gs("Add Site"),document.getElementById("fields").contentWindow.document.body.appendChild(getDataHTML()));else if(data.sn)document.title=existing?gs("Edit Secure Note"):gs("Add Secure Note"),document.getElementById("usernamepasswordrow").style.display="none",document.getElementById("urlrow").style.display="none",document.getElementById("addrow").style.display="block",showadvpane();else if(existing){if(is_application(data))document.title=gs("Edit Application"),document.getElementById("username").value=getusernamefromacct(data),document.getElementById("password").value=getpasswordfromacct(data),origusername=a.lpmenc(document.getElementById("username").value,!0,s),origpassword=a.lpmenc(document.getElementById("password").value,!0,s);else{document.title=gs("Edit Site"),document.getElementById("username").value=data.unencryptedUsername;var m=a.lpmdec(data.password,!0,s);g_pwlen=m?m.length:-1,g_pwlen=""==data.password?0:g_pwlen,document.getElementById("password").value=m,origusername=data.username,origpassword=data.password}document.getElementById("editfields").style.display="inline"}else document.title=gs("Add Site"),document.getElementById("username").value=data.username,document.getElementById("password").value=data.password,disable_CPWButton();if(fix_event_handlers(),document.getElementById("exnotehist").style.display=existing?"block":"none",existing||void 0===data.addsite||-1!=AES._utf8_decode(data.url).indexOf("homelocal")||(document.getElementById("group").value=get_default_group(data.url),document.getElementById("name").value=a.getname_url(data.url)),existing){document.getElementById("name").value=data.name,document.getElementById("group").value=data.group;var u=a.lpmdec(data.extra,!0,s);document.getElementById("notes").value=u,document.getElementById("fav").checked="1"==data.fav,document.getElementById("pwprotect").checked=data.pwprotect,document.getElementById("autologin").checked=data.autologin&&"0"!=data.autologin,is_application(data)?document.getElementById("never_autofill_td").style.visibility="hidden":document.getElementById("never_autofill").checked=data.never_autofill}else data.sn&&(document.getElementById("group").value=gs("Secure Notes"));1==data.sn&&(document.getElementById("favcheck").style.display="none",document.getElementById("never_autofill_td").style.display="none",document.getElementById("autologingrp").style.visibility="hidden")}if(existing&&!data.editfields){document.getElementById("del").style.display="inline-block";var _=get_record(get_record_id(data));document.getElementById("share").style.display=a.LPISLOC||_.genpw||void 0!==_.sharedfromaid&&null!=_.sharedfromaid&&""!=_.sharedfromaid&&"0"!=_.sharedfromaid&&"null"!=_.sharedfromaid||void 0!==_.sharefolderid||is_application(_)||!a.g_sharing_enabled?"none":"inline-block"}else document.getElementById("del").style.display="none",document.getElementById("share").style.display="none";var h=new Array;for(t in a.g_sites){if(a.check_ident_aid(t))""==(y=a.g_sites[t].group)||lp_in_array(y,h)||(h[h.length]=y)}for(t in a.g_securenotes){if(a.check_ident_aid(t))""==(y=a.g_securenotes[t].group)||lp_in_array(y,h)||(h[h.length]=y)}for(t in a.g_applications){var y;if(a.check_ident_appaid(t))""==(y=a.g_applications[t].group)||lp_in_array(y,h)||(h[h.length]=y)}if(h.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}),existing||(""==document.getElementById("url").value?document.getElementById("url").focus():document.getElementById("name").focus()),!existing&&data&&!data.save_all&&!data.noreplace){var f=a.getsites(lp_gettld_url(data.url),!0),v=new Array;for(var p in f)v[v.length]=p;v.sort(function(e,t){return a.g_sites[e].name.toLowerCase()<a.g_sites[t].name.toLowerCase()?-1:1});var w=document.getElementById("replaceexistingsiteaid");for(p=0;p<v.length;p++){var E=a.g_sites[v[p]].name;a.g_sites[v[p]].useusername,""!=a.g_sites[v[p]].useusername&&(E+=" ("+a.g_sites[v[p]].useusername+")"),w.options[w.options.length]=new Option(E,v[p])}if(w.options.length>1)for(p=1;p<=4;p++)document.getElementById("addreplacerow"+p).style.display="block"}for(var i in LP_decimate_children(document.getElementById("metercontainer")),document.getElementById("metercontainer").appendChild(ghetto_meter(280,!0,document)),stylize_ghetto_meter(document,280),update_password_meter("",document.getElementById("password").value),data&&data.last_pwchange_gmt&&pw_age_update(data.last_pwchange_gmt),show_cpw_button(data),my_aid=get_record_id(data),buildSecureNotes(existing),onResize(),create_combo("group",h,!0,document,"","group",-22,5),setup_eye_events(document),(getBG().g_is_win||getBG().g_is_mac||getBG().g_is_linux)&&setTimeout(function(){decryptThumbnails(s)},0),document.getElementById("advsettings").addEventListener("click",showadvpane),document.getElementById("lp_docwrite_site14a").addEventListener("click",showadvpane),document.getElementById("fav").addEventListener("change",echoFavorite),echoFavorite(),null!==document.getElementById("name")&&null!==document.getElementById("notestype")&&(document.getElementById("name").addEventListener("keyup",function(){setTimeout(updateFormHeading,100)}),updateFormHeading()),data&&data.openchpw&&show_cpw_dialog("new"),data=a.g_site_data,a.g_site_data)data[i]=a.g_site_data[i];n&&(data.save_all=!0),a.g_site_data=null}else get_data("site",function(){onLoad(!0)})}function updateFormHeading(){""!=document.getElementById("notestype").value?set_innertext(document.getElementById("dynheader"),document.getElementById("name").value+" - "+document.getElementById("notestype").value+(1==data.sn?" "+gs("Secure Note"):"")):(document.getElementById("dynheader").style.display="none",document.getElementById("dynbody").style.backgroundColor="transparent")}function showadvpane(){var e=document.getElementById("advsettings"),t=document.getElementById("checkboxrow1");e.classList.toggle("turn90"),t.classList.toggle("displaynone")}function echoFavorite(){document.getElementById("fav").checked?(document.getElementById("echo_favorite").src="images/favorite.png",set_innertext(document.getElementById("lp_docwrite_site15"),gs("Remove Favorite")),set_innertext(document.getElementById("lp_docwrite_site34"),gs("Remove Site from Favorites"))):(document.getElementById("echo_favorite").src="images/not_favorite.png",set_innertext(document.getElementById("lp_docwrite_site15"),gs("Make Favorite")),set_innertext(document.getElementById("lp_docwrite_site34"),gs("Add Site to Favorites")))}function decryptThumbnails(e){if(void 0!==data&&null!==data&&1==data.sn&&(document.getElementById("lpaddattach").style.display="block",void 0!==data.attachpresent&&"1"==data.attachpresent)){getBG();for(var t in num_attachments=data.attaches.length,data.attaches)data.attaches.hasOwnProperty(t)&&(addThumbnail(data.attaches[t].id,data.attaches[t].mimetype,data.attaches[t].bytes,data.attaches[t].filename,data.attachkey,e),num_attachments--)}}function buildSecureNotes(e){if(0==issharedfolder(getBG().g_shares,data.group).give&&(g_sharedfromaid=1),void 0!==data&&null!==data&&void 0!==data.sn&&1==data.sn){document.getElementById("notesrow0").style.display="block",document.getElementById("notesrow1").style.display="none",document.getElementById("notehistory").style.display=e?"inline-block":"none",document.getElementById("group").style.width="auto",document.getElementById("group").spellcheck=!1;var t=document.getElementById("notestype").val,a=[];for(var n in sntemplates){var d=void 0!==sntemplateicons[n]?sntemplateicons[n]:geticonurl("sn");a[a.length]={label:gs(n),image:d,value:n}}e||(create_combo("notestype",a,!0,document,"","notestype",-22,5),document.getElementById("notestype").addEventListener("click",function(){openCombo(null,"notestype","notestype_combo",document)})),e&&(t=getNoteValue("NoteType",document.getElementById("notes").value)),t&&void 0!==sntemplates[t]||(t="Generic"),init_attachment_action_menu(),document.getElementById("autologingrp").setAttribute("colspan","0");var i=document.getElementById("pwaginggrp");null!=i&&i.setAttribute("colspan","2"),buildForm(t),onResize()}else document.getElementById("attachtabletr").style.width="0px"}function disable_CPWButton(){document.getElementById("cpwbtnmini").classList.add("btn_disabled"),document.getElementById("cpwfieldbtn")&&document.getElementById("cpwfieldbtn").classList.add("btn_disabled")}function disable_SaveButton(){document.getElementById("save").classList.add("btn_disabled")}function enable_SaveButton(){document.getElementById("save").classList.remove("btn_disabled")}function update_SaveButton(e){var t=document,a=t.getElementById("save");t&&a&&(check_for_changes()?a.className.indexOf("btn_disabled")>=0&&enable_SaveButton():e!=ENABLE_ONLY&&-1==a.className.indexOf("btn_disabled")&&disable_SaveButton())}function buildForm(e){var t=document.getElementById("notestype");t.value=gs(e),t.val=e;var a=void 0!==sntemplateicons[e]?sntemplateicons[e]:geticonurl("sn");if(t.style.background="url("+a+") no-repeat 2px 2px"+(existing?" rgb(238,238,238)":" rgb(249,249,249)"),document.getElementById("notesrow2").style.display="Generic"==e?"block":"none",document.getElementById("notesrow3").style.display="Generic"==e?"none":"block",document.getElementById("notestype").disabled=!!existing,"Generic"!=e){for(var n=document.getElementById("dynamicnotes");n.hasChildNodes()&&n.childNodes.length>0;)n.removeChild(n.firstChild);var d=sntemplates[e],i=document.createElement("table");for(var l in i.style.width="100%",i.style.borderSpacing="0px",d){var s=document.createElement("tr"),r=document.createElement("td");r.style.whiteSpace="nowrap";var o=document.createElement("td");o.style.width="100%";var c=document.createTextNode(gsproper(l)+":");r.appendChild(c);var p=null,g=null;if("text"==d[l]){if((p=document.createElement("input")).type="text",p.spellcheck=!1,p.id="note_"+l,p.style.width="100%",p.style.fontFamily="Courier",existing&&(p.value=getNoteValue(l,document.getElementById("notes").value),"Private Key"==l)){g=document.createElement("a");set_innertext(g," Copy Key"),g.style.textDecoration="none",g.style.cursor="pointer",g.style.height="15px",g.style.align="right",-1==p.value.indexOf("-----BEGIN")&&-1==p.value.indexOf("END-----")?g.onclick=function(){var e=document.getElementById("note_Private Key").value;getBG().copytoclipboard(e)}:g.onclick=function(){var e=document.getElementById("note_Private Key");pkelparse=e.value.split(/-----BEGIN.*KEY----- | -----END.*KEY-----/),pkelarmor=e.value.split(/-----/);var t="";for(var a in pkelparse[1])":"!=pkelparse[1].charAt(a-1)?t+=pkelparse[1][a].replace(/\u0020/g,"\n"):t+=pkelparse[1][a];return pktotal="-----"+pkelarmor[1]+"-----\n"+t+"\n-----"+pkelarmor[3]+"-----",getBG().copytoclipboard(pktotal),!1}}if("Password"==l)p.type="password",(g=document.createElement("img")).id="note_eye_img",g.src="images/eye-shown.png",g.style.textDecoration="none",g.style.position="relative",g.style.top="6px",g.style.left="-22px",g.onclick=function(){if(g_sharedfromaid)return alert(gs("This is a shared site. You are not permitted to view the password.")),!1;var e=document.getElementById("note_Password");-1!==document.getElementById("note_eye_img").src.indexOf("images/eye-shown.png")?document.getElementById("note_eye_img").src="images/eye-hidden.png":document.getElementById("note_eye_img").src="images/eye-shown.png";var t=e.type;e.type="password"==t?"text":"password"}}else if("date"==d[l]||"datemoyr"==d[l]){(p=document.createElement("span")).style.width="100%";var m=document.createElement("select");m.id="note_"+l+"_mo",m.style.width="auto";var u=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var _ in u)m.options[m.options.length]=new Option(gs(u[_]),u[_]);var h=null;if(existing&&((h=getNoteValue(l,document.getElementById("notes").value))&&(h=h.split(",")),h&&h.length>0))for(var y in u)if(u[y]==h[0]||gs(u[y])==h[0]){m.value=u[y];break}if(p.appendChild(m),"date"==d[l]){var f=document.createElement("select");f.id="note_"+l+"_day";for(_=1;_<=31;_++)f.options[f.options.length]=new Option(_,_);h&&h.length>1&&(f.value=h[1]),p.appendChild(f)}var v=document.createElement("input");v.type="text",v.maxLength=4,v.size=4,v.spellcheck=!1,v.id="note_"+l+"_yr";var w="date"==d[l]?2:1;h&&h.length>w&&(v.value=h[w]),p.appendChild(v)}else{if("textarea"!=d[l])continue;r.style.verticalAlign="top",(p=document.createElement("textarea")).cols=30,p.spellcheck=!1,p.rows=7,p.id="note_"+l,p.style.width="100%",p.style.fontFamily="Courier",existing&&(p.value=getNoteValue(l,document.getElementById("notes").value,!0))}o.appendChild(p),null!==g&&o.appendChild(g),s.appendChild(r),s.appendChild(o),i.appendChild(s)}var E=document.createElement("fieldset");E.appendChild(i),n.appendChild(E),updateFormHeading()}}function onResize(){}function fix_addreplace(){document.getElementById("addnewsite").checked?(document.getElementById("url").disabled=!1,document.getElementById("name").disabled=!1,document.getElementById("group").disabled=!1,document.getElementById("username").disabled=!1,document.getElementById("password").disabled=!1,document.getElementById("notes").disabled=!1,document.getElementById("fav").disabled=!1,document.getElementById("never_autofill").disabled=!1,document.getElementById("pwprotect").disabled=!1,document.getElementById("autologin").disabled=!1,document.getElementById("replaceexistingsiteaid").disabled=!0):document.getElementById("replaceexistingsite").checked&&(document.getElementById("url").disabled=!0,document.getElementById("name").disabled=!0,document.getElementById("group").disabled=!0,document.getElementById("username").disabled=!0,document.getElementById("password").disabled=!0,document.getElementById("notes").disabled=!0,document.getElementById("fav").disabled=!0,document.getElementById("never_autofill").disabled=!0,document.getElementById("pwprotect").disabled=!0,document.getElementById("autologin").disabled=!0,document.getElementById("replaceexistingsiteaid").disabled=!1)}function getSecureNoteFromFields(){if(void 0!==data&&data&&1==data.sn){var e=document.getElementById("notestype").val;if("Generic"==e||"none"==document.getElementById("notesrow0").style.display)return document.getElementById("notes").value;var t="NoteType:"+e+"\n";for(var a in sntemplates[e])"text"==sntemplates[e][a]?t+=a+":"+document.getElementById("note_"+a).value+"\n":"date"==sntemplates[e][a]||"datemoyr"==sntemplates[e][a]?(t+=a+":"+document.getElementById("note_"+a+"_mo").value,"date"==sntemplates[e][a]&&(t+=","+document.getElementById("note_"+a+"_day").value),t+=","+document.getElementById("note_"+a+"_yr").value+"\n"):"textarea"==sntemplates[e][a]&&(t+=a+":"+document.getElementById("note_"+a).value+"\n");return t}return document.getElementById("notes").value}function get_decrypted_attachdata(e){for(var t in g_encatt)if(void 0!==g_encatt[t].id&&g_encatt[t].id==e)return g_encatt[t].data;return""}function dosave(e,t){var a=document.getElementById("replaceexistingsite").checked;if(a&&0==document.getElementById("replaceexistingsiteaid").selectedIndex)alert(gs("Please Make a Selection"));else{var n=getBG();if(n.lploggedin){if(data.editfields){var d=issharedfolder(n.g_shares,data.group);if(!checkreadonly(d))return;var i=0==d?n.g_local_key:d.sharekey;if(is_application(data)){var l=get_record(get_record_id(data));for(var s in l.last_touch=lp_get_gmt_timestamp(),l.fields){var r=l.fields[s];(C=document.getElementById("fields").contentWindow.document.getElementById(r.htmlid))&&(r.value=n.lpmenc(C.value,!0,i))}var o="appaid="+n.en(l.appaid);for(var s in l.fields){r=l.fields[s];o+="&fieldid"+s+"="+n.en(r.id)+"&fieldtype"+s+"="+n.en(r.type)+"&fieldvalue"+s+"="+n.en(crypto_btoa(r.value))}o+=0==d?"":"&sharedfolderid="+n.en(d.id),(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_site(get_record_id(data)),n.increment_local_accts_version(),n.rewritelocalfile(),n.saveSite(o,l)}else checkFieldsForUpdates(i);return getBG().close_editfieldsopener(),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}var c=punycode.URLToASCII(trim(document.getElementById("url").value)),p=document.getElementById("name").value,g=document.getElementById("group").value,m=document.getElementById("username").value,u=document.getElementById("password").value,_=getSecureNoteFromFields(),h=document.getElementById("fav").checked,y=document.getElementById("never_autofill").checked,f=document.getElementById("pwprotect").checked,v=document.getElementById("autologin").checked;if(g_pwlen>0&&0==u.length||-1==g_pwlen&&0==u.length){var w=gs("Are you sure you want to save an empty password?");if(!confirm(w))return}if(!1!==(d=issharedfolder(n.g_shares,g))||0!=g.toLowerCase().indexOf("shared-")){if(checkreadonly(d)){var E=!1;if(existing&&g!=data.group){if(E=issharedfolder(n.g_shares,data.group),!checkmove(d,E))return}else existing&&(E=d);if(i=existing?0==E?n.g_local_key:E.sharekey:0==d?n.g_local_key:d.sharekey,a){var b=n.g_sites[document.getElementById("replaceexistingsiteaid").value];p=b.name,g=b.group,i=0==(d=issharedfolder(n.g_shares,g))?n.g_local_key:d.sharekey,_=n.lpmdec(b.extra,!0,i),h="1"==b.fav,y=b.never_autofill,f=b.pwprotect,v=b.autologin}if(""!=p){if(_.length>45e3){if(!confirm(gs("The notes field contains too much data.  You may store a maximum of 45,000 characters per note.\n\nWould you like us to truncate the note for you?  You will lose some of your data.")))return;_=_.substring(0,45e3)}var B=!1;if(existing&&g!=data.group&&(d||E)){var I=[get_record_id(data)];if((j=[])[get_record_id(data)]=g,B=!0,!n.moveIntoSharedFolder(d,E,I,j,!1,!0))return}if(existing&&is_application(data)){(l=get_record(get_record_id(data))).last_touch=lp_get_gmt_timestamp();var x=getusernamefromacct(l),k=getpasswordfromacct(l);for(var s in l.fields){r=l.fields[s];var C,A=document.getElementById("fieldsrow2");if("none"!=window.getComputedStyle(A).display)(C=document.getElementById("fields").contentWindow.document.getElementById(r.htmlid))&&(r.value=n.lpmenc(C.value,!0,i));else""==r.type&&n.lpmdec_acct(r.value,!0,l,n.g_shares)==x?r.value=n.lpmenc(document.getElementById("username").value,!0,i):"password"==r.type&&n.lpmdec_acct(r.value,!0,l,n.g_shares)==k&&(r.value=n.lpmenc(document.getElementById("password").value,!0,i))}l.name=document.getElementById("name").value,l.group=document.getElementById("group").value,l.appname=document.getElementById("url").value;var S=getSecureNoteFromFields();S!=n.lpmdec(l.extra,!0,i)&&(l.extra=lpmenc(S,!0,i)),l.fav=document.getElementById("fav").checked?"1":"0",l.pwprotect=document.getElementById("pwprotect").checked,l.autologin=document.getElementById("autologin").checked?"1":"0";var T=l.group;if(d&&(l.sharefolderid=d.id,T=T.substr(d.decsharename.length+1)),g!=data.group&&(d||E)){I=[get_record_id(data)];return(j=[])[get_record_id(data)]=g,n.moveIntoSharedFolder(d,E,I,j,!1,!1,!0),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}o="ajax=1&extjs=1&cmd=updatelpaa&name="+n.en(n.lpenc(l.name,i))+"&grouping="+n.en(n.lpenc(T,i))+"&appname="+n.en(l.appname)+"&extra="+n.en(crypto_btoa(l.extra))+"&appaid="+n.en(l.appaid);for(var s in"1"==l.fav&&(o+="&fav=on"),l.pwprotect&&(o+="&pwprotect=on"),"1"==l.autologin&&(o+="&autologin=on"),l.fields){r=l.fields[s];o+="&fieldid"+s+"="+n.en(r.id)+"&fieldtype"+s+"="+n.en(r.type)+"&fieldvalue"+s+"="+n.en(crypto_btoa(r.value))}return o+=0==d?"":"&sharedfolderid="+n.en(d.id),(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_site(get_record_id(data)),n.increment_local_accts_version(),n.rewritelocalfile(),n.saveSite(o,l),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}var L=existing?data.sn?n.g_securenotes[get_record_id(data)]:n.g_sites[get_record_id(data)]:n.createNewAcct(),N=!1;for(var s in attaches)attaches.hasOwnProperty(s)&&void 0!==attaches[s]&&(N=!0);if(N&&!t){if(void 0===L.attachkey||""==L.attachkey){var G=SHA256(lpCreatePass(32,1,1,1,1,1,1,1));g_attachkey=n.lpenc(G,i)}else g_attachkey=L.attachkey;var P=AES.hex2bin(n.lpdec(g_attachkey,i)),F=[];for(var s in attaches)attaches.hasOwnProperty(s)&&void 0!==attaches[s]&&(attaches[s].filename=lpenc(attaches[s].filename,P),F[F.length]={id:attaches[s].id,bytes:attaches[s].bytes});if(F.length)return void n.fastEncryptAttachments(P,F,function(e){g_encatt=e,dosave(null,!0)})}var O=lp_gettld_url(AES._utf8_encode(c));if(!existing||data.sn||L.tld==O||e||!n.g_prompts.view_pw_prompt){existing&&!L.sn&&n.fix_tlds(L.tld,O,get_record_id(data)),L.genpw=!1,L.name=p,B||(L.group=g),"http://sn"==c?(L.url=c,L.sn=1):L.url=AES._utf8_encode(c),L.tld=O,L.unencryptedUsername=m,m!=n.lpmdec(L.username,!0,i)&&(L.username=n.lpmenc(m,!0,i)),u!=n.lpmdec(L.password,!0,i)&&(L.password=n.lpmenc(u,!0,i)),_!=n.lpmdec(L.extra,!0,i)&&(L.extra=n.lpmenc(_,!0,i)),L.fav=h?"1":"0",L.autologin=v,L.never_autofill=y,L.pwprotect=f,existing||(L.aid="0"),0!=d&&(L.sharefolderid=d.id,0==d.give&&(L.sharedfromaid=1,g_sharedfromaid=!0));var D="",R=[];if(N){void 0!==L.attachkey&&""!=L.attachkey||(L.attachkey=g_attachkey,D+="&attachkey="+n.en(L.attachkey)),L.attachpresent="1",L.retrieveattach=1;var W=0;for(var s in attaches)attaches.hasOwnProperty(s)&&void 0!==attaches[s]&&(D+="&filename"+W+"="+n.en(attaches[s].filename),D+="&mimetype"+W+"="+n.en(attaches[s].mimetype),D+="&attachid"+W+"="+n.en(attaches[s].id),D+="&attachbytes"+W+"="+n.en(get_decrypted_attachdata(attaches[s].id)),void 0===R.add&&(R.add=[]),R.add[R.add.length]=existing?{id:L.aid+"-"+attaches[s].id,mimetype:attaches[s].mimetype,parent:L.aid,filename:attaches[s].filename}:{id:attaches[s].id,mimetype:attaches[s].mimetype,filename:attaches[s].filename},W++)}if(removedattach.length>0){L.retrieveattach=1;for(s=0;s<removedattach.length;s++)D+="&rmattach"+s+"="+n.en(removedattach[s]),void 0===R.remove&&(R.remove=[]),R.remove[R.remove.length]=removedattach[s]}T=g;if(d&&(T=g.substr(d.decsharename.length+1)),existing){if(c!=data.url||p!=data.name||g!=data.group||m!=data.unencryptedUsername||u!=n.lpmdec(data.password,!0,i)||_!=n.lpmdec(data.extra,!0,i)||h!=("1"==data.fav)||y!=data.never_autofill||f!=data.pwprotect||v!=data.autologin||attaches.length>0||removedattach.length>0){L.sn?n.g_securenotes[L.aid]=L:n.g_sites[L.aid]=L;for(var s in L.fields)if(L.fields.hasOwnProperty(s)){var H=L.fields[s];is_encrypted_field(H.type)&&null!=origpassword&&""!=origpassword&&null!=H.value&&""!=H.value&&n.lpmdec_acct(H.value,!0,L,n.g_shares)==n.lpmdec_acct(origpassword,!0,L,n.g_shares)&&(!0,"password"==H.type&&(H.value=L.password)),is_encrypted_field(H.type)&&null!=origusername&&""!=origusername&&null!=H.value&&""!=H.value&&n.lpmdec_acct(H.value,!0,L,n.g_shares)==n.lpmdec_acct(origusername,!0,L,n.g_shares)&&(!0,"text"!=H.type&&"email"!=H.type&&"tel"!=H.type&&"url"!=H.type||(H.value=L.username))}if(g!=data.group&&(d||E)){var j;I=[get_record_id(data)];return(j=[])[get_record_id(data)]=g,n.moveIntoSharedFolder(d,E,I,j,!1,!1,!0),void setTimeout(function(){getBG().closecurrenttab("site.html")},0)}(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_site(get_record_id(data)),n.applyattacharraychanges(R),n.increment_local_accts_version(),n.rewritelocalfile();o="ajax=1&extjs=1&name="+n.en(n.lpenc(p,i))+"&url="+n.en(AES.url2hex(c))+"&grouping="+n.en(n.lpenc(T,i))+"&username="+n.en(crypto_btoa(L.username))+"&password="+n.en(crypto_btoa(L.password))+"&extra="+n.en(crypto_btoa(L.extra))+"&openid_url=&aid="+n.en(get_record_id(data))+"&basic_auth=0&isbookmark=0&localupdate=1";o+=f?"&pwprotect=on":"",o+=y?"&never_autofill=on":"",o+=v?"&autologin=on":"",o+=h?"&fav=on":"",o+=0==d?"":"&sharedfolderid="+n.en(d.id),"http://sn"==c&&void 0!==n.g_loglogins&&n.g_loglogins&&(o+="&n="+AES.url2hex(p)),"http://sn"!=L.url&&"http://group"!=L.url&&8==(8&n.g_loglogins)&&(o+="&un="+en(AES.bin2hex(n.lpmdec_acct(origusername,!0,L,n.g_shares)))),o+=D,L.attacharraychanges=R,L.newvalues=[],n.saveSite(o,L);var M=n.getsites(O,!0);if(u!=n.lpmdec(data.password,!0,i)&&array_length(M)>1){var Y=n.lpmdec(data.password,!0,i),U=!1,K=","+get_record_id(data)+",";for(var V in M)getpasswordfromacct(n.g_sites[V])==Y&&get_record_id(data)!=V?U=!0:K+=","+V+",";U&&n.openLinkedSites(u,O,K)}}data.save_all&&checkFieldsForUpdates(i)}else{L.fields=new Array;var q=[],z=updateAndEncryptData2(n,L.username,L.password,L.fields,L,q,i);o="name="+n.en(n.lpenc(p,i))+"&grouping="+n.en(n.lpenc(T,i))+"&data="+n.en(n.bin2hex(z))+"&extra="+n.en(n.lpenc(_,i))+(f?"&pwprotect=on":"")+(y?"&never_autofill=on":"")+(v?"&autologin=on":"")+(h?"&fav=on":"");if(o+="&extjs=1&localupdate=1",o+=0==d?"":"&sharedfolderid="+n.en(d.id),void 0!==data.realm&&(L.realm_data=n.lpmenc(data.realm,!0,i),L.basic_auth="1",o+="&basic_auth=1&realm="+n.en(n.lpenc(data.realm,i))),"http://sn"==c){var X=getNoteValue("NoteType",_);L.notetype=X,o+=X&&""!=X?"&notetype="+n.en(X):""}a&&(o+="&replacing=1"),o+=D,data.save_all?(L.save_all=!0,o+="&ajax=1&aid=0&save_all=1&url="+n.en(AES.url2hex(c))+"&openid_url=&username=&password=",L.newvalues=q,n.saveAllSite(o,L)):void 0!==data.formdata?(o+="&ref="+n.en(AES.url2hex(c)),a&&(o+="&aid="+n.en(document.getElementById("replaceexistingsiteaid").value)),void 0!==data.createacct&&data.createacct&&void 0!==data.username_field&&(L.fields=new Array,o+="&createacct=1&username_field="+n.en(data.username_field)),L.newvalues=q,n.saveSiteFromSubmit(o,L)):(o+="&ajax=1&aid=0&url="+n.en(AES.url2hex(c))+"&openid_url=&username="+n.en(crypto_btoa(L.username))+"&password="+n.en(crypto_btoa(L.password)),L.newvalues=q,L.attacharraychanges=R,n.saveSite(o,L))}setTimeout(function(){getBG().closecurrenttab("site.html")},0)}else n.security_prompt(function(){dosave(1,t)})}else alert(gs("You must enter a name."))}}else alert(gs("Sorry - group names starting with 'Shared-' are created by LastPass to indicate groups shared with other people. Please use a different name."))}else console_log("Not logged in!")}}function checkFieldsForUpdates(e){var t=getBG(),a=document.getElementById("fields").contentWindow.document,n=!1;for(var d in data.fields){var i=data.fields[d];if(is_encrypted_field(i.type)){if((o=a.getElementById(i.htmlid))&&void 0!==o.value&&t.lpmdec(i.value,!0,e)!=o.value){n=!0;var l=t.lpmenc(o.value,!0,e);""!=i.value&&""!=t.g_sites[get_record_id(data)].username&&i.value==t.g_sites[get_record_id(data)].username&&""!=o.value&&(t.g_sites[get_record_id(data)].username=l,t.g_sites[get_record_id(data)].unencryptedUsername=o.value),""!=i.value&&""!=t.g_sites[get_record_id(data)].password&&i.value==t.g_sites[get_record_id(data)].password&&""!=o.value&&(t.g_sites[get_record_id(data)].password=l),i.value=l}}else if("checkbox"==i.type||"radio"==i.type){var s=i.checked,r=a.getElementById(i.htmlid)&&a.getElementById(i.htmlid).checked;s!=r&&(n=!0,i.checked=r)}else if("select-one"==i.type){var o;if(i.faketype)(o=a.getElementById(i.htmlid))&&void 0!==o.value&&i.value!=o.value&&(n=!0,i.value=o.value)}}if(n){(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&(t.update_site(get_record_id(data)),t.update_fields(get_record_id(data),data.fields)),t.increment_local_accts_version(),t.rewritelocalfile();var c="update=1&aid="+t.en(get_record_id(data))+"&urid=0",p="",g=[];for(var d in data.fields){var m;if((i=data.fields[d]).htmlid&&a.getElementById(i.htmlid))if(m=data.editfields&&""==i.formname?"_"+i.name:"_"+i.formname+"_"+i.name,is_encrypted_field(i.type)){var u=a.getElementById(i.htmlid).value;g.push(u),u=crypto_btoa(i.value),p+=m+"="+t.en(u)+"&"}else if("checkbox"==i.type)a.getElementById(i.htmlid).checked&&(p+=m+"="+t.en(i.value)+"&");else if("select-one"==i.type&&i.faketype){u=a.getElementById(i.htmlid).value;p+=m+"="+t.en(u)+"&"}}p+="&auto=1";var _=issharedfolder(t.g_shares,data.group);p+=0==_?"":"&sharedfolderid="+t.en(_.id),t.saveFields(c,p,{aid:data.aid,newvalues:g})}}function updateAndEncryptData2(e,t,a,n,d,i,l){for(var s="",r=void 0!==data.formdata?data.formdata.split("\n"):new Array,o=!1,c=0,p=0,g=0;g<r.length;g++){4!=(m=r[g].split("\t")).length&&5!=m.length||("text"==m[3]||"email"==m[3]||"tel"==m[3]||"url"==m[3]?c++:"password"==m[3]&&p++)}0!=c||2!=p||data.save_all||(o=!0);for(g=0;g<r.length;g++){var m;if(4==(m=r[g].split("\t")).length||5==m.length){var u=data.save_all?decodeURIComponent(m[0]):"0",_=decodeURIComponent(m[1]),h=decodeURIComponent(m[2]),y=getBG().lpmenc(h,!0,l),f=m[3];if("text"==f||"password"==f||"hidden"==f||"textarea"==f||"email"==f||"tel"==f||"url"==f){if("email"==f&&h==data.username&&(y=t),"tel"==f&&h==data.username&&(y=t),"url"==f&&h==data.username&&(y=t),"text"==f&&h==data.username&&(y=t),"password"==f&&o?(y=t,o=!1):"password"==f&&h==data.password&&(y=a),h=lpmdec(y,!0,l),i&&i.push(h),s+=u+"\t"+e.en(_)+"\t"+e.en(crypto_btoa(y))+"\t"+e.en(f)+"\n","hidden"!=f)(v={}).otherfield=data.save_all,v.name=_,v.type=f,v.value=y,v.checked=!1,v.formname=data.save_all?u:"",v.urid="0",v.otherlogin="0",v.url="",n[n.length]=v}else if("action"==f)s+=u+"\taction\t"+e.en(h)+"\taction\n",d.action=AES.url2hex(h);else if("method"==f)s+=u+"\tmethod\t"+e.en(h)+"\tmethod\n",d.method=h;else{var v;if(s+=u+"\t"+e.en(_)+"\t"+e.en(h)+"\t"+e.en(f)+"\n","checkbox"==f||"radio"==f||"select-one"==f)(v={}).otherfield=data.save_all,v.name=_,v.type=f,"checkbox"==f||"radio"==f?(v.checked="-1"==h.substring(h.length-2),v.value=h.substring(0,h.length-2)):v.value=h,v.formname=data.save_all?u:"",v.urid="0",v.otherlogin="0",v.url="",n[n.length]=v}}}return s}function getDataHTML(){var e=newelt("div"),t=newelt("link");t.type="text/css",t.href="general.css",e.appendChild(t);for(var a=data.formdata.split("\n"),n=0;n<a.length;n++){var d=a[n].split("\t");if(4==d.length||5==d.length){var i=data.save_all?decodeURIComponent(d[0]):"0",l=decodeURIComponent(d[1]),s=decodeURIComponent(d[2]),r=d[3],o=uniqid(i+"_"+l);if("text"==r||"password"==r||"email"==r||"tel"==r||"url"==r){var c=newelt("label");set_innertext(c,l);var p=newelt("input","",o);if(p.name=l,p.type=r,p.value=s,e.appendChild(c),e.appendChild(p),"password"==r){event_handlers[o+"toggle"]=function(){return parent.toggle_password(document.getElementById("fields").contentWindow.document.getElementById(this.id.substring(0,this.id.length-6)),this),!1};g_eyeimgid=o+"toggleimg";var g=newelt("a","eye",o+"toggle"),m=newelt("img","",g_eyeimgid);m.alt=gs("[Show]"),m.src="images/eye-shown.png",g.appendChild(m),e.appendChild(g)}e.appendChild(newelt("br"))}else if("textarea"==r){var u=newelt("label");set_innertext(u,l);var _=newelt("textarea");_.readonly=!0,_.name=l,_.style.verticalAlign="top",set_innertext(_,s),e.appendChild(u),e.appendChild(_),e.appendChild(newelt("br"))}else if("select-one"==r){var h=newelt("select");h.name=l;var y=newelt("option");y.value=s,set_innertext(y,s),h.appendChild(y),e.appendChild(h),e.appendChild(newelt("br"))}else if("checkbox"==r||"radio"==r){if(checked="-1"==s.substring(s.length-2)?" checked":"","radio"==r&&""==checked)continue;s=s.substring(0,s.length-2);var f=newelt("input");f.type=r,f.value=s,f.disabled=!0,checked.length>0&&(f.checked=!0);var v=newelt("label");set_innertext(v,l),e.appendChild(f),e.appendChild(v),e.appendChild(newelt("br"))}}}return e}function showaddfield(){var e=getBG(),t=issharedfolder(e.g_shares,data.group);if(checkreadonly(t)){var a=document.getElementById("fields").contentWindow.document;a.getElementById("addfield").style.display="block",a.getElementById("newname").focus()}}function doaddfield(){var e=getBG(),t=issharedfolder(e.g_shares,data.group);if(checkreadonly(t)){var a=document.getElementById("fields").contentWindow.document,n=a.getElementById("newname").value,d=a.getElementById("newtype").value,i=d;"select-one"==i&&(i="text");var l=a.getElementById("newformname")?a.getElementById("newformname").value:"";if(""!=n){for(var s in data.fields)if(data.fields[s].name==n&&(data.editfields||data.fields[s].formname==l))return void alert(gs("You must enter a unique name."));var r=uniqid(l+"_"+n),o=newelt("div");if("text"==d||"password"==d||"select-one"==d||"email"==d||"tel"==d||"url"==d){var c=newelt("label");if(set_innertext(c,n),(f=newelt("input","",ofja(r))).type=ofja(i),c.appendChild(f),o.appendChild(c),"password"==d){g_eyeimgid=r+"toggleimg";var p=newelt("a","eye",ofja(r));p.id=ofja(r)+"toggle",p.href="#",p.className="eye";var g=newelt("img","",ofja(g_eyeimgid));g.id=ofja(g_eyeimgid),g.alt=gs("[Show]"),p.appendChild(g),o.appendChild(p)}}else if("textarea"==d){var m=newelt("textarea","",ofja(r));o.appendChild(m)}else if("checkbox"==d){var u=newelt("input","",ofja(r)),_=newelt("label");_.for=ofja(r),set_innertext(_,n),o.appendChild(u),o.appendChild(_)}var h=newelt("a","",ofja(r)+"delete"),y=newelt("div","","");set_innertext(h,"[ - ]"),h.href="#",set_innertext(y,n),h.appendChild(y);var f,v=a.createElement("div");v.id=r+"_div",v.appendChild(o),a.body.appendChild(v),event_handlers={},"password"==d&&(event_handlers[r+"toggle"]=function(){return parent.toggle_password(document.getElementById("fields").contentWindow.document.getElementById(this.id.substring(0,this.id.length-6)),this),!1}),event_handlers[r+"delete"]=function(){var e=this.id.substring(0,this.id.length-6)+"_div",t=this.children[0].value;return parent.delete_field(e,t,""),!1},lpdbg("site","1 added event handler for "+r+"delete"),fix_event_handlers(),(f=new Object).otherfield=!data.editfields,f.name=n,f.type=d,"select-one"==d&&(f.faketype=i),f.value="",f.formname=l,f.checked=!1,f.urid="0",f.otherlogin="0",f.url="",f.htmlid=r;var w=0;for(var s in data.fields)data.fields.hasOwnProperty(s)&&s>w&&(w=s);"string"==typeof w&&(w=parseInt(w)),0===data.fields.length?data.fields[0]=f:data.fields[w+1]=f,(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&e.update_fields(get_record_id(data),data.fields),e.increment_local_accts_version(),e.rewritelocalfile();var E="add=1&aid="+e.en(data.aid)+"&urid=0&name="+e.en(n)+"&type="+d;data.editfields||(E+="&formname="+e.en(l)),E+="&auto=1";var b=0==t?"":"sharedfolderid="+e.en(t.id);e.saveFields(E,b,{aid:data.aid}),a.getElementById("newname").value="",a.getElementById("newtype").selectedIndex=0,a.getElementById("newformname")&&(a.getElementById("newformname").value=""),a.getElementById("addfield").style.display="none"}else alert(gs("You must enter a name."))}}function newelt(e,t,a){var n=document.createElement(e);return t&&(n.className=t),a&&(n.id=a),n}function getFieldsHTMLNodes(e){var t=getBG(),a=document.createElement("div"),n=newelt("link","","");if(n.rel="stylesheet",n.src="general.css",n.type="text/css",a.appendChild(n),!is_application(data)){event_handlers.addfieldlink=function(){return parent.showaddfield(),!1},event_handlers.doaddfield=function(){parent.doaddfield()};var d=newelt("a","");d.href="#",d.id="addfieldlink",set_innertext(d,gs("Add Field")),a.appendChild(d),a.appendChild(document.createElement("br"));var i=newelt("div","","addfield");i.style.display="none";var l=newelt("label"),s=newelt("input","","newname");s.type="text",set_innertext(l,gs("Name:")),l.appendChild(s),i.appendChild(l),i.appendChild(newelt("br"));var r=newelt("label");set_innertext(r,gs("Type:"));var o=newelt("select","","newtype"),c=newelt("option","","");c.value="text",set_innertext(c,gs("Text"));var p=newelt("option","","");p.value="password",set_innertext(p,gs("Password"));var g=newelt("option","","");g.value="select-one",set_innertext(g,gs("Select"));var m=newelt("option","","");if(m.value="checkbox",set_innertext(m,gs("Checkbox")),o.appendChild(c),o.appendChild(p),o.appendChild(g),o.appendChild(m),r.appendChild(o),i.appendChild(r),i.appendChild(newelt("br")),!data.editfields){var u=newelt("label");set_innertext(u,gs("Form Name:")),u.appendChild(newelt("input","","newformname")),i.appendChild(u)}(u=newelt("input","","doaddfield")).type="button",u.value=gs("Add"),i.appendChild(u),i.appendChild(newelt("br")),i.appendChild(newelt("br")),a.appendChild(i)}var _=new Array;for(var h in data.fields){var y=data.fields[h],f=(u=y.formname,is_application(data)?h:y.name),v=y.value?y.value:"",w=v,E=y.type,b=f+"_"+E+"_"+v;if(void 0===_[b]){_[b]=!0;var B=uniqid(u+"_"+f);y.htmlid=B;var I=newelt("div");if(is_application(data)&&""==E||"text"==E||"password"==E||"email"==E||"tel"==E||"url"==E){w=crypto_btoa(v),v=t.lpmdec(v,!0,e);var x=newelt("input","",ofja(B));x.value=v;var k=newelt("label");if(set_innertext(k,f),k.appendChild(x),I.appendChild(k),"password"==E){event_handlers[B+"toggle"]=function(){return parent.toggle_password(document.getElementById("fields").contentWindow.document.getElementById(this.id.substring(0,this.id.length-6)),this),!1};var C=newelt("a","",ofja(B)+"toggle");C.href="#";var A=newelt("span","","");set_innertext(A,gs("[Show]")),C.appendChild(A),I.appendChild(C),x.type="password",g_pw_field_ids.push(B)}}else if("textarea"==E){w=crypto_btoa(v),v=t.lpmdec(v,!0,e);var S=newelt("label");set_innertext(S,f);var T=document.createElement("textarea","",ofja(B));set_innertext(T,v),S.appendChild(T),I.appendChild(S)}else if("select-one"==E){var L=newelt("label");set_innertext(L,f);var N=newelt("select","",ofja(B)),G=newelt("option");G.value=v,set_innertext(G,v),N.appendChild(G),L.appendChild(N),I.appendChild(L)}else{if("checkbox"!=E&&"radio"!=E)continue;var P=y.checked?" checked":"";if("radio"==E&&""==P)continue;var F=newelt("input","",ofja(B));F.type=ofja(E),F.checked=y.checked,I.appendChild(F);var O=newelt("label");O.for=ofja(B),set_innertext(O,f),I.appendChild(O)}if(!is_application(data)){event_handlers[B+"delete"]=function(){var e=this.children,t=encodeURIComponent(get_innertext(e[0])),a=AES.hex2bin(get_innertext(e[1])),n=this.id.substring(0,this.id.length-6)+"_div";return parent.delete_field(n,t,a),!1},lpdbg("site","2 added event handler for "+B+"delete");var D=newelt("a","",ofja(B)+"delete");set_innertext(D,"[ - ]"),D.href="#";var R=newelt("div","",ofja(B)+"value"),W=newelt("div","",ofja(B)+"origval");R.style.display="none",set_innertext(R,f),W.style.display="none",set_innertext(W,AES.bin2hex(w)),I.appendChild(D),D.appendChild(R),D.appendChild(W)}var H=newelt("div","",ofja(B)+"_div");H.appendChild(I),a.appendChild(H)}}return a}function delete_field(e,t,a){try{if(confirm(gs("Are you sure you would like to delete this field?"))){var n=getBG(),d=issharedfolder(n.g_shares,data.group);if(!checkreadonly(d))return;var i=document.getElementById("fields").contentWindow.document;if(!i.getElementById(e))return void alert("Sorry, deletion of the field failed. Please re-save the site.");for(var l in i.getElementById(e).style.display="none",data.fields)if(data.fields.hasOwnProperty(l)&&data.fields[l].name==t){var s=data.fields[l].value;is_encrypted_field(data.fields[l].type)&&(s=crypto_btoa(s)),s==a&&(void 0!==data.fields.splice?data.fields.splice(l,1):delete data.fields[l])}(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)&&n.update_fields(get_record_id(data),data.fields),n.increment_local_accts_version(),n.rewritelocalfile();var r="delete=1&aid="+n.en(get_record_id(data))+"&urid=0&name="+n.en(t)+"&value="+n.en(a);r+="&auto=1";var o=0==d?"":"sharedfolderid="+n.en(d.id);n.saveFields(r,o,{aid:data.aid})}}catch(e){console_log("caught exception in delete_field: "+e.message)}}function dodel(){getBG().deleteAid(get_record_id(data),window,!1,!1,function(){setTimeout(function(){getBG().closecurrenttab("site.html")},0)})}function doshare(){if(!check_for_changes()||confirm(gs("Are you sure you want to share this item?  Doing so will cause you to lose any changes you have made to this item!"))){var e=getBG();e.unlock_plug2web(),e.openbaseurl("?ac=1&share="+e.en(get_record_id(data))),setTimeout(function(){window_close("site.html")},0)}}function docancel(){setTimeout(function(){getBG().closecurrenttab("site.html")},0)}var HISTORY={USERNAME:0,PASSWORD:1,EXTRA:2};function show_history(e){if(!check_for_changes()||confirm(gs("Are you sure you want to view history?  Doing so will cause you to lose any changes you have made to this item!"))){var t="";e==HISTORY.USERNAME?t="username":e==HISTORY.PASSWORD?t="password":e==HISTORY.EXTRA&&(t="note");var a=getBG();a.unlock_plug2web(),a.openbaseurl("?ac=1&"+t+"history="+a.en(get_record_id(data))),setTimeout(function(){window_close("site.html")},0)}}var logged=!1;function toggle_password(e,t,a){if("password"==e.type){if(existing){var n=getBG();if(null!=data.sharedfromaid&&""!=data.sharedfromaid&&"0"!=data.sharedfromaid&&"null"!=data.sharedfromaid)return void alert(gs("This is a shared site. You are not permitted to view the password."));if(n.g_prompts.view_pw_prompt)return void(g_eye_show&&null!=t&&void 0!==t.children[0]&&void 0!==t.children[0].children[0]?n.security_prompt(function(a){e.type="text",t.children[0].children[0].src=get_eye_src(e.type,"glow"),t.children[0].children[0].setAttribute("alt",gs("[Hide]")),set_innertext(t.children[0].children[1],gs("Hide Password"))}):n.security_prompt(function(){e.type="text",set_innertext(t,gs("[Hide]"))}))}existing&&!logged&&(n.loglogin(get_record_id(data)),logged=!0),e.type="text",g_eye_show&&null!=t&&void 0!==t.children[0]&&void 0!==t.children[0].children[0]?(t.children[0].children[0].src=get_eye_src(e.type,"glow"),t.children[0].children[0].setAttribute("alt",gs("[Hide]")),set_innertext(t.children[0].children[1],gs("Hide Password"))):set_innertext(t,gs("[Hide]"))}else e.type="password",g_eye_show&&null!=t&&void 0!==t.children[0]&&void 0!==t.children[0].children[0]?(t.children[0].children[0].src=get_eye_src(e.type),t.children[0].children[0].setAttribute("alt",gs("[Show]")),set_innertext(t.children[0].children[1],gs("Show Password"))):set_innertext(t,gs("[Show]"))}function gsproper(e){return gs(e+"proper")!=e+"proper"?gs(e+"proper"):gs(e)}function check_for_changes(){var e=getBG(),t=document.getElementById("url").value,a=document.getElementById("name").value,n=document.getElementById("group").value,d=document.getElementById("username").value,i=document.getElementById("password").value,l=getSecureNoteFromFields(),s=document.getElementById("fav").checked,r=document.getElementById("never_autofill").checked,o=document.getElementById("pwprotect").checked,c=document.getElementById("autologin").checked,p=issharedfolder(e.g_shares,n),g=0==p?e.g_local_key:p.sharekey;return is_application(data)?t!=data.appname||a!=data.name||n!=data.group||d!=getusernamefromacct(data)||i!=getpasswordfromacct(data)||l!=e.lpmdec(data.extra,!0,g)||s!=("1"==data.fav)||o!=data.pwprotect||c!=("1"==data.autologin):t!=data.url||a!=data.name||n!=data.group||d!=data.unencryptedUsername||i!=e.lpmdec(data.password,!0,g)||l!=e.lpmdec(data.extra,!0,g)||s!=("1"==data.fav)||r!=data.never_autofill||o!=data.pwprotect||c!=data.autologin}function doeditfields(){var e=getBG();if(!check_for_changes()||confirm(is_application(data)?gs("LoseChangesApp"):gs("LoseChanges"))){for(var t in e.g_site_data=new Array,data)e.g_site_data[t]=data[t];e.g_site_data.editfields=1,e.set_editfieldsopener(window),e.openURL(getchromeurl("site.html"),null,e.g_site_data)}}function showattach(e){e.getAttribute("src_hidden")&&e.getAttribute("src_hidden").length?getBG().showImageAttach(e.getAttribute("src_hidden")):openattach(e)}function openattach(e){var t=e.getAttribute("filename")?e.getAttribute("filename"):"";getBG().openAttach(get_record_id(data),e.getAttribute("attachid"),t)}function addattach(){getBG().have_binary()?getBG().addAttach(function(){getBG().g_ischrome&&addattachcb()}):confirm(gs("This feature requires the binary version of this browser extension.  Would you like to install it now?"))&&getBG().install_binary()}function addThumbnail(e,t,a,n,d,i){var l=get_extension_from_mimetype(t),s=check_filename_badchars(l),r=null;if(r=s==FILENAME_FRAGMENT_VALID?"."+l:0==s.length||s==FILENAME_FRAGMENT_EMPTY?"":"."+gs(l),d&&i)try{var o=AES.hex2bin(lpdec(d,i));n=lpdec(n,o)}catch(e){n=""}null!==n&&""!=n||(n="attachment"+num_attachments+r);var c=document.getElementById("attachtable"),p=document.createElement("tr"),g=document.createElement("td");g.id=e,g.style.height="28px",g.style.width="80%",g.style.background="url('images/paperclip.png') no-repeat 2px 2px #e6e6e6";var m=document.createElement("span");m.style.fontWeight="bold",m.style.position="relative",m.style.left="32px",m.style.top="6px",m.style.cursor="pointer",m.appendChild(document.createTextNode(n)),a&&""!=a&&0==t.indexOf("data:image")?(m.setAttribute("attachid",e),d?(getBG().fastDecryptAttachment(e,t,a,d,i,function(e){getBG().g_ischrome&&(e&&e.length?m.setAttribute("src_hidden",t+";base64,"+e):m.setAttribute("src_hidden",""))}),m.addEventListener("click",function(){attachment_action_menu(this,showattach)})):(a&&a.length?m.setAttribute("src_hidden",t+";base64,"+a):m.setAttribute("src_hidden",""),getBG().have_binary()?m.addEventListener("click",function(){attachment_action_menu(this,showattach)}):m.addEventListener("click",function(){showattach(this)}))):(m.setAttribute("attachid",e),getBG().have_binary()?m.addEventListener("click",function(){attachment_action_menu(this,openattach)}):m.addEventListener("click",function(){openattach(this)}));var u=document.createElement("span");u.className="attachx",u.setAttribute("attachid",e),u.addEventListener("click",function(){rmattach(this)}),set_innertext(u,"     "),g.appendChild(m),g.appendChild(u),p.appendChild(g),c.insertBefore(p,c.firstChild),attachnum++}function createAttachId(){for(;;){var e=Math.floor(99999*Math.random());for(var t in data.attaches)if(data.attaches.hasOwnProperty(t)&&data.attaches[t].id==get_record_id(data)+"-"+e)break;for(t=0;t<attaches.length&&(void 0===attaches[t]||attaches[t].id!=e);t++);return e}}function rmattach(e){var t=e.getAttribute("attachid");if(confirm(gs("Are you sure you would like to remove this attachment?"))){if(void 0!==data.attachpresent&&"1"==data.attachpresent)for(var a in data.attaches)data.attaches.hasOwnProperty(a)&&t==data.attaches[a].id&&(removedattach[removedattach.length]=t);delete attaches[t],delThumbnail(t)}}function delThumbnail(e){for(var t=document.getElementById("attachtable"),a=0;a<t.children.length;a++){var n=t.children[a];if(n.children&&n.children.length&&n.children[0].id==e)return void t.removeChild(n)}}function attachment_action_doSave(){if(null!=open_attach_target){var e=open_attach_target.getAttribute("filename")?open_attach_target.getAttribute("filename"):"";getBG().exportAttachment(get_record_id(data),open_attach_target.getAttribute("attachid"),e)}else alarm("error, trying to save an attachment that does not exist");close_attach_list()}function clearData(){for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++)"button"!=e[t].type&&(e[t].value="");var a=document.getElementsByTagName("textarea");for(t=0;t<a.length;t++)a[t].value=""}function uniqid(e){return e||(e=""),"a"+SHA256(e+"_"+(new Date).getTime()+"_"+Math.floor(100*Math.random()))}function setup_eye_events(e){if(g_eye_show){e.getElementById("passwordtoggle");e.getElementById("passwordtoggleimg").style.verticalAlign="bottom"}}function eye_over(e){if(null!=e&&null!=e.target){var t=document.getElementById("passwordtoggleimg"),a=document.getElementById("password");e.target==t&&(t.src=get_eye_src(a.type,"glow"))}}function eye_out(e){if(null!=e&&null!=e.target){var t=document.getElementById("passwordtoggleimg"),a=document.getElementById("password");e.target==t&&(t.src=get_eye_src(a.type))}}function get_eye_src(e,t){return"password"==e?"images/eye-shown.png":"images/eye-hidden.png"}var CPW_WAKETIME=97,my_aid=null;function docpwbtn(e){var t=getBG(),a=document;if(!a||!t||!data)return!1;var n=data.aid,d=data.url;return g_cpwbot&&d&&void 0!==t.dopwchange&&(g_start_time=(new Date).getTime(),t.cpwbot_preinit(),g_cpw_progress_ctr=20,show_cpw_dialog("progress"),setTimeout(function(){insert_cpw_placeholder_msg(a,gs("LastPass is loading..."))},5003),setTimeout(function(){cpw_status_check()},CPW_WAKETIME),g_ischrome?get_selected_tab(null,function(e){t.dopwchange(n,!1,e)}):t.dopwchange(n,!1)),!1}function docpwdebug(e){var t=getBG(),a=document;if(!a||!t||!data)return!1;if(g_cpwbot){if(document.getElementById("cpwmsgdiv"))return!1;var n=a.createElement("div");n.style.height="200px",n.style.width="100%",n.style.overflow="auto",n.style.backgroundColor="blue",n.style.color="yellow",n.style.padding="3px",n.id="cpwmsgdiv";var d=a.getElementById("sitebody");d?d.appendChild(n):a.body.appendChild(n)}return!1}var g_cpw_progress_ctr=0,g_lastmsg="";function cpw_status_check(){var e=getBG(),t=document;if(!t||!e||!data)return!1;var a=!1,n=!1,d=!1,i=!1,l=!1,s=!1,r=t.getElementById("cpwmsgdiv");r&&(g_ischrome?set_innertext(r,e.cpwbot_get_user_debug_messages()):e.cpwbot_get_user_debug_messages()),g_ischrome?cpw_progress_update(e.cpwbot_get_dialog_msg()):e.cpwbot_get_dialog_msg();var o=get_current_state(!0);switch(lpdbg("site","BG.current_state is "+o),o){case"FAIL":a=!0,n=!0;break;case"CAPTCHA":a=!0,n=!0,d=!0;break;case"DOCAPTCHA":i=!0;break;case"TIMEOUT":a=!0,n=!0,s=!0;break;case"FAIL_PW_SAVED":a=!0,n=!0,l=!0;break;case"DONE":case"OK":a=!0;break;case 0:case null:a=!1}(form_refresh(),i)?g_start_time=(new Date).getTime():(new Date).getTime()>g_start_time+POLL_MAXTIME&&(a=!0,n=!0,lpdbg("site","max timeout"));a?(show_cpw_dialog(n?d?"captcha":s?"timeout":l?"fail_pw_saved":"fail":"dismiss"),g_ischrome?setTimeout(function(){form_refresh()},3001):setTimeout(function(){get_data("siterefresh",function(){form_refresh()})},3001)):setTimeout(function(){cpw_status_check()},CPW_WAKETIME)}function form_refresh(){var e=getBG(),t=document;if(!t||!e||!data)return!1;if(!e.lploggedin)return!1;var a=(new Date).getTime(),n=0;if(my_aid){var d=get_record(my_aid,!0);if(d){var i="";void 0!==e.g_pending_pw_change&&(i=e.lpdec_acct(e.g_pending_pw_change[my_aid],d,e.g_shares));var l=getpasswordfromacct(d);if(d.save_all){var s,r=document.getElementById("fields").contentWindow.document;for(s=0;s<g_pw_field_ids.length;s++){if(c=r.getElementById(g_pw_field_ids[s])){var o=c.value;l&&c&&i&&i!=l&&(l==o||i==o)&&(lpdbg("site","using pending pw instead of g_sites"),l=i),l&&c&&(o===l?console.warn("REFRESH: no change"):o&&l&&(c.value=l,lpdbg("site","REFRESH: reset password iframe field from "+(e.g_show_pw_in_logs?o:"REDACTED")+" to "+(e.g_show_pw_in_logs?l:"REDACTED")))),update_SaveButton()}}}else{var c;o=(c=t.getElementById("password")).value;if(l&&c&&i&&i!=l&&(l==o||i==o)&&(lpdbg("site","using pending pw instead of g_sites"),l=i,n=a/1e3),l&&c)if(o===l);else if(o&&l){c.value=l,lpdbg("site","REFRESH: reset password from "+(e.g_show_pw_in_logs?o:"REDACTED")+" to "+(e.g_show_pw_in_logs?l:"REDACTED"));var p=data.group,g=issharedfolder(e.g_shares,p),m=0==g?e.g_local_key:g.sharekey;data.password=e.lpmenc(l,!0,m),pw_age_update(n>0?n:d.last_pwchange_gmt),update_password_meter("",t.getElementById("password").value),update_SaveButton()}}}}return!1}function show_cpw_button(e){var t=getBG(),a=document;if(!a||!t||!e)return!1;var n=!1;!g_cpwbot&&void 0!==t.g_cpwbot&&t.g_cpwbot&&(g_cpwbot=t.g_cpwbot);var d=issharedfolder(t.g_shares,e.group);if(e&&(d?(checkreadonly(d,!0)?(n=!1,lpdbg("site","in shared folder, writable")):(n=!0,lpdbg("site","in shared folder, readonly")),"1"===d.associative&&lpdbg("site","entry is in linked account")):e.individualshare?null!=e.sharedfromaid&&""!=e.sharedfromaid&&"0"!=e.sharedfromaid&&"null"!=e.sharedfromaid?(lpdbg("site","individual share, readonly"),n=!0):(lpdbg("site","individual share, writable"),n=!1):n=!1),g_cpwbot&&e&&"1"==e.pwch&&!n){if(e.save_all)enable_cpw_field_btn(document);else(i=a.getElementById("cpwbtnmini"))&&(i.addEventListener("click",function(e){document.getElementById("cpwbtnmini").classList.contains("btn_disabled")||show_cpw_dialog("new")}),i.style.fontSize="12px",i.style.display="inline-block"),(l=a.getElementById("pwspacer"))&&(l.style.display="inline-block",l.style.width="50px")}else{var i,l;(i=a.getElementById("cpwbtnmini"))&&(i.style.display="none"),(l=a.getElementById("pwspacer"))&&(l.style.display="none");var s=a.getElementById("cpwfieldbtn");s&&(s.style.display="none")}}function pw_age_update(e){var t=getBG(),a=document;if(!a||!t||!data)return!1;e=parseInt(e);var n=(new Date).getTime();n=null===n?0:parseInt(n/1e3)-0;var d="Never";if(!e||"number"!=typeof e||!n||isNaN(e)||isNaN(n)||n<e){d="",(i=a.getElementById("pwagelabel"))&&(i.style.display="none")}else{var i=a.getElementById("pwagelabel"),l=n-e;d=l<60?l.toString()+" "+(1==l?gs("second"):gs("seconds")):l<3600?(l=parseInt(l/60)).toString()+" "+(1==l?gs("minute"):gs("minutes")):l<86400?(l=parseInt(l/3600)).toString()+" "+(1==l?gs("hour"):gs("hours")):l<604800?(l=parseInt(l/86400)).toString()+" "+(1==l?gs("day"):gs("days")):l<2592e3?(l=parseInt(l/604800)).toString()+" "+(1==l?gs("week"):gs("weeks")):l<31536e3?(l=parseInt(l/2592e3)).toString()+" "+(1==l?gs("month"):gs("months")):(l=parseInt(l/31536e3)).toString()+" "+(1==l?gs("year"):gs("years"))}var s=a.getElementById("pwagediv");s.style.fontStyle="italic",s&&(set_innertext(s,d),a.getElementById("pwagelabel").style.display="inline")}function hide_cpw_dialog(){var e=getBG(),t=document;if(!t||!e||!data)return!1;t.getElementById("pwcontainer");var a=t.getElementById("cpwdialog");a&&(a.style.display="none");var n=t.getElementById("modalbg");if(n&&(n.style.display="none"),void 0!==e.cpwbot_halt){var d=get_current_state();"FAIL"!=d&&"CAPTCHA"!=d&&"DONE"!=d&&"OK"!=d&&"TIMEOUT"!=d&&0!=d&&null!==d&&e.cpwbot_halt()}data&&data.openchpw&&e.close_cpw_tabs()}var event_flags=0,EV_CX=1,EV_OK=2,g_cpw_heard_from_bg=!1;function append_text_with_b(e,t){var a=t.indexOf("<b>"),n=t.indexOf("</b>");e.appendChild(e.ownerDocument.createTextNode(t.substring(0,a)));var d=e.ownerDocument.createElement("b");set_innertext(d,t.substring(a+3,n)),e.appendChild(d),e.appendChild(e.ownerDocument.createTextNode(t.substring(n+4)))}function show_cpw_dialog(e,t,a,n,d){var i=getBG(),l=document;if(!l||!i||!data)return!1;l.getElementById("notesrow1"),l.getElementById("pwcontainer");var s=l.getElementById("modalbg");s.style.width=l.body.clientWidth,s.style.height=l.body.clientHeight,s.style.display="block";var r=l.getElementById("dlghdg"),o=l.getElementById("dlghtml");o.style.fontSize="12px";var c=l.getElementById("bcnd"),p=l.getElementById("bokd"),g=l.getElementById("bdis"),m=null;switch(c&&0==(event_flags&EV_CX)&&(c.addEventListener("click",function(e){hide_cpw_dialog()}),l.getElementById("dlgclose").addEventListener("click",function(e){hide_cpw_dialog()}),g.addEventListener("click",function(e){hide_cpw_dialog()}),event_flags|=EV_CX),p&&0==(event_flags&EV_OK)&&(p.addEventListener("click",function(e){return docpwbtn(e),!1}),event_flags|=EV_OK),set_innertext(c,gs("No, Thanks")),set_innertext(p,gs("Change Password Now")),set_innertext(g,gs("Dismiss")),set_innertext(r,sprintf(gs("%s Password One-Click Change"),"LastPass")),e){case"new":g_cpw_heard_from_bg=!1,LP_decimate_children(o);var u=l.createElement("p");set_innertext(u,sprintf(gs("%s will now attempt to change your password to a strong, generated password that will be saved in your vault and known only to you."),"LastPass")),o.appendChild(u),o.appendChild(l.createElement("br")),append_text_with_b(u=l.createElement("p"),sprintf(gs("In order to complete the process, %s will have to log in to %s and navigate through a number of windows quickly. It is normal to see windows flashing and changing quickly, and may take several moments. We'll let you know when you're all set!"),"LastPass","<b>"+of(data.name)+"</b>")),o.appendChild(u),c.style.display="block",p.style.display="block",g.style.display="none";break;case"progress":LP_decimate_children(o);var _=l.createElement("b");set_innertext(_,gs("Overall Progress:")),o.appendChild(_),o.appendChild(l.createElement("br"));var h=l.createElement("div");h.className="progress_container";var y=l.createElement("div");y.className="progress_bar",y.id="progress_bar",h.appendChild(y),o.appendChild(h),(h=l.createElement("div")).id="stepbystep",o.appendChild(h),(h=l.createElement("div")).id="advanced",o.appendChild(h),l.getElementById("progress_bar").style.width="10%",c.style.display="none",p.style.display="none",g.style.display="none";break;case"update":if(l.getElementById("progress_bar").style.width=t+"%",a){var f=l.createElement("p");"DOCAPTCHA"==get_current_state()&&(f.className="boldred");var v=l.createTextNode(a);f.appendChild(v),l.getElementById("stepbystep").appendChild(f),g_cpw_heard_from_bg||(g_cpw_heard_from_bg=!0,(m=l.getElementById("cpw_placeholder_msg"))&&m.parentNode.removeChild(m))}if(n){f=l.createElement("i"),v=l.createTextNode(gs("Complete!"));f.appendChild(v),(u=l.getElementById("stepbystep").lastChild)&&u.appendChild(f)}if(d){f=l.createElement("p"),v=l.createTextNode(d);f.appendChild(v),l.getElementById("advanced").appendChild(f)}break;case"dismiss":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br")),append_text_with_b(u=l.createElement("p"),sprintf(gs("Congratulations! Your password for %s was updated, and is now saved in your LastPass vault. Your change will sync on every device."),"<b>"+of(data.name)+"</b>")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block",set_innertext(g,gs("OK"));break;case"fail":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br")),append_text_with_b(u=l.createElement("p"),sprintf(gs("We're sorry. We were not able to change your password automatically for %s. Your password was not changed."),"<b>"+of(data.name)+"</b>")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block";break;case"captcha":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br"));u=l.createElement("p");set_innertext(u,gs("Unable to proceed, the website does not allow automated password change.")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block";break;case"timeout":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br"));u=l.createElement("p");set_innertext(u,gs("Timed out waiting for the page to load.  Retry?")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block";break;case"fail_pw_saved":LP_decimate_children(o),o.appendChild(l.createElement("br")),o.appendChild(l.createElement("br")),append_text_with_b(u=l.createElement("p"),sprintf(gs("We're sorry. We were not able to change your password automatically for %s. Your password was not changed."),"<b>"+of(data.name)+"</b>")+gs("The random password that was generated has been saved to your vault.")),o.appendChild(u),c.style.display="none",p.style.display="none",g.style.display="block"}var w=l.getElementById("cpwdialog");w.style.display="block",w.style.height="250px",w.style.width="470px",w.style.left=(parseInt(l.body.clientWidth)-470)/2+"px",w.style.top=(parseInt(l.body.clientHeight)-470)/2+"px",g_ischrome||(g_cpwbot_pwchangestate="init_state_dingbats")}function notehist(){var e=getBG();e.unlock_plug2web(),e.openbaseurl("?ac=1&notehistory="+e.en(get_record_id(data))),setTimeout(function(){window_close("site.html")},0)}var g_cpwbot_pwchangestate=null;function cpw_progress_update(e){e&&e!=g_lastmsg&&(g_lastmsg=e,(g_cpw_progress_ctr+=20)>90&&(g_cpw_progress_ctr=95),show_cpw_dialog("update",g_cpw_progress_ctr,e,!1,""))}function get_current_state(e){if(g_ischrome)return getBG().cpwbot_getpwchangestate();var t=g_cpwbot_pwchangestate;return e&&getBG().cpwbot_getpwchangestate(),t}function enable_cpw_field_btn(e){var t=e.getElementById("cpwfieldbtn");t&&(t.addEventListener("click",function(t){e.getElementById("cpwfieldbtn").classList.contains("btn_disabled")||e.getElementById("cpwbtnmini").classList.contains("btn_disabled")||show_cpw_dialog("new")}),t.style.fontSize="12px",t.style.display="inline-block",t.style.marginTop="5px",t.style.marginBottom="5px")}function accelerator_key_handler(e){if(!g_do_keyaccel)return!0;if(!e||!e.keyCode)return!1;var t=!0,a=!1;try{"undefined"!=typeof navigator&&void 0!==navigator.platform&&0==navigator.platform.toLowerCase().indexOf("mac")&&(t=!1,a=!0)}catch(e){}var n=document;if(!n)return!1;switch(e.keyCode){case KEY_ESCAPE:break;case KEY_S:(e.ctrlKey&&a||e.altKey&&t)&&("function"!=typeof e.preventDefault&&e.preventDefault(),is_savebtn_disabled(n)||dosave(),LP_stopEventPropagation(e))}return!0}function is_savebtn_disabled(e){e||(e=document);var t=e.getElementById("save");return!t||t.className.indexOf("btn_disabled")>=0}function insert_cpw_placeholder_msg(e,t){e||(e=document);var a=e.getElementById("cpw_placeholder_msg");if(t&&!g_cpw_heard_from_bg&&null===a){var n=e.createElement("p"),d=e.createTextNode(t);n.id="cpw_placeholder_msg",n.appendChild(d),e.getElementById("stepbystep").appendChild(n)}}
//# sourceMappingURL=sourcemaps/site1.js.map
