var CPWbot_bg,g_v2engine=!0,g_v3engine=!1;CPWbot_bg||(CPWbot_bg=new CPWbot_bg_lib);var g_cpw_server_initiated_tabid=null,g_cpw_do_fakeui=!1,TYPE_ID="id",TYPE_NAME="name",TYPE_XPATH="xpath",FN_LOGIN=1,FN_PASSWORD=2,FN_LOGIN_OTHER=5,FN_CURRENT_PASS=10,FN_NEW_PASS=11,FN_NEW_PASS_CONFIRM=12,FN_CPW_OTHER=13,FN_CPW_INVALID=14,FN_LOGIN_INVALID=15,FN_LOGIN_SUCCESS=16,FN_LOGIN_SUCCESS_INVALID=17,FN_NAVIGATE_TO_CPW=18,FN_CPW_SUCCESS=19,FN_CPW_SUCCESS_INVALID=20,FN_NAVIGATE_TO_ACCTMGMT=21,FN_CPW_SUBMIT=22,FN_IS_LOGGED_IN=23,FN_IS_LOGGED_IN_NEGATION=24,FN_LOGIN_SUBMIT=25,FN_POPUP_EXISTS=26,FN_POPUP_DISMISS=27,FN_REVEAL_LOGIN=28,FN_CHALLENGE_LOGIN=29,FN_CHALLENGE_PASSWORD=30,FN_CHALLENGE_OTHER=31,FN_CHALLENGE_SUBMIT=32,FN_CHALLENGE_INVALID=33,FN_CHALLENGE_SUCCESS=34,FN_CHALLENGE_SUCCESS_INVALID=35,FN_EPHEMERAL_STATE=37,FN_NAVIGATE_TO_LOGOUT=38,FN_CAPTCHA=39,FN_MULTI_FACTOR=40,FN_PASSWORD_HINT=41,FN_POPUP_EXISTS_INVALID=42,FN_FAKEUI_LOGGED_OUT_1=43,FN_FAKEUI_LOGGED_OUT_2=44,FN_FAKEUI_LOGGED_OUT_3=45,FN_FAKEUI_LOGGED_OUT_INPUT=46,FN_FAKEUI_LOGGED_IN_1=47,FN_FAKEUI_LOGGED_IN_2=48,FN_FAKEUI_LOGGED_IN_3=49,FN_FAKEUI_LOGGED_IN_INPUT=50,FN_FORCE_FAIL=51,FN_CAPTCHA_SUCCESS=52,FN_MULTI_FACTOR_SUCCESS=53,FN_PASSWORD_HINT_SUCCESS=54,FN_LOGIN_ENTRY_INVALID=55,FN_LOGIN_ENTRY_USERNAME=56,FN_LOGIN_ENTRY_SUBMIT=57,FN_LOGIN_ENTRY_PASSWORD=58,FN_LOGIN_ENTRY_SUCCESS_INVALID=59,FN_LOGIN_ENTRY_SUCCESS=60,FN_REVEAL_LOGOUT=61,CONST_CLICK_NOMINAL=0,CONST_CLICK_NO_FOCUS=1,CONST_CLICK_MOUSEDOWN=2,CONST_CLICK_STRANGE=3,JS_PRE_NAVIGATE_CPW=1,JS_PRE_LOGIN=2,JS_POST_NAVIGATE_CPW=3,JS_POST_LOGIN=4,JS_PRE_CPW=5,JS_POST_CPW=6,JS_PRE_ACCTMGMT=7,JS_POST_ACCTMGMT=8,JS_LOGIN_REVEAL=9,JS_VALIDATE_LOGIN_SUCCESS=10,JS_VALIDATE_CPW_SUCCESS=11,JS_LOGIN_SUBMIT=12,JS_FINISH=13,JS_PRE_CHALLENGE=14,JS_POST_CHALLENGE=15,JS_CHALLENGE_SUBMIT=16,JS_VALIDATE_CHALLENGE_SUCCESS=17,JS_BEGIN=18,JS_PRE_LOGOUT=19,JS_POST_LOGOUT=20,JS_LOGIN_ENTRY_SUBMIT=21,JS_PRE_LOGIN_ENTRY=22,JS_POST_LOGIN_ENTRY=23,JS_VALIDATE_LOGIN_ENTRY_SUCCESS=24,JS_PRE_DOCAPTCHA=25,JS_POST_DOCAPTCHA=26;function replace_constants(e){if(!e)return null;if(void 0!==e.field_info)for(var t=0;t<e.field_info.length;t++){if(void 0!==e.field_info[t].id_type)switch(e.field_info[t].id_type){case"TYPE_ID":e.field_info[t].id_type=TYPE_ID;break;case"TYPE_NAME":e.field_info[t].id_type=TYPE_NAME;break;case"TYPE_XPATH":e.field_info[t].id_type=TYPE_XPATH}if(void 0!==e.field_info[t].id_function)switch(e.field_info[t].id_function){case"FN_LOGIN":e.field_info[t].id_function=FN_LOGIN;break;case"FN_PASSWORD":e.field_info[t].id_function=FN_PASSWORD;break;case"FN_LOGIN_OTHER":e.field_info[t].id_function=FN_LOGIN_OTHER;break;case"FN_CURRENT_PASS":e.field_info[t].id_function=FN_CURRENT_PASS;break;case"FN_NEW_PASS":e.field_info[t].id_function=FN_NEW_PASS;break;case"FN_NEW_PASS_CONFIRM":e.field_info[t].id_function=FN_NEW_PASS_CONFIRM;break;case"FN_CPW_OTHER":e.field_info[t].id_function=FN_CPW_OTHER;break;case"FN_CPW_INVALID":e.field_info[t].id_function=FN_CPW_INVALID;break;case"FN_LOGIN_INVALID":e.field_info[t].id_function=FN_LOGIN_INVALID;break;case"FN_LOGIN_SUCCESS":e.field_info[t].id_function=FN_LOGIN_SUCCESS;break;case"FN_LOGIN_SUCCESS_INVALID":e.field_info[t].id_function=FN_LOGIN_SUCCESS_INVALID;break;case"FN_NAVIGATE_TO_CPW":e.field_info[t].id_function=FN_NAVIGATE_TO_CPW;break;case"FN_CPW_SUCCESS":e.field_info[t].id_function=FN_CPW_SUCCESS;break;case"FN_CPW_SUCCESS_INVALID":e.field_info[t].id_function=FN_CPW_SUCCESS_INVALID;break;case"FN_NAVIGATE_TO_ACCTMGMT":e.field_info[t].id_function=FN_NAVIGATE_TO_ACCTMGMT;break;case"FN_CPW_SUBMIT":e.field_info[t].id_function=FN_CPW_SUBMIT;break;case"FN_IS_LOGGED_IN":e.field_info[t].id_function=FN_IS_LOGGED_IN;break;case"FN_IS_LOGGED_IN_NEGATION":e.field_info[t].id_function=FN_IS_LOGGED_IN_NEGATION;break;case"FN_LOGIN_SUBMIT":e.field_info[t].id_function=FN_LOGIN_SUBMIT;break;case"FN_POPUP_EXISTS":e.field_info[t].id_function=FN_POPUP_EXISTS;break;case"FN_POPUP_DISMISS":e.field_info[t].id_function=FN_POPUP_DISMISS;break;case"FN_REVEAL_LOGIN":e.field_info[t].id_function=FN_REVEAL_LOGIN;break;case"FN_CHALLENGE_LOGIN":e.field_info[t].id_function=FN_CHALLENGE_LOGIN;break;case"FN_CHALLENGE_PASSWORD":e.field_info[t].id_function=FN_CHALLENGE_PASSWORD;break;case"FN_CHALLENGE_OTHER":e.field_info[t].id_function=FN_CHALLENGE_OTHER;break;case"FN_CHALLENGE_SUBMIT":e.field_info[t].id_function=FN_CHALLENGE_SUBMIT;break;case"FN_CHALLENGE_INVALID":e.field_info[t].id_function=FN_CHALLENGE_INVALID;break;case"FN_CHALLENGE_SUCCESS":e.field_info[t].id_function=FN_CHALLENGE_SUCCESS;break;case"FN_CHALLENGE_SUCCESS_INVALID":e.field_info[t].id_function=FN_CHALLENGE_SUCCESS_INVALID;break;case"FN_NAVIGATE_TO_LOGOUT":e.field_info[t].id_function=FN_NAVIGATE_TO_LOGOUT;break;case"FN_EPHEMERAL_STATE":e.field_info[t].id_function=FN_EPHEMERAL_STATE;break;case"FN_CAPTCHA":e.field_info[t].id_function=FN_CAPTCHA;break;case"FN_MULTI_FACTOR":e.field_info[t].id_function=FN_MULTI_FACTOR;break;case"FN_PASSWORD_HINT":e.field_info[t].id_function=FN_PASSWORD_HINT;break;case"FN_POPUP_EXISTS_INVALID":e.field_info[t].id_function=FN_POPUP_EXISTS_INVALID;break;case"FN_FORCE_FAIL":e.field_info[t].id_function=FN_FORCE_FAIL;break;case"FN_CAPTCHA_SUCCESS":e.field_info[t].id_function=FN_CAPTCHA_SUCCESS;break;case"FN_MULTI_FACTOR_SUCCESS":e.field_info[t].id_function=FN_MULTI_FACTOR_SUCCESS;break;case"FN_PASSWORD_HINT_SUCCESS":e.field_info[t].id_function=FN_PASSWORD_HINT_SUCCESS;break;case"FN_LOGIN_ENTRY_INVALID":e.field_info[t].id_function=FN_LOGIN_ENTRY_INVALID;break;case"FN_LOGIN_ENTRY_USERNAME":e.field_info[t].id_function=FN_LOGIN_ENTRY_USERNAME;break;case"FN_LOGIN_ENTRY_PASSWORD":e.field_info[t].id_function=FN_LOGIN_ENTRY_PASSWORD;break;case"FN_LOGIN_ENTRY_SUBMIT":e.field_info[t].id_function=FN_LOGIN_ENTRY_SUBMIT;break;case"FN_LOGIN_ENTRY_SUCCESS":e.field_info[t].id_function=FN_LOGIN_ENTRY_SUCCESS;break;case"FN_LOGIN_ENTRY_SUCCESS_INVALID":e.field_info[t].id_function=FN_LOGIN_ENTRY_SUCCESS_INVALID;break;case"FN_REVEAL_LOGOUT":e.field_info[t].id_function=FN_REVEAL_LOGOUT;break;case"FN_FAKEUI_LOGGED_IN_1":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_1;break;case"FN_FAKEUI_LOGGED_IN_2":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_2;break;case"FN_FAKEUI_LOGGED_IN_3":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_3;break;case"FN_FAKEUI_LOGGED_IN_INPUT":e.field_info[t].id_function=FN_FAKEUI_LOGGED_IN_INPUT;break;case"FN_FAKEUI_LOGGED_OUT_1":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_1;break;case"FN_FAKEUI_LOGGED_OUT_2":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_2;break;case"FN_FAKEUI_LOGGED_OUT_3":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_3;break;case"FN_FAKEUI_LOGGED_OUT_OUTPUT":e.field_info[t].id_function=FN_FAKEUI_LOGGED_OUT_INPUT}}if(void 0!==e.jsfrags)for(t=0;t<e.jsfrags.length;t++)if(void 0!==e.jsfrags[t].jstype)switch(e.jsfrags[t].jstype){case"JS_PRE_NAVIGATE_CPW":e.jsfrags[t].jstype=JS_PRE_NAVIGATE_CPW;break;case"JS_PRE_LOGIN":e.jsfrags[t].jstype=JS_PRE_LOGIN;break;case"JS_POST_NAVIGATE_CPW":e.jsfrags[t].jstype=JS_POST_NAVIGATE_CPW;break;case"JS_POST_LOGIN":e.jsfrags[t].jstype=JS_POST_LOGIN;break;case"JS_PRE_CPW":e.jsfrags[t].jstype=JS_PRE_CPW;break;case"JS_POST_CPW":e.jsfrags[t].jstype=JS_POST_CPW;break;case"JS_PRE_ACCTMGMT":e.jsfrags[t].jstype=JS_PRE_ACCTMGMT;break;case"JS_POST_ACCTMGMT":e.jsfrags[t].jstype=JS_POST_ACCTMGMT;break;case"JS_LOGIN_REVEAL":e.jsfrags[t].jstype=JS_LOGIN_REVEAL;break;case"JS_VALIDATE_LOGIN_SUCCESS":e.jsfrags[t].jstype=JS_VALIDATE_LOGIN_SUCCESS;break;case"JS_VALIDATE_CPW_SUCCESS":e.jsfrags[t].jstype=JS_VALIDATE_CPW_SUCCESS;break;case"JS_LOGIN_SUBMIT":e.jsfrags[t].jstype=JS_LOGIN_SUBMIT;break;case"JS_FINISH":e.jsfrags[t].jstype=JS_FINISH;break;case"JS_PRE_CHALLENGE":e.jsfrags[t].jstype=JS_PRE_CHALLENGE;break;case"JS_POST_CHALLENGE":e.jsfrags[t].jstype=JS_POST_CHALLENGE;break;case"JS_CHALLENGE_SUBMIT":e.jsfrags[t].jstype=JS_CHALLENGE_SUBMIT;break;case"JS_VALIDATE_CHALLENGE_SUCCESS":e.jsfrags[t].jstype=JS_VALIDATE_CHALLENGE_SUCCESS;break;case"JS_BEGIN":e.jsfrags[t].jstype=JS_BEGIN;break;case"JS_PRE_LOGOUT":e.jsfrags[t].jstype=JS_PRE_LOGOUT;break;case"JS_POST_LOGOUT":e.jsfrags[t].jstype=JS_POST_LOGOUT;break;case"JS_PRE_LOGIN_ENTRY":e.jsfrags[t].jstype=JS_PRE_LOGIN_ENTRY;break;case"JS_POST_LOGIN_ENTRY":e.jsfrags[t].jstype=JS_POST_LOGIN_ENTRY;break;case"JS_LOGIN_ENTRY_SUBMIT":e.jsfrags[t].jstype=JS_LOGIN_ENTRY_SUBMIT;break;case"JS_PRE_DOCAPTCHA":e.jsfrags[t].jstype=JS_PRE_DOCAPTCHA;break;case"JS_POST_DOCAPTCHA":e.jsfrags[t].jstype=JS_POST_DOCAPTCHA}if(void 0!==e.click_flavor)switch(e.click_flavor){case"CLICK_NO_FOCUS":e.click_flavor=CONST_CLICK_NO_FOCUS;break;case"CLICK_MOUSEDOWN":e.click_flavor=CONST_CLICK_MOUSEDOWN;break;case"CLICK_STRANGE":e.click_flavor=CONST_CLICK_STRANGE;break;case"CLICK_NOMINAL":default:e.click_flavor=CONST_CLICK_NOMINAL}return e}var DEFAULT_CLICK_DELAY=250,DEFAULT_FILL_DELAY=250,DEFAULT_SESSION_TIMEOUT=12e4,DEFAULT_VALIDATE_TIMEOUT=1e4,CLICK_RETRY_TIME=5e3,recipe_template={version:1,symbolic:"",login_url:"",acctmgmt_url:null,cpw_url:"",logout_url:"",login_entry_url:"",fakeui_loggedout_url:"",fakeui_loggedin_url:"",validate_timeout:5e3,field_info:[],jsfrags:[],cpw_delay:250,login_delay:250,acctmgmt_delay:250,login_reveal_delay:250,logout_reveal_delay:250,logout_delay:250,fill_field_delay:250,click_field_delay:250,trigger_cpw_delay:0,cpw_change_success_url:null,cpw_change_failure_url:null,login_failure_url:null,login_success_url:null,login_entry_failure_url:null,login_entry_success_url:null,challenge_invalidate_url:null,challenge_validate_url:null,click_flavor:CONST_CLICK_NOMINAL,generate_pref_overrides:null,reveal_login_js_delay:0,reveal_cpw_js_delay:0,navigate_acctmgmt_js_delay:0,postreveallogin_sleep:0,postacctmgmt_sleep:0,postrevealcpw_sleep:0,posttrigger_sleep:0,postlogout_sleep:0,start_delay:0,post_login_submit_delay:1100,post_js_begin_delay:5555,js_finish_delay:2e3,session_timeout:DEFAULT_SESSION_TIMEOUT,document_complete_timeout:0,proceed_on_interactive:0,click_on_fields_on_fill:0,fill_password_fields_via_keys:0},r_tesco={},r_netflix={},minimal_recipe={symbolic:"",login_url:"",field_info:[],generate_pref_overrides:{minlength:6}},telegraph={symbolic:"Daily Telegraph"},amex={symbolic:"American Express",field_info:[],jsfrag:[]},boa={symbolic:"Bank of America",login_url:"https://www.bankofamerica.com/sitemap/hub/signin.go",field_info:[{id_type:"TYPE_ID",id_value:"userId",id_function:"FN_LOGIN"},{id_type:"TYPE_ID",id_value:"password",id_function:"FN_PASSWORD"}],jsfrag:[]},capitalone={generate_pref_overrides:{mindigits:2,digits:1,special:0}},capitalone360={},testrig={symbolic:"Test",login_url:"http://www.netrot.net/~chang/form/formtest1.html",field_info:[{id_type:"TYPE_ID",id_value:"email",id_function:"FN_LOGIN"},{id_type:"TYPE_NAME",id_value:"password",id_function:"FN_PASSWORD"},{id_type:"TYPE_XPATH",id_value:"//input[@type='submit']",id_function:"FN_LOGIN_SUBMIT"},{id_type:"TYPE_ID",id_value:"email",id_function:"FN_IS_LOGGED_IN_NEGATION"},{id_type:"TYPE_XPATH",id_value:"//input[@type='submit']",id_function:"FN_CPW_SUBMIT"}],jsfrag:[],generate_pref_overrides:{mindigits:1,digits:1,special:0,minlength:6}};function CPWbot_bg_lib(){var e=this,t=null,i=null,n=null,_=null,o=0,a=null,r=null,l=null,s=null,c=null;pe();var u=null,d=[],f=!1,g=!1,p=!1,b=!1,m=!1,v="",C=!1,h=!1,N=!1,S=!1,E=!1,P=!1,w=!1,I=!1,A=!1,T=!1,O={},k=!1,W=!1,F=!1,y=!1,G=!0,D=!1,R=!1,U=!1,M=!1,j=!1,V=!1,J=!1,H=0,B=3,Y=4,x=5,K=6,q=7,z=9,X=68,Q=69,Z=70,$=71,ee=74,te=75,ie=128,ne=129,_e=130,oe=131,ae=132,re=134,le=137,se=138,ce=139,ue=141,de=[];function fe(){return m_last_overlay_msg}function ge(e){m_last_overlay_msg=e}function pe(){ge("")}function be(e){return e?e.login_url:null}function me(e){return e?e.cpw_url:null}function ve(e){return e?e.acctmgmt_url:null}function Ce(e){return e?e.logout_url:null}function he(e){if(!e)return null;var t=e.click_flavor;if("string"==typeof t){var i=parseInt(t);if(!isNaN(i))return i}return e.click_flavor}function Ne(e){return Ae(e,FN_PASSWORD)}function Se(e){return Ae(e,FN_LOGIN)}function Le(e){return Ae(e,FN_NAVIGATE_TO_CPW)}function Ee(e){return Ae(e,FN_NAVIGATE_TO_ACCTMGMT)}function Pe(e){return Ae(e,FN_CPW_SUBMIT)}function we(e){return Ae(e,FN_LOGIN_SUBMIT)}function Ie(e){return Ae(e,FN_REVEAL_LOGIN)}function Ae(e,t){if(!e||!e.field_info)return null;var i,n=null,_=null;for(i=0;i<e.field_info.length;i++)if((n=e.field_info[i]).id_function==t){_={id_type:n.id_type,id_value:n.id_value};break}return _}function Te(e){return at(e,JS_PRE_NAVIGATE_CPW)}function Oe(e){return at(e,JS_POST_NAVIGATE_CPW)}function ke(e){return at(e,JS_PRE_ACCTMGMT)}function We(e){return at(e,JS_POST_ACCTMGMT)}function Fe(e){return at(e,JS_PRE_CPW)}function ye(e){return at(e,JS_POST_CPW)}function Ge(e){return at(e,JS_PRE_LOGIN)}function De(e){return at(e,JS_POST_LOGIN)}function Re(e){return at(e,JS_LOGIN_REVEAL)}function Ue(e){return at(e,JS_LOGIN_SUBMIT)}function Me(e){return at(e,JS_LOGIN_ENTRY_SUBMIT)}function je(e){return at(e,JS_VALIDATE_LOGIN_SUCCESS)}function Ve(e){return at(e,JS_VALIDATE_CPW_SUCCESS)}function Je(e){return at(e,JS_FINISH)}function He(e){return at(e,JS_VALIDATE_CHALLENGE_SUCCESS)}function Be(e){return at(e,JS_BEGIN)}function Ye(e){return at(e,JS_PRE_LOGOUT)}function xe(e){return at(e,JS_POST_LOGOUT)}function Ke(e){return at(e,JS_PRE_LOGIN_ENTRY)}function qe(e){return at(e,JS_POST_LOGIN_ENTRY)}function ze(e){return at(e,JS_VALIDATE_LOGIN_ENTRY_SUCCESS)}function Xe(e){return at(e,JS_PRE_DOCAPTCHA)}function Qe(e){return at(e,JS_POST_DOCAPTCHA)}function Ze(e){var t=null;return e&&void 0!==e.cpw_change_success_url&&(t=e.cpw_change_success_url),t}function $e(e){var t=null;return e&&void 0!==e.cpw_change_failure_url&&(t=e.cpw_change_failure_url),t}function et(e){var t=null;return e&&void 0!==e.login_failure_url&&(t=e.login_failure_url),t}function tt(e){var t=null;return e&&void 0!==e.login_success_url&&(t=e.login_success_url),t}function it(e){var t=null;return e&&void 0!==e.login_entry_failure_url&&(t=e.login_entry_failure_url),t}function nt(e){var t=null;return e&&void 0!==e.login_entry_success_url&&(t=e.login_entry_success_url),t}function _t(e){var t=null;return e&&void 0!==e.challenge_invalidate_url&&(t=e.challenge_invalidate_url),t}function ot(e){var t=null;return e&&void 0!==e.challenge_validate_url&&(t=e.challenge_validate_url),t}function at(e,t){if(!e||!e.jsfrags)return null;var i,n,_;for(i=0;i<e.jsfrags.length;i++)if((n=e.jsfrags[i]).jstype==t){_=n.jsfrag;break}return _}function rt(e,t,i){if(!t||!i)return null;var n=i(t);if(n){var _=(new Date).getTime();null===_&&(_=0);var o="function"==typeof lp_sha256?lp_sha256:SHA256,a=o(e.toString()+n+_.toString()),r=("function"==typeof fasthash?fasthash:"function"==typeof crc32?crc32:"function(j) { if (j) { return j.length; } return 0; }")(n);return verbose_log("injecting javascript fragment into CS: "+n),oi(ti,"Injected Javascript into Document"),sendCS(e,{cmd:"run_cpwbot_js",req_id:a,js:n,hash:r},"all"),!0}return!1}function lt(e){return"undefined"!=typeof g_sites?g_sites[e]:"undefined"!=typeof lpaccts?lpaccts[e]:null}function st(e,t,i,n,_,o,a){if(!i)return!1;null===n&&(n=0),null===o&&(o=0),void 0!==_&&null!==_||(_=DEFAULT_FILL_DELAY),oi(ti,"Filling Field");var r=(new Date).getTime();null===r&&(r=0);var l=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+i.id_value+r.toString());return sendCS(e,{cmd:"cpwbot_fill_field",req_id:l,id_type:i.id_type,id_value:i.id_value,field_value:t,type:"text",formname:"",should_click:n,should_fill_via_keys:o,delay:_},"all"),!0}function ct(e,t,i,n,_,o,a){if(!i)return!1;null===n&&(n=0),null===o&&(o=0),void 0!==_&&null!==_||(_=DEFAULT_FILL_DELAY),oi(ti,"Filling Password Field");var r=(new Date).getTime();null===r&&(r=0);var l=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+i.id_value+r.toString());return sendCS(e,{cmd:"cpwbot_fill_field",req_id:l,id_type:i.id_type,id_value:i.id_value,field_value:t,type:"password",formname:"",should_click:n,should_fill_via_keys:o,delay:_,flavor:a},"all"),!0}function ut(e,i,n,_){if(!i)return!1;void 0!==n&&null!==n||(n=DEFAULT_CLICK_DELAY),void 0===_&&(_=CONST_CLICK_NOMINAL),Mi=(new Date).getTime()+CLICK_RETRY_TIME+n,ji=!1,oi(ti,"Clicking");var o=(new Date).getTime();null===o&&(o=0);var a=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+i.id_value+o.toString());verbose_log("click_field id="+a+" saved to m_pwchange_last_click_field_id"),c=a,Vi=0;var r={cmd:"cpwbot_click_field",msgid:a,pwchangestate:t,id_type:i.id_type,id_value:i.id_value,delay:n,flavor:_};return sendCS(e,r,"all"),m_lastclick_metadata=r,!0}function dt(e,t,i){if(!t||!i)return!1;var n=lt(i.aid);if(!n)return _n("given invalid aid - data consistency error?"),!1;CPWbot_bg.do_milestone(e,X,t),L("pre-login-form-js"),rt(e,t,Ge);var _=Se(t),o=Ne(t),a=Qt(t),r=Zt(t),l=rnd2=0;J&&(l=rn(),rnd2=rn());var s=0,c=he(t);return _&&(s++,st(e,getusernamefromacct(n),_,a,0*s+l,!1)),o&&(s++,ct(e,getpasswordfromacct(n),o,a,0*s+l+rnd2,r,c)),L("post-login-form-js"),rt(e,t,De),!0}function ft(e,t,i){if(!t)return!1;CPWbot_bg.do_milestone(e,Q,t);var n=!1;S=!1;var _=we(t);if(_){var o=DEFAULT_CLICK_DELAY;void 0!==t.login_delay&&(o=t.login_delay),S=!0,ut(e,_,o,he(t)),n=!0}return rt(e,t,Ue)&&(n=!0),!n||null}function gt(e,t,i){if(!t||!i)return!1;var n=lt(i.aid);if(!n)return _n("given invalid aid - data consistency error?"),!1;CPWbot_bg.do_milestone(e,te,t),rt(e,t,Ke);var _=Ae(t,FN_LOGIN_ENTRY_USERNAME),o=Ae(t,FN_LOGIN_ENTRY_PASSWORD),a=Qt(t),r=Zt(t),l=rnd2=0;J&&(l=rn(),rnd2=rn());var s=0,c=he(t);return _&&(s++,st(e,getusernamefromacct(n),_,a,0*s+l,!1)),o&&(s++,ct(e,getpasswordfromacct(n),o,a,0*s+l+rnd2,r,c)),rt(e,t,qe),!0}function pt(e,t,i){if(!t)return!1;CPWbot_bg.do_milestone(e,ee,t);var n=!1;T=!1;var _=Ae(t,FN_LOGIN_ENTRY_SUBMIT);if(_){var o=DEFAULT_CLICK_DELAY;void 0!==t.login_delay&&(o=t.login_delay),T=!0,ut(e,_,o,he(t)),CPWbot_bg.mark_timestamp("wait_for_click_ack_M"),n=!0}return rt(e,t,Me)&&(n=!0),!n||null}function bt(e){if(verbose_log("entered cpwbot_cs_finish to clean up "+e),null!==i)if(i==e){var t={aid:o,recipe:_,desc:"cpwbot_finish"};g_v2engine?CPWbot_bg.wait_for_doc_complete(e,null,function(e){verbose_log("cpwbot_finish callback!  on tabid="+e),sendCS(e,{cmd:"cpwbot_finish"},"all")},t):sendCS(e,{cmd:"cpwbot_finish"})}else null!==i&&verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+e+" g_pwchangetabid="+i)}function mt(e){var t,i=[],n=[FN_CPW_OTHER,FN_CURRENT_PASS,FN_NEW_PASS,FN_NEW_PASS_CONFIRM];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function vt(e){var t,i,n=[],_=[FN_CPW_INVALID];for(t=0;t<_.length;t++){var o=Rt(e,_[t]);if(o&&o.length>0)for(i=0;i<o.length;i++){var a=o[i];a&&n.push(a)}}return n}function Ct(e){var t,i=[],n=[FN_PASSWORD,FN_LOGIN_OTHER];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function ht(e){var t,i=[],n=[FN_LOGIN_INVALID];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Nt(e){var t,i=[],n=[FN_LOGIN_ENTRY_USERNAME];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function St(e){var t,i=[],n=[FN_LOGIN_ENTRY_INVALID];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Lt(e){var t,i=[],n=[FN_LOGIN_SUCCESS];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Et(e){var t,i=[],n=[FN_LOGIN_SUCCESS_INVALID];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Pt(e){var t,i=[],n=[FN_LOGIN_ENTRY_SUCCESS];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function wt(e){var t,i=[],n=[FN_LOGIN_ENTRY_SUCCESS_INVALID];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function It(e){var t,i=[],n=[FN_CPW_SUCCESS];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function At(e){var t,i=[],n=[FN_CPW_SUCCESS_INVALID];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Tt(e){var t,i=[],n=[FN_IS_LOGGED_IN];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Ot(e){var t,i=[],n=[FN_IS_LOGGED_IN_NEGATION];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function kt(e){var t,i=[],n=[FN_CHALLENGE_PASSWORD,FN_CHALLENGE_OTHER];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Wt(e){var t,i=[],n=[FN_CHALLENGE_INVALID];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Ft(e){return Ae(recipe_obj,FN_CHALLENGE_SUCCESS)}function yt(e){return Ae(recipe_obj,FN_CHALLENGE_SUCCESS_INVALID)}function Gt(e){var t,i=[],n=[FN_CAPTCHA,FN_PASSWORD_HINT,FN_MULTI_FACTOR];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Dt(e){var t,i=[],n=[FN_CAPTCHA_SUCCESS,FN_PASSWORD_HINT_SUCCESS,FN_MULTI_FACTOR_SUCCESS];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}function Rt(e,t){var i,n,_,o=[];if(!e||!e.field_info)return o;for(i=0;i<e.field_info.length;i++)(n=e.field_info[i]).id_function==t&&(_={id_type:n.id_type,id_value:n.id_value},o.push(_));return o}function Ut(e){var t=DEFAULT_VALIDATE_TIMEOUT;if(!e)return t;if(void 0!==e.validate_timeout){var i=parseInt(e.validate_timeout);i&&!isNaN(i)&&(t=i)}return t}function Mt(e,t,i){if(null===i&&(i=1),null===e||!t)return!1;var n=t.desc,_=t.recipe,o=t.fn_url_failed,s=t.fn_url_success,c=t.fn_required,f=t.fn_rejected;t.fn_captcha;vi=!0,mi=(new Date).getTime(),k=!1,W=!1;console_log("cpwbot check_tab_for_state for "+n);var g=c?c(_):[],p=f?f(_):[],b=CPWbot_bg.JSON.stringify(g),m=CPWbot_bg.JSON.stringify(p),v=Gt(_),C=CPWbot_bg.JSON.stringify(v);if(u=di(e),0==g.length&&0==p.length&&!s&&!o)return L("WARN: "+n+" has no field or url criteria defined to validate against"),!0;var h=Ut(_),N=s?s(_):null,S=o?o(_):null,E=(new Date).getTime();null===E&&(E=0);var P=("function"==typeof lp_sha256?lp_sha256:SHA256)(e.toString()+n+E.toString());r=P,Di=b,Ri=m,verbose_log("interrogate id="+r+" desc="+n),d=[];var w={cmd:"cpwbot_validate_state",desc:n,required_fields:b,rejected_fields:m,id:r,validate_timeout:h,timestamp:E,proceed_on_interactive:qt(_)?1:0,interactive_fields:C};return N&&(w.required_url=N),S&&(w.rejected_url=S),a=w,l=n,sendCS(e,w,"all"),verbose_log("setup setimeout for "+h/1e3+" seconds finish_cpwbot_validate_state"),setTimeout(function(){CPWbot_bg&&CPWbot_bg.finish_cpwbot_validate_state(e,P,b,m,n)},h),null}function jt(){return null}function Vt(e,t,i,n){if(n||!CPWbot_bg.get_docaptchastate()){t?ge(t):t=fe(),i||(i=_);var o={msg:t,symbolic:an(i)},a=CPWbot_bg.JSON.stringify(o);sendCS(e,{cmd:"do_cpwbot_overlay",msg:a},g_CS_tops[e])}}function Jt(e){return sendCS(e,{cmd:"hide_cpwbot_overlay"},"all"),!0}function Ht(e){var t=null;return e?(void 0!==e.generate_pref_overrides&&(t=e.generate_pref_overrides),t):t}function Bt(e){var t=0;return e?(void 0!==e.postacctmgmt_sleep&&(t=e.postacctmgmt_sleep),t):null}function Yt(e){var t=0;return e?(void 0!==e.postrevealcpw_sleep&&(t=e.postrevealcpw_sleep),t):null}function xt(e){var t=0;return e?(void 0!==e.postreveallogin_sleep&&(t=e.postreveallogin_sleep),t):null}function Kt(e){var t=0;return e?(void 0!==e.postlogout_sleep&&(t=e.postlogout_sleep),t):null}function qt(e){var t=!1;return e?(void 0!==e.proceed_on_interactive&&(t=!!e.proceed_on_interactive,"0"===e.proceed_on_interactive&&(t=!1)),t):null}function zt(e){var t=0;return e?(void 0!==e.post_login_submit_delay&&(t=e.post_login_submit_delay),t):null}function Xt(e){var t=0;return e?(void 0!==e.session_timeout&&"number"==typeof e.session_timeout&&(t=e.session_timeout),t):null}function Qt(e){var t=0;return e?(void 0!==e.click_on_fields_on_fill&&(t=e.click_on_fields_on_fill?1:0),t):null}function Zt(e){var t=0;return e?(void 0!==e.fill_password_fields_via_keys&&(t=e.fill_password_fields_via_keys?1:0),t):null}function $t(e){if(!e)return null;var t=DEFAULT_FILL_DELAY;return"number"==typeof e.fill_field_delay&&(t=e.fill_field_delay),verbose_log("fill field delay : "+t),t}function ei(e){var t=!1;return e?(void 0!==e.document_complete_timeout&&(t=e.document_complete_timeout),t):null}de[H]="",de[1]=gs("LastPass is loading..."),de[2]=gs("LastPass is loading website..."),de[B]=gs("LastPass is logging in..."),de[Y]=gs("LastPass is changing your password now..."),de[x]=gs("LastPass is changing your password now..."),de[K]=gs("LastPass is changing your password now..."),de[q]=gs("LastPass is changing your password now..."),de[8]=gs("LastPass is logging in..."),de[z]=gs("The website needs you to enter information. Please switch to the tab and enter it."),de[63]=gs("Congratulations! Your password for %s was updated, and is now saved in your LastPass vault. Your change will sync on every device."),de[ie]=gs("We're sorry. We were not able to change your password automatically for %s. Your password was not changed."),de[248]=de[ie]+" "+gs("The random password that was generated has been saved to your vault."),de[136]=de[ie],de[133]=gs("Timed out waiting for the page to load.  Retry?"),de[_e]=de[ie],de[ne]=de[ie],de[re]=de[ie],de[135]=de[ie],de[oe]=de[ie],de[ae]=de[ie],de[le]=de[ie],de[se]=gs("Halt Requested"),de[ce]=gs("Unable to proceed, the website does not allow automated password change."),de[140]=gs("Timed out"),de[ue]=de[ie],"function"==typeof alertfrombg&&(this.alert=alertfrombg),g_isfirefox&&(this.alert=alert),this.JSON=JSON,JSON||(this.JSON=LPJSON),LPJSON,this.get_pwchangestate=function(){return t},this.get_pwchangetabid=function(){return i},this.get_login_url=function(e){return be(e)},this.get_cpw_url=function(e){return me(e)},this.get_acctmgmt_url=function(e){return ve(e)},this.conditional_js_exec=function(e,t,i){return rt(e,t,i)},this.show_cpwbot_overlay=function(e,t,i){return Vt(e,t,i)},this.in_validate=function(){return a&&r&&null!=l&&""!=l&&void 0!==l},this.in_validate_outer=function(){return e.in_validate()||vi||Wi},this.get_last_overlay_message=function(){return fe()},this.get_fakeui_loggedout_url=function(e){return(t=e)?t.fakeui_loggedout_url:null;var t},this.get_fakeui_loggedin_url=function(e){return(t=e)?t.fakeui_loggedin_url:null;var t},this.reveal_cpw=function(e,i){if(!i)return!1;var o=i.recipe,a=i.payload,r=a.aid;if(!o||!a)return!1;L("reveal_cpw called after wait-for-document-complete tabid="+e),CPWbot_bg.mark_timestamp("reveal_cpw"),oi(ii,"Reveal Change-Password Form"),t="D",g=!1,rt(e,o,Te);var l=me(o);if(l){L("call cpw:loadurl with "+l);var s=null;return g_CS_tops&&(s=g_CS_tops[e],g_ischrome&&0!=s&&L("loadurl is not sending to docnum==0 ! "+s)),sendCS(e,{cmd:"loadurl",url:l},s),Ni=!0,verbose_log("m_in_loadurl set"),_=o,n=a,g=!0,null}P=!1;var c=Le(o);if(c){verbose_log("click on FN_NAVIGATE_TO_CPW field!");var u=DEFAULT_CLICK_DELAY;void 0!==o.cpw_delay&&(u=o.cpw_delay),P=!0,L("now waiting for click_ack_D"),ut(e,c,u,he(o)),CPWbot_bg.mark_timestamp("wait_for_click_ack_D")}return function(e){var t=!1;if(!e)return null;void 0!==e.reveal_cpw_js_delay&&(t=!!e.reveal_cpw_js_delay,"0"===e.reveal_cpw_js_delay&&(t=!1));return t}(o)&&(g=!0,Yt(o))?null:(rt(e,o,Oe),i.didcallout?(L("end of reveal_cpw thread with callout to CS - hack Dpickup to resume for aid="+r),t="Dpickup",null):(L("no callout to CS, so reveal_cpw does not end thread, returning to initiate"),!0))},this.navigate_to_acctmgmt=function(e,i){if(!i)return!1;var o=i.recipe,a=i.payload,r=a.aid;if(L("navigate_to_acctmgmt called after wait-for-document-complete tabid="+e),CPWbot_bg.mark_timestamp("acctmgmt_nav"),t="C",!o)return!1;oi(ii,"Navigate to Account Management Page"),p=!1,rt(e,o,ke);var l=ve(o);if(l){L("call acctmgmt:loadurl with "+l);var s=null;return g_CS_tops&&(s=g_CS_tops[e]),sendCS(e,{cmd:"loadurl",url:l},s),Ni=!0,verbose_log("m_in_loadurl set"),_=o,n=a,p=!0,null}E=!1;var c=Ee(o);if(c){verbose_log("click on FN_NAVIGATE_TO_ACCTMGMT field!");var u=DEFAULT_CLICK_DELAY;void 0!==o.acctmgmt_delay&&(u=o.acctmgmt_delay),E=!0,L("now waiting for click_ack C"),ut(e,c,u,he(o)),CPWbot_bg.mark_timestamp("wait_for_click_ack_C")}return function(e){var t=!1;if(!e)return null;void 0!==e.navigate_acctmgmt_js_delay&&(t=!!e.navigate_acctmgmt_js_delay,"0"===e.navigate_acctmgmt_js_delay&&(t=!1));return t}(o)&&(p=!0,Bt(o))?null:(rt(e,o,We),i.didcallout?(L("end of navigate_to_acctmgmt thread with callout to CS - hack Cpickup to resume for aid="+r),t="Cpickup",null):(g_v2engine||L("no callout to CS, so nav_to_acctmgmt does not end thread, returning to initiate"),!0))},this.trigger_cpw=function(e,i){if(V)return!1;if(V=!0,verbose_log("trigger_cpw entered"),CPWbot_bg.mark_timestamp("trigger_cpw"),!i)return!1;var _=i.recipe,o=i.payload;if(!_||!o)return!1;var a=Qt(_),r=Zt(_);L("trigger_cpw called after wait-for-document-complete tabid="+e),t="E";var l=o.aid,c=lt(l),u="";if(!c)return _n("given invalid aid - data consistency error?"),!1;u=c.url,rt(e,_,Fe);var d=Ae(_,FN_CURRENT_PASS),f=Ae(_,FN_NEW_PASS),g=Ae(_,FN_NEW_PASS_CONFIRM),p=Pe(_),b=he(_),m=15,v=1,C=1,h=1,S=0,E=1,P=0,w=1,I=null;g_isfirefox?(LP.lpprefsHasUserValue("genpw_passlen")&&(m=LP.lpprefsGetIntPref("genpw_passlen")),LP.lpprefsHasUserValue("genpw_upper")&&(v=LP.lpprefsGetBoolPref("genpw_upper")?1:0),LP.lpprefsHasUserValue("genpw_lower")&&(C=LP.lpprefsGetBoolPref("genpw_lower")?1:0),LP.lpprefsHasUserValue("genpw_digits")&&(h=LP.lpprefsGetBoolPref("genpw_digits")?1:0),LP.lpprefsHasUserValue("genpw_special")&&(S=LP.lpprefsGetBoolPref("genpw_special")?1:0),LP.lpprefsHasUserValue("genpw_mindigits")&&(E=LP.lpprefsGetIntPref("genpw_mindigits")?1:0),LP.lpprefsHasUserValue("genpw_ambig")&&(P=LP.lpprefsGetBoolPref("genpw_ambig")?1:0),LP.lpprefsHasUserValue("genpw_reqevery")&&(w=LP.lpprefsGetBoolPref("genpw_reqevery")?1:0),LP.lpprefsHasUserValue("genpw_pronounceable")&&(I=LP.lpprefsGetBoolPref("genpw_pronounceable")?1:0)):(m=parseInt(lpGetPref("generate_length",m)),v=parseInt(lpGetPref("generate_upper",v)),C=parseInt(lpGetPref("generate_lower",C)),h=parseInt(lpGetPref("generate_digits",h)),S=parseInt(lpGetPref("generate_special",S)),E=parseInt(lpGetPref("generate_mindigits",E)),P=parseInt(lpGetPref("generate_ambig",P)),w=parseInt(lpGetPref("generate_reqevery",w)),I=parseInt(lpGetPref("generate_pronounceable",I))),0==v&&0==C&&0==h&&0==S&&(v=C=h=1);var A=getpasswordfromacct(c);A.length>m&&(m=A.length);var T=Ht(_);null!==T&&(void 0!==T.length&&null!==T.length&&(m=T.length),void 0!==T.maxlength&&null!==T.maxlength&&m>T.maxlength&&(m=T.maxlength),void 0!==T.minlength&&null!==T.minlength&&m<T.minlength&&(m=T.minlength),void 0!==T.special&&null!==T.special&&(S=T.special?1:0),void 0!==T.digits&&null!==T.digits&&(h=T.digits?1:0),void 0!==T.upper&&null!==T.upper&&(v=T.upper?1:0),void 0!==T.lower&&null!==T.lower&&(C=T.lower?1:0),void 0!==T.mindigits&&null!==T.mindigits&&(E=T.mindigits)),oi(ii,"Generating a new password that is "+m+" chars long, "+(v?"with":"without")+" uppercase chars, "+(C?"with":"without")+" lowercase chars, "+(h?"with":"without")+" numeric chars, "+(S?"with":"without")+" special chars, with at least "+E+" numbers,");var O=(g_isfirefox?LP.lpCreatePass:lpCreatePass)(m,v,C,h,S,E,P,w,I);L("generated new password: "+(g_show_pw_in_logs||g_isadmin?O:"REDACTED")),L("saving "+(g_show_pw_in_logs||g_isadmin?O:"REDACTED")+" to "+u+" as generated password"),g_isfirefox?ff_save_generated_password(O,u,!0,!0):savePassword(O,u,e,1),g_isfirefox?null!==LP.lpgenpwlist&&LP.lpgenpwlist.unshift(O):null!==g_genpws&&g_genpws.unshift(O),CPWbot_bg.do_milestone(e,73,_),o.newpw=lpenc_acct(O,c,"undefined"==typeof g_shares?lpshares:g_shares),o.curpw=lpenc_acct(A,c,"undefined"==typeof g_shares?lpshares:g_shares),n=o,s=o.newpw,oi(ii,"Filling Change-Password Form");var k=$t(_),W=rnd2=rnd3=rnd4=0;J&&(W=rn(),rnd2=rn(),rnd3=rn(),rnd4=rn());var F=0;if(d&&ct(e,A,d,a,k*(F+=1)+W,r,b),f&&ct(e,O,f,a,k*(F+=1)+W+rnd2,r,b),g&&ct(e,O,g,a,k*(F+=1)+W+rnd2+rnd3,r,b),p){N=!0,L("now waiting for click_ack E");var y=null;void 0!==_.trigger_cpw_delay&&(y=_.trigger_cpw_delay),verbose_log("trigger cpw delay : "+y+" + "+k*F);ut(e,p,null===y?k*F:y+k*F+rnd4,b=he(_)),CPWbot_bg.mark_timestamp("wait_for_click_ack_E")}return pass,rt(e,_,ye),i.didcallout?(L("end of trigger_cpw thread with callout to CS - hack Epickup to resume for aid="+l),t="Epickup",null):(L("no callout to CS, so trigger_cpw does not end thread, returning to initiate"),!0)},this.navigate_to_login=function(e,i){if(!i)return!1;var o=i.recipe;if(t="B",f=!1,!o)return!1;oi(ii,"Navigate to Login");var a=be(o);if(a){L("call login:loadurl with "+a);var r=null;return g_CS_tops&&(r=g_CS_tops[e],g_ischrome&&0!=r&&L("loadurl is not sending to docnum==0 ! "+r)),sendCS(e,{cmd:"loadurl",url:a},r),Ni=!0,verbose_log("m_in_loadurl set"),_=o,n=i,f=!0,null}return!g_v2engine&&(function(e){var t=!1;if(!e)return null;void 0!==e.reveal_login_js_delay&&(t=!!e.reveal_login_js_delay);return t}(o)&&(f=!0,xt(o))?null:(rt(e,o,Re),!0))},this.check_is_logged_in=function(e,t,i){if(!t)return!1;var n={recipe:t,desc:"validate_website_is_loggedin",fn_required:Tt,fn_rejected:Ot,fn_url_success:jt,fn_url_failed:jt};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_website_is_loggedin returns true, no wait "),!0)},this.validate_login_success=function(e,t,i){if(!t)return!1;rt(e,t,je);var n={recipe:t,desc:"validate_login_success",fn_required:Lt,fn_rejected:Et,fn_url_success:tt,fn_url_failed:et};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_login_success returns true, no wait "),!0)},this.validate_login_entry_success=function(e,t,i){if(!t)return!1;rt(e,t,ze);var n={recipe:t,desc:"validate_login_entry_success",fn_required:Pt,fn_rejected:wt,fn_url_success:nt,fn_url_failed:it};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_login_entry_success returns true, no wait "),!0)},this.validate_cpw_success=function(e,t,i){if(!t)return!1;rt(e,t,Ve);var n={recipe:t,desc:"validate_cpw_success",fn_required:It,fn_rejected:At,fn_url_success:Ze,fn_url_failed:$e};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_cpw_success returns true, no wait "),!0)},this.validate_login_form=function(e,t,i){if(!t)return!1;var n={recipe:t,desc:"validate_login_form",fn_required:Ct,fn_rejected:ht,fn_url_success:jt,fn_url_failed:jt};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_login_form returns true, no wait "),!0)},this.validate_cpw_form=function(e,t,i){if(!t)return!1;var n={recipe:t,desc:"validate_cpw_form",fn_required:mt,fn_rejected:vt,fn_url_success:jt,fn_url_failed:jt};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_cpw_form returns true, no wait "),!0)},this.validate_login_entry_form=function(e,t,i){if(!t)return!1;var n={recipe:t,desc:"validate_login_entry_form",fn_required:Nt,fn_rejected:St,fn_url_success:jt,fn_url_failed:jt};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_login_entry_form returns true, no wait "),!0)},this.revert_password=function(e,t,i){return!!t&&(alert("REVERT: TODO"),!0)},this.initiate=function(e,t,i,n){},this.cpwbot_cs_finish_complete=function(e){verbose_log("cpwbot_cs_finish_complete on tabid="+e),i==e?(null!==CPWbot_bg.session_timeout_st_id&&clearTimeout(CPWbot_bg.session_timeout_st_id),CPWbot_bg.session_timeout_st_id=null,null!==CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id),CPWbot_bg.docaptcha_si_id=null,CPWbot_bg.mark_timestamp("finish_complete"),CPWbot_bg.logout(),Jt(e),CPWbot_bg.do_milestone(e,66,null)):null!==i&&verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+e+" g_pwchangetabid="+i)},this.finish_cpwbot_validate_state=function(e,n,s,c,f){verbose_log("ENTERED finish_cpwbot_validate_state");var g,p=!1,b=!1;if(i!=e)return verbose_log("finish_cpwbot_validate_state: !tabid, abort"),!1;if(n!=r){return verbose_log("finish_cpwbot_validate_state: ignoring stale request, current validate is "+l+"/"+r+", stale req is "+f+"/"+n+" "),!1}var m=Ut(_),v=r;if(k&&!W)return k=!1,W=!0,L("finish_cpwbot_validate_state: reload1 extending timeout for "+f),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(e,v,s,c,f)},m),!1;if(verbose_log("finish_cpwbot_validate_state: closing out request "+f+"/"+n),null===d)return verbose_log("finish_cpwbot_validate_state: dup, abort"),!1;if(null===g_CS[e])return lploggedin?(L("finish_cpwbot_validate_state: reload2 extending timeout for "+f),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(e,v,s,c,f)},m),!1):(verbose_log("finish_cpwbot_validate_state: tab "+e+" closed "),CPWbot_bg.panic("logged out?"),!1);var C=u;for(g_CS[e].length==d.length&&(b=!0),g=0;g<d.length;g++)if(d[g]){p=!0;break}b||verbose_log("finish_cpwbot_validate_state: sent out "+g_CS[e].length+" messages, received "+d.length+" messages, skipped "+C+" frames");var h,N=0,S=0;for(h in O)O.hasOwnProperty(h)&&(this.skip_frame_by_score(h)||(N++,d[h]&&S++));if(S<N&&console_warn("CASE : still waiting to hear from important frames, expected to hear from "+N+", heard from "+S),!p){var E=JSON.parse(s),P=JSON.parse(c);0==E.length&&P.length>0&&(p=!0)}if(d=null,a=null,u=0,g_v2engine)vi=!1,Wi=!1,L("VALIDATE_IN_DOCWAIT=false"),Fi=p,yi={},console_log("finish_cpwbot_validate_state complete result="+p+", wait for next engine cycle at "+t),pass;else{var w={aid:o,recipe:_,validate_result:p};console_log("finish_cpwbot_validate_state resumed initiate with state="+t),CPWbot_bg.initiate(e,w,t)}return!1},this.chk_cpw_resume=function(e,t){return!1},this.cpwbot_validate_state_result_handler=function(e,n){var _=!1;if(CPWbot_bg&&null!==i&&e==i){var o=n.docnum;if(void 0!==o&&CPWbot_bg&&null!==d){var s=JSON.parse(n.result),c=(JSON.parse(n.rejected_fields),JSON.parse(n.required_fields),!1),u=null;n.result_obj&&(u=JSON.parse(n.result_obj));var f=n.desc,g=n.id;if(L("received a "+f+" validate result from ["+e+"]["+o+"]["+n.url+"]["+n.docstate+"]["+n.state+"]="+s),l&&l!=f||r&&r!=g)return L("unexpected validate msg - perhaps from the last validate call.... ignoring it"),void L("got "+f+"/"+g+" expected "+l+"/"+r);var p=!1;u&&(n.required_url&&oi(ti,"["+e+"]["+o+"] validate given success_url, result="+u.url_success_match+" when matching success url = "+n.required_url),n.rejected_url&&oi(ti,"["+e+"]["+o+"] validate given bad_url, result="+u.url_failure_match+" when matching failure url = "+n.rejected_url),oi(ti,sprintf("[%s][%d] %s found %d/%d success fields, given %d invalid fields and %s invalid fields, %s captcha-ish fields",e,o,f,u.num_ok_matches,u.num_okfields,u.num_badfields,u.found_bad_match?"found":"did not find",u.found_interactive?"found":"did not find")),u.num_ok_matches>0?(ui(e,n),u.found_interactive&&(p=!0)):u.found_bad_match?(ui(e,n),p=!0):function(e,t){var i=t.docnum,n=t.url;if(null===O)return!1;null!==O[i]&&void 0!==O[i]||CPWbot_bg.clear_frame_score(e,i,n);O[i]=O[i]+-2}(e,n),u.found_interactive&&(c=!0)),d[o]=s;var b=di(e);if(null===g_CS[e]&&CPWbot_bg&&a)return L("interrupted by a page load/refresh, reissuing validate for state "+t),d=[],void sendCS(e,a,"all");g_CS[e]&&g_CS[e].length==d.length&&(_=!0),null===g_CS[e]?verbose_log("tab is reloading but cannot retry validate ? WTF"):verbose_log("["+e+"] "+f+" sent "+g_CS[e].length+" messages, heard from "+d.length+", skipped "+b+" frames"),(s||_||p||c)&&(d=null,null===s&&(s=!1),a=null,vi=!1,Wi=!1,L("VALIDATE_IN_DOCWAIT=false"),L("validate complete, result is "+s+" current state="+t),Fi=s,yi=u)}else debug&&L("stale2? validate result tabid="+e+" g_pwchangetabid="+i+" g_pwchange_validate_desc="+l)}else debug&&L("stale1? validate result tabid="+e+" g_pwchangetabid="+i+" g_pwchange_validate_desc="+l)},this.cpwbot_finish_ack_handler=function(e,t){if(null!==e&&t)if(sendCS(e,{cmd:"cpwbot_finish_ack"},"all"),sendCS(e,{cmd:"hide_cpwbot_overlay"},"all"),g_CS_tops[e]==t.docnum)CPWbot_bg.cpwbot_cs_finish_complete(e);else{if(null==g_CS_tops[e]||void 0===g_CS_tops[e])console_error("webpage has not finished loading");else{console_error("WTF : top "+g_CS_tops[e]+" but docnum is "+t.docnum);var i=getcsinfo(e,t.docnum),n=getcsinfo(e,g_CS_tops[e]);n&&verbose_log("["+g_CS_tops[e]+"] topdoc is "+n.url),i&&verbose_log("["+t.docnum+"] other doc is "+i.url),i&&i.parent_docnum==i.docnum?verbose_log("CS table says that "+t.docnum+" is top"):n&&n.parent_docnum==n.docnum?verbose_log("CS table says that "+g_CS_tops[e]+" is top"):verbose_log("CS table mismatch, or reloading ? ")}CPWbot_bg.cpwbot_cs_finish_complete(e)}},this.cpwbot_skip_url=function(e,t){return!1},this.originating_tabid=null,this.destination_tabid=null,this.originating_tab=null,this.destination_tab=null,this.logout=function(){t=null,o=null,_=null,n=null,a=null,l=null,r=null,0,i=null,s=null,pe(),h=!1,C=!1,O=null,k=!1,W=!1,c=null,this.clear_event_queue(),w=!1,I=!1,E=!1,P=!1,A=!1,N=!1,T=!1},this.initialize=function(e){e?(i=e.tabid,debug&&(Ui=e.tabid),_=e.recipe,o=e.aid,t=0,pe(),C=!1,N=!1,h=!1,g_robots_txt&&sendCS(e.tabid,{cmd:"get_robots_txt"},g_CS_tops[e.tabid]),O={},k=!1,W=!1,c=null,fi="",F=!1,y=!1,D=!1,R=!1,U=!1,M=!1,j=!1,Ci=0,CPWbot_bg.clear_event_queue(),Zi=1,ci(),V=!1,CPWbot_bg.broken_hearted_st_id=null,Ni=!1,Si=!1,Li=!1,Ei=!1,Vi=0,this.cpw_dialog_minimize_state=0):console_error("passed invalid params")},this.pwchangetabid_is_still_valid=function(){if(!CPWbot_bg)return!1;var e=i;return!(null===e||!g_CS||void 0===g_CS[e]||null===g_CS[e])},this.panic=function(e){e||(e="UNEXPECTED ERROR"),L("panic="+e+", g_pwchangetabid == "+i),CPWbot_bg.do_milestone(i,ie,_,e),bt(i),CPWbot_bg.cpwbot_cs_finish_complete(i)},this.setmsg_cpwbot_overlay=function(e,t){Vt(e,t)},this.initiate_on_complete=function(e,t,i){var n=null;if(!g_cpwbot||!CPWbot_bg||i>45)return CPWbot_bg.do_milestone(e,133,o,"initiate_on_complete"),CPWbot_bg.panic("TIMEOUT-initiate"),null;var _=t.aid,o=t.recipe;if(void 0!==i&&null!==i||(i=1),!ri(o)){var a=lt(_),r="(null)";a&&a.url&&(r=this.JSON.stringify(a.url));var l="Bad Recipe";oi(_i,l);var s="Error for recipe on aid="+_+", url="+r,c={severity:"fatal",msg:l};return CPWbot_bg.phone_home(null,null,c),CPWbot_bg.panic(s),null}if(!Bi){var u=ei(o);u||(u=900);var d=g_CS_tops[e];if(null!==d&&(n=getcsinfo(e,g_CS_tops[e]))&&"complete"==n.docstate){CPWbot_bg.mark_timestamp("doc_complete"),ping(e);var f=i?i*u/1e3:0;if(isNaN(f)&&verbose_log("WTF NaN: ctr="+i+" url="+r+" aid="+_),$i){var g=$i.doc_complete-$i.openurl_callback;g>0&&0!=$i.doc_complete&&$i.openurl_callback&&(f=g/1e3)}return f>0&&oi(ti,"Waited "+f+" seconds for document-complete before calling initialize_engine"),CPWbot_bg.initialize_engine(e,t)}return Bi||!lploggedin?(L("abort wait-for-doc-complete initiate"),!1):(null!==d?ping(e,d):ping(e),verbose_log("waiting for tabid "+e+" topdocnum="+d+" docstate="+(n?n.docstate:"null")),setTimeout(function(){CPWbot_bg.initiate_on_complete(e,t,i+1)},u),!0)}tn(e,o)},this.get_user_debug_messages=function(e,t){return v};var ti=0,ii=1,ni=2,_i=3;function oi(e,t){if((e<ti||e>_i)&&(e=ti),g_isfirefox&&lpisadmin||g_isdebug||g_isadmin){var i="["+["DEBUG","INFO","WARN","ERR"][e]+"] "+t+"\n";return v+=i,verbose_log(i),write_history({cmd:"CPW",msg:i}),!0}return!1}function ai(e,t){var i=!1;if(!t||!e)return debug&&L("validate_xpath: none"),i;try{var n=g_isfirefox?new e.defaultView.XPathEvaluator:new XPathEvaluator;if(!n&&debug)return L("NO XPATH EVALUATOR AVAILABLE ????"),!0;n.evaluate(t,e.documentElement,null,g_isfirefox?e.defaultView.XPathResult.FIRST_ORDERED_NODE_TYPE:XPathResult.FIRST_ORDERED_NODE_TYPE,null);i=!0}catch(e){console_error("error validating '"+t+"', exception: "+e),i=!1}return i}function ri(e){var t,i,n=g_isfirefox?LP.getBrowser().selectedTab.linkedBrowser.contentDocument:document;if(!n||!e)return L("Bad Recipe: none"),!1;if(!be(e))return L("Bad Recipe: no login url"),!1;if(!an(e))return L("Bad Recipe: no symbolic"),!1;if(!e.field_info||e.field_info.length<=0)return L("Bad Recipe: no fields"),!1;if(!li(e))return!1;var _=!1,o=!1,a=!1,r=!1,l=!1,s=!1,c=!1,u=!1,d=!1;for(t=0;t<e.field_info.length;t++)switch((i=e.field_info[t]).id_function){case FN_LOGIN:case FN_LOGIN_SUBMIT:case FN_PASSWORD:_=!0;break;case FN_CURRENT_PASS:case FN_NEW_PASS:case FN_NEW_PASS_CONFIRM:case FN_CPW_SUBMIT:l=!0;break;case FN_CPW_SUCCESS:case FN_CPW_SUCCESS_INVALID:s=!0;break;case FN_LOGIN_SUCCESS:case FN_LOGIN_SUCCESS_INVALID:a=!0;break;case FN_IS_LOGGED_IN:case FN_IS_LOGGED_IN_NEGATION:o=!0;break;case FN_NAVIGATE_TO_LOGOUT:u=!0}if((Ze(e)||$e(e)||Ve(e))&&(c=!0),(tt(e)||et(e)||je(e))&&(r=!0),Ce(e)&&(d=!0),!(_&&o&&(a||r)&&l&&(u||d)&&(s||c)))return L("Bad Recipe for "+an(e)+": has_login_fields?"+_+" has_logged_in_fields?"+o+" has_login_success_fields?"+a+" has_login_success_alt?"+r+" has_logout_field?"+u+" has_logout_alt?"+d+" has_cpw_fields?"+l+" has_cpw_success_fields?"+s+" has_cpw_success_alt?"+c),!1;for(t=0;t<e.field_info.length;t++)if((i=e.field_info[t]).id_type==TYPE_XPATH){if(!ai(n,i.id_value))return L("Bad Recipe: bad xpath"),!1;if(i.id_value&&i.id_value.indexOf("@clas,")>0)return L("Bad Recipe: @clas mispell"),!1}else if((i.id_type==TYPE_ID||i.id_type==TYPE_NAME)&&i.id_value&&(i.id_value.indexOf("//")>=0||i.id_value.indexOf("text()")>=0||i.id_value.indexOf("contents(")>=0))return L("Bad Recipe: xpath in non-xpath field def"),!1;return!0}function li(e){var t,i,n,_=!0,o={id_function:1,id_value:1,id_type:1};if(!e.field_info||e.field_info.length<=0)return!1;for(i=0;i<e.field_info.length;i++)for(n in(t=e.field_info[i])&&"number"!=typeof t.id_function&&(verbose_log(sprintf("field %s has invalid function '%s'",t.id_value,t.id_function)),_=!1),t)t.hasOwnProperty(n)&&(o[n]||(verbose_log(sprintf("found invalid field property '%s'",n)),_=!1));if(o={jsfrag:1,jstype:1},e.jsfrags&&e.jsfrags.length>0)for(i=0;i<e.jsfrags.length;i++)for(n in(t=e.jsfrags[i])&&"number"!=typeof t.jstype&&(verbose_log(sprintf("js with invalid type '%s'",t.jstype)),_=!1),t)t.hasOwnProperty(n)&&(o[n]||(verbose_log(sprintf("found invalid javascript property '%s'",n)),_=!1));if(o={length:1,maxlength:1,minlength:1,special:1,digits:1,upper:1,lower:1,mindigits:1},e.generate_pref_overrides)for(n in e.generate_pref_overrides)e.generate_pref_overrides.hasOwnProperty(n)&&(o[n]||(verbose_log(sprintf("found invalid generate preference '%s'",n)),_=!1));return _}function si(){return N||P||E||S||A||T||w||I}function ci(){N=!1,P=!1,E=!1,S=!1,A=!1,T=!1,w=!1,I=!1}function ui(e,t){var i=t.docnum,n=t.url;return null!==O&&(null!==O[i]&&void 0!==O[i]||CPWbot_bg.clear_frame_score(e,i,n),O[i]=O[i]+2,!0)}function di(e){if(null===O||null===e)return 0;var t,i,n,_=0;for(i in CS_table)CS_table.hasOwnProperty(i)&&(n=CS_table[i]).tabid===e&&(t=n.docnum,(CPWbot_bg.skip_frame_by_score(t)||skip_CS_by_score(e,t))&&_++);return _}this.userlog=function(e,t){return oi(e,t)},this.click_ack_handler=function(e,t){var i=t.docnum,n=t.url,_=t.docstate,o=t.msgid,a=t.pwchangestate,r=t.found;return L("[T:"+e+"][D:"+i+"] cpwbot click_ack on "+t.id_value+" found="+r+" url="+n+" docstate="+_+" pwchangestate="+a),c!=o?(console_error("response for last click request overlaps current click-wait, ignoring it, found="+r),L("m_pwchange_last_click_field_id="+c),L("found="+r+" msgid = "+o),r&&console_error("Bad Mojo"),!0):(r&&(N&&(N=!1),S&&(S=!1),P&&(P=!1),E&&(E=!1),w&&(w=!1),I&&(I=!1),A&&(A=!1),T&&(T=!1)),!0)},this.fill_ack_handler=function(e,t){t.docnum,t.url,t.docstate,t.msgid,t.pwchangestate,t.found;return verbose_log(sprintf("[%s][%s] cpwbot fill ack on %s found=%s docstate=%s url=%s req_id=%s",e,t.docnum,t.id_value,t.found,t.docstate?t.docstate:"null",t.url?t.url:"null",t.req_id?t.req_id:"null")),!0},this.js_ack_handler=function(e,t){var i="";try{i=JSON.parse(t.result)}catch(e){console_warn("js_ack_handler: "+e)}return verbose_log(sprintf("[%s][%s] cpwbot js ack result=%s docstate=%s url=%s req_id=%s",e,t.docnum,i?ofa(i):"null",t.docstate?t.docstate:"null",t.url?t.url:"null",t.req_id?t.req_id:"null")),!0},this.check_for_robots=function(e,t,i){},this.check_robot_txt=function(e,t,i){if(g_robots_txt){if(!e)return!0;be(e);if(null!==t){var n,_=0,o=t.split("\n"),a=!1,r=!1;for(_=0;_<o.length;_++)(0==(n=o[_]).length&&""==n||"\r"==n)&&(a=!1,r=!1),"#"!=n.charAt(0)&&(0!=n.indexOf("User-agent: LastPass")&&0!=n.indexOf("User-agent: *")?0!=n.indexOf("Disallow: /")||(r=!0):a=!0);return!a||!r}g_tmp_recipe=e}},this.score_frame=function(e,t){var i,n=t.docnum,_=t.url,o=0,a=lp_gettld_url(_),r=0,l=["doubleclick.net","appads.com","crwdcntrl.net","googleadservices.com","quantserve.com","questionmarket.com","advertising.com","zedo.com","checkm8.com","zvents.com","doubleclick.com","yldmgrimg.net","optmd.com","casalemedia.com","scorecardresearch.com","quotemedia.com","tacoda.net","daylife.com","brightcove.com","wibiya.com","clickability.com","stats.com","google-analytics.com","adfusion.com","2mdn.net","adsonar.com","everyclick.com","shopica.com","yeah.com","vectorportal.com","cnomy.com","phpbb.com","tracking101.com","revsci.net","revsci.com","atdmt.com","mmismm.com","googlesyndication.com","247realmedia.com","pointroll.com","bluekai.com","serving-sys.com","vizu.com","cleanprint.com","outbrain.com","tweetmeme.com","visiblemeasures.com","starwave.com","kaango.com","gabriels.net","overture.com","yieldmanager.net","2mdn.com","eyewonder.com","imgdownloads.com","liverail.com","adnxs.com","addthis.com","addthiscdn.com","imshopping.com","adtech.de","2o7.net","glanceguide.com","performgroup.com","undertone.com","undertonevideo.com","martiniadnetwork.com","chartbeat.net","omtrdc.net","zoomflow.com","crowdscience.com","imrworldwide.com","fwmrm.net","tremormedia.com","webtrends.com","adzerk.net","adzerk.com","qubitproducts.com","maxymiser.net","maxymiser.com","newrelic.com","mathtag.com","adroll.com","criteo.com","liveperson.com","getclicky.com","sitemeter.com","displaymarketplace.com","yieldmanager.com","media6degrees.com","betrad.com","360yield.com","adpredictive.com","burstnet.com","adtechus.com","adsafeprotected.com","turn.com","contextweb.com","p-td.com","lijit.com","rubiconproject.com","ru4.com","admeld.com","openx.net","pubmatic.com","localyokelmedia.com","qnsr.com","wrating.com","audienceiq.com","mydas.mobi","mopub.com","visualrevenue.com","adsymptotic.com","admob.com","adtrking.com","4dsply.com","adshostnet.com","adziff.com","33across.com","vindicosuite.com","securepaths.com","taboola.com","trk4.com","crwdcntrl.com","connexity.com","connexity.net","effectivemeasure.net","visualdna.com","amazon-adsystem.com","4dsply.com","adblade.com","doubleverify.com","technoratimedia.com","adjuggler.com","opbandit.com","iesnare.com","adexcite.com","adadvisor.net","agkn.com","dntx.com","revenuehits.com","tribalfusion.com"],s=["ads.cnn.com","metrics.post-gazette.com","ads.nwsource.com","adbox.sina.com.cn","ads.sina.com.cn","ad.afy11.net","avatar.cnn.com","ads.cnn.com","metrics.apple.com","trailers.apple.com","metrics.philly.com","adsatt.espn.go.com","player.ooyala.com","seg.sharethis.com","edge.sharethis.com","bender.spoutable.com","engine.spoutable.com"],c=["facebook.com/plugins","facebook.com/connect/xd_arbiter","youtube.com/embed/","platform.twitter.com/widget","platform.twitter.com/tweet_button","libsyn.com/embed","amazon.com/gp/widget"];for(g_CS_tops&&g_CS_tops[e]==t.docnum&&(o=100),i=0;i<l.length;i++)if(a==l[i]){o=-100,r=1;break}if(!r)for(i=0;i<s.length;i++)if(_.indexOf(s[i])>=0){o=-100,r=1;break}if(!r)for(i=0;i<c.length;i++)if(_.indexOf(c[i])>=0){o=-100,r=1;break}return O&&(O[n]=o),o},this.score_topdoc=function(e,t,i){if(null===O)return!1;null!==O[t]&&void 0!==O[t]||CPWbot_bg.clear_frame_score(e,t,i);var n=getcsinfo(e,t);return!!(n&&(state_param=n.flags,state_param&&state_param.has_frameset))||(O[t]=O[t]+100,!0)},this.clear_frame_score=function(e,t,i){return null!==O&&(O[t]=0,!0)},this.reset_scores=function(e){return O=null,!0},this.skip_frame_by_score=function(e){if(null===O||null===e)return!0;return L("skip? docnum ="+e+" score="+O[e]),O[e]<0},this.recompute_scores_for_tab=function(e){return!0},this.retry_validate=function(e,t){null===t&&(t="all"),a&&(d=[],sendCS(e,a,t))},this.wait_for_doc_complete=function(e,i,n,_,o,a){var r,l=_.aid,s=null,c=qt(_.recipe);o||(o=0);var u=ei(_.recipe);u||(u=900);var d=g_CS_tops[e];if(void 0===d&&(d=null),null!==i&&void 0!==i||(i=d),null!==i&&(r=getcsinfo(e,i))&&(s=r.docstate,g(r.docstate)&&g(a))){var f=o?o*u/1e3:0;return isNaN(f)&&verbose_log("WTF NaN: recursion_ctr="+o+" aid="+l),f>0&&oi(ti,sprintf("Waited %d seconds for %s on [tabid:%s][docnum:%d] to execute %s",f,c?"interactive":"complete",e,i,_.desc)),null!==CPWbot_bg.get_pwchangetabid()&&CPWbot_bg.in_validate()&&(Wi=!1,L("WAITED DONE, calling "+_.desc+" VALIDATE_IN_DOCWAIT=false")),n(e,_)}return Bi||!lploggedin||null===t?(L("abort wait-for-doc-complete "+_.desc),!1):(ping(e),verbose_log("waiting for tabid "+e+" topdocnum="+d+" passed_docnum="+i+" docstate="+(r?r.docstate:"null")+" last_state="+a),i!=d&&(console_error("edge case - top docnum changed due to page reload?  will wait for that instead"+i+"!="+d),i=d),setTimeout(function(){lploggedin&&CPWbot_bg&&CPWbot_bg.wait_for_doc_complete(e,i,n,_,o+1,s)},u),!0);function g(e){return c?"complete"==e||"interactive"==e:"complete"==e}},this.should_wait_for_document_complete=function(e,t){if(null===e||!t)return!1;var i=t.desc,n=t.recipe,_=!0,o=t.fn_url_failed,a=t.fn_url_success,r=t.fn_required,l=t.fn_rejected,s=r?r(n):[],c=l?l(n):[],u=t.target_url,d=t.target_field,f=t.target_js;if((void 0!==u&&null!==u||void 0!==d&&null!==d||void 0!==f&&null!==f)&&(_=!1),_){if(0==s.length&&0==c.length&&!a&&!o)return L("should_wait returns false, WARN: "+i+" has no field or url criteria defined to validate against"),!1}else if(!u&&!d&&!f)return L("should_wait returns false, no wait criteria, "+i),!1;return L("should_wait returns true for "+i+" is_validate="+_),!0},this.handle_challenge=function(e,t){},this.validate_challenge_page=function(e,t,i){if(!t)return!1;var n={recipe:t,desc:"validate_challenge_form",fn_required:kt,fn_rejected:Wt,fn_url_success:ot,fn_url_failed:_t};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_challenge_form returns false, no criteria to check, no wait"),!1)},this.force_validate_retry=function(e){k=e},this.validate_challenge_success=function(e,t,i){if(!t)return!1;rt(e,t,He);var n={recipe:t,desc:"validate_challenge_success",fn_required:Ft,fn_rejected:yt,fn_url_success:jt,fn_url_failed:jt};return CPWbot_bg.should_wait_for_document_complete(e,n)?(vi=!0,CPWbot_bg.wait_for_doc_complete(e,null,Mt,n),null):(L("validate_challenge_success returns true, no wait "),!0)};var fi="";function gi(e,t){null!==e&&null!==g_CS_tops[e]&&sendCS(e,{cmd:"do_result_div",msg:t},g_CS_tops[e])}this.set_dialog_msg=function(e){return fi=e,!0},this.get_dialog_msg=function(){return fi},this.clear_dialog_msg=function(){return fi="",!0},this.get_failstate=function(){return D},this.get_okstate=function(){return R},this.get_captchastate=function(){return U},this.get_docaptchastate=function(){return M},this.get_brokenheartstate=function(){return j},this.get_failpwsavedstate=function(){return Yi},this.get_fail_pending=function(){return C},this.get_success_pending=function(){return h},this.show_selenium_ok=function(e){gi(e,"OK")},this.show_selenium_fail=function(e){gi(e,"FAIL")},this.preinit=function(){t="preinit",H,pe(),fi="",v="",null!==CPWbot_bg.broken_hearted_st_id&&clearTimeout(CPWbot_bg.broken_hearted_st_id),CPWbot_bg.broken_hearted_st_id=null,Bi=!1,U=!1,M=!1,D=!1,j=!1,R=!1,Yi=!1},this.do_milestone=function(e,t,i,_){var o=null;if(i||(i={symbolic:""}),t,void 0!==_&&null!==_||(_=""),"undefined"!=typeof Date){var a="",r=(new Date).toString();if(de[t]){var l=an(i);l||(l=gs("unnamed site")),o=sprintf(de[t],l)}switch(t){case 1:case 2:break;case B:case 8:break;case Y:verbose_log("C: GOTO ACCTMGMT ");break;case x:verbose_log("D: REVEAL");break;case K:verbose_log("E: TRIGGER");break;case q:verbose_log("F: VALIDATE");break;case z:dt(e,i,n),rt(e,i,Xe),M=!0,g_isfirefox&&Vt(e,gs("The website needs you to enter information. Please close this overlay and enter it."),i,!0),Jt(e),CPWbot_bg.session_timeout_st_id&&(clearTimeout(CPWbot_bg.session_timeout_st_id),CPWbot_bg.session_timeout_st_id=null),CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id),CPWbot_bg.docaptcha_si_id=setInterval(function(){M&&Mt(e,{desc:"docaptcha",recipe:i,fn_required:Dt})},1e3);break;case 63:oi(ii,"Saved and Replaced"),R=!0,(debug||g_isdebug)&&(oi(ii,"showing selenium ok result"),CPWbot_bg.show_selenium_ok(e)),h=!0,CPWbot_bg.mark_timestamp("success");break;case 65:oi(ii,g_v2engine?sprintf("[%s] v2 %s",r,gs("BEGIN")):sprintf("[%s] %s",r,gs("BEGIN")));break;case 66:oi(ii,g_v2engine?sprintf("[%s] v2 %s",r,gs("End").toUpperCase()):sprintf("[%s] %s",r,gs("End").toUpperCase()));break;case 67:verbose_log("USER IS ALREADY LOGGED IN, SKIP LOGIN STATE"),oi(ii,"Appears to be Logged Into Site");break;case te:case X:oi(ii,"Filling Login Form");break;case ee:case Q:oi(ii,"Submit Login Form");break;case Z:oi(ii,"Going to Login"),verbose_log("B: GOTO LOGIN");break;case $:oi(ii,"Perform Logout");break;case 72:1!=Zi&&oi(ii,sprintf("Adjusting for %s site, %6.2f",Zi>1?"slow":"fast",Zi));break;case 73:Yi=!0,oi(ii,"Generated Random Password and Saved to Vault");break;case ie:a="UNEXPECTED ERROR";break;case oe:a="FILL LOGIN FORM [PW CHALLENGE] FAILED!";break;case ae:a="SUBMIT LOGIN FORM [PW CHALLENGE] FAILED!";break;case re:a="Expected Change-Password Form";break;case 135:a="Change Password Failed";break;case _e:a="Expected Login Form";break;case ne:case ue:a="Login to Website Failed!";break;case 136:a="Unable to Save New Password";break;case le:a="Unable to Log Out of Website";break;case 133:a=gs("Timed out waiting for the page to load.  Retry?"),j=!0;break;case 140:a="Session Timeout";break;case se:a="Halt Requested";break;case ce:U=!0,a="Interaction required; cannot proceed";break;case H:default:o=""}if((t&ie)==ie){D=!0,oi(_i,a),(debug||g_isdebug)&&(oi(ii,"showing selenium fail result"),CPWbot_bg.show_selenium_fail(e)),C=!0,CPWbot_bg.mark_timestamp("fail");var s={severity:"fatal",msg:sprintf("%s[debug=%s]",a,_)};CPWbot_bg.phone_home(e,i,s),Yi&&(o=sprintf(de[248],an(i)))}else 64==(64&t)&&(o="");if(o&&(Vt(e,o,i),CPWbot_bg.set_dialog_msg(o)),CPWbatch&&CPWbatch.cpw_get_batchjob_state()!=F_NONE){63==t?"OK":133==t||140==t?"TIMEOUT":(t&ie)==ie&&133!=t&&140!=t&&"FAIL"}return CPWbatch&&CPWbatch.conditional_website_status_update({tabid:e,recipe:i,state:t,msg:o}),!0}};var pi=null,bi=null,mi=null,vi=!1,Ci=(vi=!1,0),hi=[],Ni=!1,Si=!1,Li=!1,Ei=!1,Pi=!1,wi=!1,Ii=!1,Ai=!1,Ti=!1,Oi=!1,ki=!1,Wi=null,Fi=null,yi={},Gi=null,Di=null,Ri=null,Ui=null,Mi=null,ji=null,Vi=0,Ji=10,Hi=null,Bi=!1,Yi=!1;function xi(e,n){var _=Xt(n);_||(_=DEFAULT_SESSION_TIMEOUT),null!==Zi&&Zi>0&&!isNaN(Zi)&&(_*=Zi);var o=CPWbot_bg.get_session();CPWbot_bg.session_timeout_st_id=setTimeout(function(){if(o==CPWbot_bg.get_session()){CPWbot_bg.mark_timestamp("session_timeout");var n=CPWbot_bg.get_timestamp("session_timeout")-CPWbot_bg.get_timestamp("initial_cycle");if(verbose_log(sprintf("session timeout at %6.2f seconds after T=0",n/1e3)),verbose_log("SESSION TIMEOUT WAKEUP"),!C&&!h&&i==e)return nn("timeout: a change is still running ? tabid="+e+"last state ="+t),void CPWbot_bg.panic("session timeout");bt(e),CPWbot_bg.cpwbot_cs_finish_complete(e)}else verbose_log("stale timeout")},_)}this.broken_hearted_st_id=null,this.session_timeout_st_id=null,this.docaptcha_si_id=null;function Ki(e,i,n){verbose_log("B1: validate_login_form "),t="B1";var _,o={aid:n.aid,recipe:i};return null===(_=CPWbot_bg.validate_login_form(e,i,o))?(verbose_log("B1: validate_login_form / CS callout "),Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),null):_?(do_A4(e,i,n),!0):(CPWbot_bg.do_milestone(e,_e,i,""),bt(e),!1)}function qi(e,t,i){setTimeout(function(){lploggedin&&CPWbot_bg&&CPWbot_bg.engine(e,t,i)},250)}function zi(e,t){var i=m_lastclick_metadata;Vi>Ji&&verbose_log("too many click retries"),i&&(oi(ii,"Retry Click"),verbose_log("tabid="+e+" id_type="+i.id_type+" id_value="+i.id_value),sendCS(e,i,t),Vi++)}function Xi(e){return(new Date).getTime()>Mi&&!ji&&(ji=!0,zi(e,"all"),!0)}function Qi(e,t){return L(sprintf("[%s] time factor adjustment=%6.2f",an(e),t)),!0}this.engine=function(e,i,_){var o=_.aid,c=_.recipe,u=(new Date).getTime(),d=!1;if(0==Ci&&(CPWbot_bg.mark_timestamp("initial_cycle"),function(e){$i&&$i.initial_cycle-$i.dopwchange>1e4&&0!=$i.initial_cycle&&0!=$i.dopwchange&&Qi(e,Zi=2)}(c),CPWbot_bg.do_milestone(e,72,c),null!==CPWbot_bg.broken_hearted_st_id&&clearTimeout(CPWbot_bg.broken_hearted_st_id),CPWbot_bg.broken_hearted_st_id=null,xi(e,c)),te("engine awaken tick="+ ++Ci),null!==t){if(!Bi&&lploggedin){if(!M){var v=Xt(c);v||(v=DEFAULT_SESSION_TIMEOUT);var C=CPWbot_bg.get_timestamp("docaptcha_success");if(C||(C=CPWbot_bg.get_timestamp("initial_cycle")),C||(C=pi),u>C+v*Zi)return d=!0,CPWbot_bg.do_milestone(e,140,c,"engine"),void CPWbot_bg.panic("TIMEOUT-engine")}var h=Ut(c);if(vi&&mi>0&&u>mi+h&&(!function(){var e;for(e=0;e<hi.length;e++)if("validate_response"==hi[e].type)return!0;return!1}()?(Wi=!1,L("ENGINE - VALIDATE_IN_DOCWAIT=false"),CPWbot_bg.finish_cpwbot_validate_state(e,r,Di,Ri,l)):pass),i&&m){if(!(u>bi))return te("CONTINUE SLEEPING"),void qi(e,t,_);te("AWAKEN FROM SLEEP")}var T,O;for(T=0;T<hi.length;T++){var k=(O=hi[T]).data.docnum;switch(te(sprintf("[%s][%s] processing event#%d cmd=%s",e,k,T,O.data.cmd)),O.type){case"validate_response":CPWbot_bg.cpwbot_validate_state_result_handler(O.tabid,O.data);break;case"fill_ack":CPWbot_bg&&CPWbot_bg.fill_ack_handler(O.tabid,O.data);break;case"click_ack":CPWbot_bg&&CPWbot_bg.click_ack_handler(O.tabid,O.data);break;case"js_ack":CPWbot_bg&&CPWbot_bg.js_ack_handler(O.tabid,O.data);break;case"finish_ack":CPWbot_bg&&CPWbot_bg.cpwbot_finish_ack_handler(O.tabid,O.data);break;case"loadurl":if(g_CS_tops&&g_CS_tops[e]==k)switch(Ni&&(Ni=!1,te("m_in_loadurl cleared")),te("loadurl/setprefs against top :"+g_CS_tops[e]+" == "+k+" start_state="+CPWbot_bg.get_pwchangestate()),t){case"A1":case"A2":case"A3":case"M":case"B1":case"F":CPWbot_bg&&a&&(CPWbot_bg.force_validate_retry(!0),CPWbot_bg.retry_validate(e));break;case"B1R":case"A3R":break;case"FK0":case"FKLL0":break;case 0:case"0":te("engine called in initial state - ignoring")}else null!==CPWbot_bg.get_pwchangetabid()&&CPWbot_bg.in_validate()?(L("processing loadurl event, reissue last validate to new doc ["+e+"]["+k+"]"),CPWbot_bg.retry_validate(e,k)):null!==CPWbot_bg.get_pwchangetabid()&&si()&&(L("loadurl sent while waiting for a click, issue last click to new frame"+k),!0,zi(e,k));break;case"unload":break;default:te("need to handle this msg: "+O.data.cmd)}}CPWbot_bg.clear_event_queue(),te("current state is "+t);var W=n;switch(t&&null===W&&(W={aid:o}),t){case 0:!function(e,i,n){t="A1";var o=CPWbot_bg.check_is_logged_in(e,i,n);null===o?(verbose_log("A1: check_is_logged_in / CS callout "),Wi=!0,L("VALIDATE_IN_DOCWAIT=true")):(verbose_log("A1: check_is_logged_in returns "+o+" no CS callout "),(o=Fi)?G?Me(e,i,_):ie(e,i,_):Ne(e,i,_))}(e,c,W);break;case"A1":if(CPWbot_bg.in_validate()||Wi)te("waiting for validate to end, "+t),pass;else if(Li)te("waiting for doc-complete for Cnav, "+t),pass;else if(vi)te("A1: wait on m_in_validate");else{var F=Fi;F?G?(CPWbot_bg.do_milestone(e,67,c),Me(e,c,_)):(verbose_log("short-circuiting logout/L state"),CPWbot_bg.do_milestone(e,67,c),ie(e,c,_)):null===F?CPWbot_bg.alert("A1 unexpected"):Ne(e,c,_)}break;case"A3R":w?(te("waiting for click_ack, "+t),Xi(e),pass):Ni?(te("waiting for loadurl , "+t),pass):Se(e,c,_);break;case"B1Rpre":!function(e,i,n){I=!1;var _=Ie(i);{if(_){t="B1R",verbose_log("B1R: login-form-reveal"),verbose_log("click on FN_REVEAL_LOGIN field!");var o=DEFAULT_CLICK_DELAY;void 0!==i.login_reveal_delay&&(o=i.login_reveal_delay),I=!0,verbose_log("now waiting for click_ack B1R");var a=he(i);return ut(e,_,o,a),CPWbot_bg.mark_timestamp("wait_for_click_ack_B1R"),null}Ki(e,i,n)}}(e,c,_);break;case"B1R":I?(te("waiting for click_ack, "+t),Xi(e),pass):Ni?(te("waiting for loadurl , "+t),pass):vi?te("B1R: wait on m_in_validate"):Ki(e,c,_);break;case"B1":if(CPWbot_bg.in_validate()||Wi)te("waiting for validate to end, "+t),pass;else if(vi)te("B1: wait on m_in_validate");else{var y=Fi;if(yi&&yi.found_interactive)return console_error("B1: found interactive field"),void on(e,c);if(!y){debug&&g_innerHTML_debug&&yi.innerhtml&&verbose_log("VALIDATE FAILURE, final innerHTML is "+yi.innerhtml);var D="";return CPWbot_bg.do_milestone(e,_e,c,D),void bt(e)}Ae(e,c,_)}break;case"A2":if(CPWbot_bg.in_validate()||Wi)te("waiting for validate to end, "+t),pass;else if(vi)te("A2: wait on m_in_validate");else if(Li)te("A2: wait on navigate");else{if(yi&&yi.found_interactive)return console_error("A2: found interactive field"),void on(e,c);if(!Fi){D="";return CPWbot_bg.do_milestone(e,ne,c,D),void bt(e)}ie(e,c,_)}break;case"A3":if(CPWbot_bg.in_validate()||Wi||vi)te("waiting for validate to end, "+t),pass;else{y=Fi;if(yi&&yi.found_interactive)return console_error("A3: found interactive field"),void on(e,c);y?(te("A3: has login form, calling do_A4"),yi&&yi.found_interactive&&te("A3: found_interactive=true"),Ae(e,c,_)):(debug&&g_innerHTML_debug&&yi.innerhtml&&verbose_log("VALIDATE FAILURE, final innerHTML is "+yi.innerhtml),De(e,c,_))}break;case"M":if(CPWbot_bg.in_validate()||Wi||vi)te("waiting for validate to end, "+t),pass;else{var R=Fi;if(yi&&yi.found_interactive)return console_error("M: found interactive field"),void on(e,c);R?function(e,i,n){CPWbot_bg.mark_timestamp("login_entry");verbose_log("M4: FILL LOGIN"),t="M4";if(!gt(e,i,W))return CPWbot_bg.do_milestone(e,_e,i,""),bt(e),!1;(function(e,i,n){verbose_log("M5: SUBMIT LOGIN ENTRY"),t="M5";var _=1100,o=zt(i);o&&(_=o);_&&verbose_log("waiting "+_+" ms after login waiting for site to bootstrap");var a=pt(e,i);!1===a?(CPWbot_bg.do_milestone(e,ue,i,""),bt(e)):null===a?_&&(m=!0,u,bi=u+_):Ve(e,i,n)})(e,i,n)}(e,c,_):(verbose_log("did not find initial stage login form"),yi.innerhtml&&verbose_log("final innerHTML is "+yi.innerhtml),_.check_login_entry_form=!1,we(e,c,_))}break;case"M2":if(CPWbot_bg.in_validate()||Wi)te("waiting for validate to end, "+t),pass;else if(vi)te("M2: wait on m_in_validate");else if(Li)te("M2: wait on navigate");else{if(yi&&yi.found_interactive)return console_error("M2: found interactive field"),void on(e,c);if(!Fi){D="";return yi&&(D=sprintf("found_bad_match=%s, num_ok_matches=%s, retval=%s, url_success_match=%s, url_failure_match=%s",yi.found_bad_match,yi.num_ok_matches,yi.retval,yi.url_success_match,yi.url_failure_match)),CPWbot_bg.do_milestone(e,ue,c,D),void bt(e)}_.check_login_entry_form=!1,we(e,c,_)}break;case"A4":break;case"A5":Ge(e,c,_);break;case"M5":Ve(e,c,_);break;case"A":console_warn("engine state=A todo");break;case"B":Ni?(te("waiting for loadurl to complete, "+t),pass):Pi?(te("waiting for doc-complete after loadurl, "+t),pass):Ue(e,c,_);break;case"Bsleep":Pi?(te("waiting for doc-complete after loadurl, "+t),pass):Ue(e,c,_);break;case"C":if(E)te("waiting for click_ack, "+t),Xi(e),pass;else if(Ni)te("waiting for loadurl , "+t),pass;else if(Ei)te("waiting for reveal-cpw doc-complete, "+t),pass;else{void 0===(ee=g_CS_tops[e])&&(ee=null);var U=null;if(null!==ee)if(U=getcsinfo(e,ee)){var j=U.docstate;"complete"==U.docstate&&"complete"==j?(te("C: wait completed "+t),se(e,c,_)):te("C: wait docstate:"+U.docstate+",last:"+j)}else te("C: fail");else te("C: wtf - wait for page to finish loading?");null!==ee?ping(e,ee):ping(e)}break;case"Cnav":L("aid = "+Gi.payload.aid),CPWbot_bg.navigate_to_acctmgmt(e,Gi),Gi=null;break;case"Cpickup":E&&(L("still waiting for click-C"),te("waiting for click_ack, "+t),Xi(e)),Ei?L("still waiting for document-complete to run reveal_cpw"):se(e,c,_);break;case"A3Rsleep":Se(e,c,_);break;case"B1Rsleep":we(e,c,_);break;case"Csleep":Ei?L("still waiting for document-complete to run reveal_cpw"):se(e,c,_);break;case"Dpickup":iscpwfast()&&CPWbatch.conditional_website_status_update({aid:o,state:76,msg:"SLOW"}),P?(L("still waiting for click-D"),te("waiting for click_ack, "+t),Xi(e)):de(e,c,_);break;case"Dsleep":de(e,c,_);break;case"Epickup":iscpwfast()&&CPWbatch.conditional_website_status_update({aid:o,state:76,msg:"SLOW"}),N?(L("still waiting for click-E"),te("waiting for click_ack, "+t),Xi(e)):(_.validate_result=null,Ce(e,c,_));break;case"Esleep":_.validate_result=null,Ce(e,c,_);break;case"D":if(te("engine handle D"),P||Ni)P?(te("waiting for click_ack, "+t),Xi(e)):te("waiting for load to complete, "+t),pass;else{void 0===(ee=g_CS_tops[e])&&(ee=null);U=null;if(null!==ee)if(U=getcsinfo(e,ee)){j=U.docstate;"complete"==U.docstate&&"complete"==j?(te("D: wait completed "+t),de(e,c,_)):te("D: wait docstate:"+U.docstate+",last:"+j)}else te("D: fail");else te("D: wtf - wait for page to finish loading?");null!==ee?ping(e,ee):ping(e)}break;case"Dreveal":CPWbot_bg.reveal_cpw(e,Gi);Gi=null;break;case"D1":if(CPWbot_bg.in_validate()||Wi)te("waiting for validate to end, "+t),pass;else if(vi)te("D1: wait on m_in_validate");else if(Si)te("D1: wait on doc-complete for trigger_cpw");else{var V=Fi;if(yi&&yi.found_interactive)return console_error("D1: found interactive field"),void on(e,c);V?pe(e,c,_):fe(e,c,_)}break;case"D2":if(CPWbot_bg.in_validate()||Wi)te("waiting for validate to end, "+t),pass;else if(vi)te("D2: wait on m_in_validate");else{if(!Fi){D="";return CPWbot_bg.do_milestone(e,re,c,D),void bt(e)}ge(e,c,_)}break;case"D4":break;case"D5":S?(te("waiting for click_ack, "+t),Xi(e)):Si?te("D5: wait on doc-complete for trigger_cpw"):pe(e,c,_);break;case"D3":console_error("D3 reached - should not happen");break;case"D_validate_cpw_form":Mt(e,Gi),Gi=null;break;case"E":console_error("E: should not occur");break;case"Etrigger":N?(te("waiting for click_ack, "+t),Xi(e)):Ni?console_error("Etrigger: m_in_loadurl should not happen"):vi?console_error("Etrigger: m_in_validate should not happen"):(CPWbot_bg.trigger_cpw(e,Gi),Gi=null);break;case"F":if(CPWbot_bg.in_validate()||Wi)te("waiting for validate to end, "+t),pass;else if(Ni)te("waiting for loadurl and doc-complete"),pass;else if(vi)te("F: wait on m_in_validate"),pass;else{CPWbot_bg.bagration();var J=Fi;if(null!==J){verbose_log("F: VALIDATE return from CS, returned "+J),debug&&g_innerHTML_debug&&Fi.innerhtml&&!J&&verbose_log("VALIDATE FAILURE, final innerHTML is "+Fi.innerhtml);D="";if(J)if(verbose_log("cpwbot initiate: validate cpw succeeded, now updating user record"),function(e,t,i){if(!t||!i)return!1;oi(ii,"Updating with New Password");var n=!0,_=i.aid;console_log("cpwbot initiate: save_replace for aid="+_);var o=lt(_);if(!o)return _n("given invalid aid - data consistency error?"),!1;var a=lpdec_acct(i.newpw,o,"undefined"==typeof g_shares?lpshares:g_shares),r=lpdec_acct(i.curpw,o,"undefined"==typeof g_shares?lpshares:g_shares);if(o&&a&&r)if(o.pwprotect&&(n=!1),console_log("cpwbot initiate: calling changepw logic for aid="+_),g_isfirefox)(n||LP.securityPrompt())&&lpchangepw(null,a,_,null,null,null,!0);else{var l={singleaid:_.toString(),newpw:a,autochange:1};n?changepw_wrapper(l):security_prompt(function(){changepw_wrapper(l)})}else verbose_log("no passwords to save? acct.aid = "+(o?o.aid:"null")+" cur="+(g_show_pw_in_logs||g_isadmin?r:"REDACTED")+" newpw="+(g_show_pw_in_logs||g_isadmin?a:"REDACTED"));return!0}(0,c,W)){CPWbot_bg.do_milestone(e,63,c);var H=lt(o),z=lpdec_acct(s,H,"undefined"==typeof g_shares?lpshares:g_shares),X=be(c),Q=lp_gettld_url(X);verbose_log('remember to g_didchangepw for pw="'+(g_show_pw_in_logs||g_isadmin?z:"REDACTED")+'" tld='+Q),remember_changed_pw(z,Q)||verbose_log('save to g_didchangepw failed for pw="'+(g_show_pw_in_logs||g_isadmin?z:"REDACTED")+'" tld='+Q),function(e,t,i){if(Je(t)){var n=1234,_=(a=0,(o=t)?(void 0!==o.js_finish_delay&&(a=o.js_finish_delay),a):null);_&&(n=_),setTimeout(function(){CPWbot_bg.conditional_js_exec(e,t,Je)},n)}var o,a;console_error("The End.")}(e,c)}else CPWbot_bg.do_milestone(e,136,c,D);else CPWbot_bg.do_milestone(e,135,c,D)}bt(e),d=!0}break;case"G":break;case"L":if(A)te("waiting for click_ack, "+t),Xi(e),pass;else if(Ni)te("waiting for loadurl , "+t),pass;else{var ee;void 0===(ee=g_CS_tops[e])&&(ee=null);U=null;null!==ee&&((U=getcsinfo(e,ee))?"complete"==U.docstate&&(te("L: wait completed "+t),je(e,c,_)):te("L: fail")),null!==ee?ping(e,ee):ping(e)}break;case"Lsleep":je(e,c,_);break;case"Bagration":case"FK0":case"FK1":case"FK2":case"FKI":break;case"FK3":Ne(e,c,_);break;case"FKLL0":case"FKLL1":case"FKLL2":case"FKLLI":break;case"FKLL3":ie(e,c,_);break;default:pass}return void(d||qi(e,t,_))}tn(e,c)}else bt(e);function te(e){if(debug){e=sprintf("[%s][%s] : %s",(new Date).toString(),"engine",e);console_log(e)}}function ie(e,i,n){var _,o={aid:n.aid,recipe:n.recipe};verbose_log("do_C "+t),CPWbot_bg.do_milestone(e,Y,i);var a={desc:"navigate_to_acctmgmt",didcallout:!1,payload:o,recipe:i,target_field:Ee(i),target_js:ke(i)+""+We(i),target_url:ve(i)};return CPWbot_bg.should_wait_for_document_complete(e,a)?(L("wrapped navigate_to_acctmgmt around wait-for-document-complete"),a.didcallout=!0,Li=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,i){L("Cnav milestone"),t="Cnav",Gi=i},a),_=null):(a.didcallout=!1,L("execute navigate_to_acctmgmt, no wait "),_=CPWbot_bg.navigate_to_acctmgmt(e,a)),null===_?(L("callout to CS : navigate_to_acctmgmt"),_):(!1===_&&console_error("C error"),L("execute navigate_to_acctmgmt, no wait "),ce(e,i,n))}function se(e,i,n){m=!1;var _=Bt(i);return _||(_=2500),_&&!Ai?(t="Csleep",L("C sleeping "+_),m=!0,u,bi=u+_,Ai=!0,null):(Ai=!0,p&&rt(e,i,We),ce(e,i,n))}function ce(e,i,n){var _;verbose_log("do_D "+t);var o={aid:n.aid,recipe:n.recipe};Ei=!1,CPWbot_bg.do_milestone(e,x,i);var a={desc:"reveal_cpw",payload:o,recipe:i,didcallout:!1,target_field:Le(i),target_js:Te(i)+""+Oe(i),target_url:me(i)};return CPWbot_bg.should_wait_for_document_complete(e,a)?(L("wrapped reveal_cpw around wait-for-document-complete"),a.didcallout=!0,Ei=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,i){L("Dreveal milestone"),t="Dreveal",Gi=i},a),_=null):(a.didcallout=!1,L("execute reveal_cpw, no wait "),_=CPWbot_bg.reveal_cpw(e,a)),_?(L("execute reveal_cpw, no wait "),pe(e,i,n)):(L("callout to CS : reveal_cpw"),_)}function de(e,i,n){m=!1;var _=Yt(i);return _||(_=2500),_&&!Ti?(t="Dsleep",L("D sleeping "+_),m=!0,u,bi=u+_,Ti=!0,null):(Ti=!0,g&&rt(e,i,Oe),function(e,i,n){L("entered do_D1");var _={aid:n.aid,recipe:i};t="D1";var o=null;if(null===(o=CPWbot_bg.validate_cpw_form(e,i,_)))return verbose_log("D1: validate_cpw_form / CS callout "),Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),null;if(!o)return fe(e,i,n)}(e,i,n))}function fe(e,i,n){var _={aid:n.aid,recipe:i};t="D2";return null===CPWbot_bg.validate_login_form(e,i,_)?(Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),verbose_log("D2: validate_login_form / CS callout "),null):J?ge(e,i,n):(CPWbot_bg.do_milestone(e,re,i,""),bt(e),!1)}function ge(e,i,n){t="D4",verbose_log("D4: FILL LOGIN/CHALLENGE");return dt(e,i,W)?function(e,i,n){verbose_log("D5: SUBMIT LOGIN"),t="D5";var _=1100,o=zt(i);o&&(_=o);_&&verbose_log("waiting "+_+" ms after login waiting for site to bootstrap");var a=ft(e,i);return!1===a?(CPWbot_bg.do_milestone(e,ae,i,""),bt(e),!1):null===a?(_&&(m=!0,u,bi=u+_),null):pe(e,i,n)}(e,i,n):(CPWbot_bg.do_milestone(e,oe,i,""),bt(e),!1)}function pe(e,i,n){var _;verbose_log("do_E "+t);var o={aid:n.aid,recipe:n.recipe};CPWbot_bg.do_milestone(e,K,i);var a={desc:"trigger_cpw",payload:o,recipe:i,target_field:Pe(i),target_js:Fe(i)+""+ye(i),target_url:null};return CPWbot_bg.should_wait_for_document_complete(e,a)?(L("wrapped trigger_cpw around wait-for-document-complete"),a.didcallout=!0,Si=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,i){L("Etrigger milestone"),t="Etrigger",Gi=i},a),_=null):(a.didcallout=!1,L("execute trigger_cpw, no wait "),_=CPWbot_bg.trigger_cpw(e,a)),_?(L("execute trigger_cpw, no wait "),Ce(e,i,n)):(L("callout to CS : trigger_cpw"),_)}function Ce(e,i,n){m=!1;var _,o,a,r,l=(o=0,(_=i)?(void 0!==_.posttrigger_sleep&&(o=_.posttrigger_sleep),o):null);return l||(l=2500),l&&!Oi?(t="Esleep",L("E sleeping "+l),m=!0,u,bi=u+l,Oi=!0,null):(Oi=!0,n.validate_result=null,a=e,r=i,CPWbot_bg.mark_timestamp("verify_cpw"),CPWbot_bg.do_milestone(a,q,r),t="F",null===CPWbot_bg.validate_cpw_success(a,r,W)?(verbose_log("F: VALIDATE callout to CS"),Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),null):(verbose_log("F: VALIDATE no callout to CS"),nn("no verify-cpw criteria defined"),CPWbot_bg.panic("fail"),!1))}function Ne(e,i,n){CPWbot_bg.do_milestone(e,B,i);var _=Ie(i);if(_){t="A3R",verbose_log("A3R: login-form-reveal");var o=DEFAULT_CLICK_DELAY;return void 0!==i.login_reveal_delay&&(o=i.login_reveal_delay),w=!0,L("now waiting for click_ack A3R"),ut(e,_,o,he(i)),CPWbot_bg.mark_timestamp("wait_for_click_ack_A3R"),null}return Se(e,i,n)}function Se(e,i,n){L("post_A3R"),m=!1;var _=xt(i);return verbose_log("A3R sleepval="+_),_||(_=1e3),_&&!wi?(t="A3Rsleep",L("A3R sleeping "+_),m=!0,u,bi=u+_,wi=!0,null):(wi=!0,n.validate_result=null,verbose_log("calling reveal JS after A3 state"),rt(e,i,Re),we(e,i,n))}function we(e,i,n){CPWbot_bg.do_milestone(e,B,i);var _=!0;if(void 0!==n.check_login_entry_form&&(_=!!n.check_login_entry_form),t="A3",_&&function(e){var t,i=[],n=[FN_LOGIN_ENTRY_USERNAME,FN_LOGIN_ENTRY_PASSWORD,FN_LOGIN_ENTRY_SUBMIT];for(t=0;t<n.length;t++){var _=Rt(e,n[t]);_&&_.length>0&&(i=i.concat(_))}return i}(i)){verbose_log("M: validate_login_entry_form"),CPWbot_bg.mark_timestamp("login_entry"),t="M";var o;if(verbose_log("calling validate_login_entry_form"),null===(o=CPWbot_bg.validate_login_entry_form(e,i,W)))return verbose_log("M: validate_login_entry_form / CS callout "),Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),null;verbose_log("M: validate_login_entry_form returns "+o+" no call to CS")}verbose_log("A3: validate_login_form"),t="A3";var a;return verbose_log("calling validate_login_form"),null===(a=CPWbot_bg.validate_login_form(e,i,W))?(verbose_log("A3: validate_login_form / CS callout "),Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),null):(verbose_log("A3: validate_login_form returns "+a+" no call to CS"),a?Ae(e,i,n):De(e,i,n))}function Ae(e,i,n){CPWbot_bg.mark_timestamp("login_cpw");verbose_log("A4: FILL LOGIN"),t="A4";return dt(e,i,W)?function(e,i,n){verbose_log("A5: SUBMIT LOGIN"),t="A5";var _=1100,o=zt(i);o&&(_=o);_&&verbose_log("waiting "+_+" ms after login waiting for site to bootstrap");var a=ft(e,i);return!1===a?(CPWbot_bg.do_milestone(e,ne,i,""),bt(e),!1):null===a?(_&&(m=!0,u,bi=u+_),null):Ge(e,i,n)}(e,i,n):(CPWbot_bg.do_milestone(e,_e,i,""),bt(e),!1)}function Ge(e,i,n){verbose_log("A2: validate_login_success "),t="A2";var _;if(null===(_=CPWbot_bg.validate_login_success(e,i,W)))return verbose_log("A2: validate_login_success / CS callout "),Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),null;if(verbose_log("A2: validate_login_success "+_+" no CS callout "),!_)return CPWbot_bg.do_milestone(e,ne,i,D),bt(e),retval;if(g_cpw_do_fakeui){var o=function(e,i,n){if(!i||!n||null===e)return 0;if(!g_cpw_do_fakeui)return 0;return t="FKLL0",verbose_log("entered do_logged_in_fake_ui"),0}(e,i,n),a=$t(i);setTimeout(function(){ie(e,i,n)},a*o+1021)}else ie(e,i,n)}function De(e,t,i){CPWbot_bg.mark_timestamp("navlogin_cpw"),0,CPWbot_bg.do_milestone(e,Z,t);var n={aid:i.aid,recipe:i.recipe},_=CPWbot_bg.navigate_to_login(e,n);_&&Ue(e,t,i)}function Ue(e,i,n){verbose_log("post_B"),m=!1;var _=xt(i);_||(_=1e3),_&&!Ii?(t="Bsleep",L("B sleeping "+_),m=!0,u,bi=u+_,Ii=!0):(Ii=!0,n.desc="post_B/Breveal",n.validate_result=null,(g_v2engine||f)&&(verbose_log("calling reveal JS after B state"),rt(e,i,Re)),Pi=!0,CPWbot_bg.wait_for_doc_complete(e,null,function(e,i){L("B-reveal milestone"),t="B1Rpre",Gi=i},n))}function Me(e,i,n){CPWbot_bg.do_milestone(e,$,i),t="L",CPWbot_bg.mark_timestamp("logout_cpw");var _=CPWbot_bg.navigate_to_logout(e,n);return null===_?verbose_log("L: navigate_to_logout / CS callout "):_?Ne(e,i,n):(CPWbot_bg.do_milestone(e,le,i,""),bt(e)),!0}function je(e,i,n){L("post_L"),m=!1;var _=Kt(i);if(_||(_=1e3),_&&!ki)return t="Lsleep",L("L sleeping "+_),m=!0,u,bi=u+_,ki=!0,null;if(ki=!0,b&&rt(e,i,xe),g_cpw_do_fakeui){var o=function(e,i,n){if(!i||!n||null===e)return 0;if(!g_cpw_do_fakeui)return 0;return t="FK0",verbose_log("entered do_logged_out_fake_ui"),0}(e,i,n),a=$t(i);return setTimeout(function(){Ne(e,i,n)},a*o+1017),null}return Ne(e,i,n)}function Ve(e,i,n){verbose_log("M2: validate_login_entry_success "),t="M2";var _;return null===(_=CPWbot_bg.validate_login_entry_success(e,i,W))?(verbose_log("M2: validate_login_entry_success / CS callout "),Wi=!0,L("VALIDATE_IN_DOCWAIT=true"),null):(verbose_log("M2: validate_login_entry_success "+_+" no CS callout "),_?(n.check_login_entry_form=!1,void we(e,i,n)):(CPWbot_bg.do_milestone(e,ue,i,D),bt(e),retval))}},this.initialize_engine=function(e,t){pi=(new Date).getTime();var i=t.recipe;t.aid;n=t,CPWbot_bg.mark_timestamp("initialize_engine");Ni=!1,Si=!1,Li=!1,Ei=!1,Pi=!1,m_in_logout_reveal=!1,wi=!1,Ii=!1,Ai=!1,Ti=!1,Oi=!1,ki=!1,m=!1,vi=!1,Yi=!1,CPWbot_bg.do_milestone(e,65,i);var _,o,a,r,l=(o=0,(_=i)?(void 0!==_.start_delay&&(o=_.start_delay),o):null);if(l)F||(F=!0,setTimeout(function(){return qi(e,0,t),!1},l));else if(Be(i)&&!y){var s=5e3,c=(r=0,(a=i)?(void 0!==a.post_js_begin_delay&&(r=a.post_js_begin_delay),r):null);c&&(s=c),y=!0,verbose_log("initial JS inject before beginning - inject, and wait "),CPWbot_bg.conditional_js_exec(e,i,Be),setTimeout(function(){return qi(e,0,t),!1},s)}else qi(e,0,t)},this.push_event_queue=function(e,i,o){if("validate_response"!=e||void 0===o.desc||"docaptcha"!=o.desc){var r={};r.type=e,r.data=o,r.tabid=i,r.docnum=o.docnum,r.addtime=new Date,null===hi&&(hi=[]),void 0!==r.docnum&&verbose_log(sprintf("[%s][%d] pushed event : %s cmd=%s",i,r.docnum,e,o.cmd)),hi.push(r)}else M&&JSON.parse(o.result_obj).num_ok_matches>0&&(CPWbot_bg.mark_timestamp("docaptcha_success"),rt(i,_,Qe),M=!1,CPWbot_bg.show_cpwbot_overlay(i,null,null),xi(i,_),a=null,vi=!1,yi.found_interactive=!1,Fi=!0,qi(i,t,n))},this.clear_event_queue=function(){hi=[]},this.select_execute=function(e,t,i,n){},this.select=function(){},this.bagration=function(){t="Bagration"},this.in_bagration=function(){return"Bagration"==t},this.get_selenium_tabid=function(){return Ui},this.navigate_to_logout=function(e,i){if(!i)return!1;t="L",b=!1;var o=i.recipe;if(!o)return!1;i.aid;var a=!1,r=!1;r=rt(e,o,Ye),oi(ii,"Navigate to Logout");var l=Ce(o);if(l){L("call logout:loadurl with "+l);var s=null;return g_CS_tops&&(s=g_CS_tops[e]),sendCS(e,{cmd:"loadurl",url:l},s),Ni=!0,verbose_log("m_in_loadurl set"),_=o,n=i,b=!0,null}A=!1;var c,u,d=Ae(o,FN_NAVIGATE_TO_LOGOUT);if(d){verbose_log("click on FN_NAVIGATE_TO_LOGOUT field!");var f=DEFAULT_CLICK_DELAY;void 0!==o.logout_delay&&(f=o.logout_delay),A=!0,verbose_log("now waiting for click_ack L"),ut(e,d,f,he(o)),CPWbot_bg.mark_timestamp("wait_for_click_ack_L"),a=null}return(u=!1,(c=o)?(void 0!==c.logout_js_delay&&(u=!!c.logout_js_delay,"0"===c.logout_js_delay&&(u=!1)),u):null)&&(b=!0,Kt(o))?null:(r=r||rt(e,o,xe),!1===a&&r&&(a=!0),a)};var Zi=1,$i=null;function en(){}function tn(e,t){return CPWbot_bg.do_milestone(e,se,t),bt(e),CPWbot_bg.cpwbot_cs_finish_complete(e),!0}function nn(e){if(CPWbot_bg){oi(_i,e);var t={severity:"fatal",msg:e};CPWbot_bg.phone_home(null,null,t)}}function _n(e){oi(ni,e);var t={severity:"warning",msg:e};return CPWbot_bg.phone_home(null,null,t)}function on(e,t){Dt(t).length>0?CPWbot_bg.do_milestone(e,z,t):(CPWbot_bg.do_milestone(e,ce,t),bt(e))}function an(e){return e?e.symbolic:""}function rn(e){return e||(e=100),"undefined"==typeof Math?0:Math.floor(Math.random(e)+10)}return this.get_timestamp=function(e){return e?(null===$i&&($i=new en),$i[e]):null},this.get_timestamps=function(){return $i},this.mark_timestamp=function(e){null!==$i&&"dopwchange"!=e||($i=new en);var t=(new Date).getTime();return $i[e]=t,!0},this.dump_timestamps=function(){var e;if($i)for(e in $i)L(sprintf("[%s] timestamp %s : %d",an(_),e,$i[e]));return Qi(_,Zi),!0},this.get_last_timestamp=function(e){var t,i="dopwchange";if($i){for(t in $i)(!e||"fail"!==t&&"finish_complete"!=t&&"success"!=t)&&$i[t]>$i[i]&&(i=t);return i}return null},this.broken_hearted=function(e){if(CPWbot_bg){if(e!=CPWbot_bg.get_session())return void oi(ti,"stale setTimeout - clearTimeout did not work");var n=CPWbot_bg.get_timestamp("initial_cycle");(new Date).getTime();if(void 0===n&&(n=null),!(n||"preinit"!=t&&t||CPWbot_bg.get_okstate()||CPWbot_bg.get_failstate()||CPWbot_bg.in_bagration())){var o=i,a=_;CPWbot_bg.do_milestone(o,133,a,"brokenhearted"),CPWbot_bg.panic("TIMEOUT-brokenhearted")}}else;},this.new_session=function(e){e||(e="");var t=(new Date).getTime();null===t&&(t=0);var i="function"==typeof lp_sha256?lp_sha256:SHA256;return Hi=i(e.toString()+t.toString())},this.get_session=function(){return Hi},this.clear_session=function(){Hi=""},this.halt=function(e){if(e&&void 0!==e.aid&&CPWbot_bg.getpwchangeaid()!==e.aid)return!1;null!==CPWbot_bg.docaptcha_si_id&&clearInterval(CPWbot_bg.docaptcha_si_id),CPWbot_bg.docaptcha_si_id=null,Bi=!0,L("Halt Requested")},this.cpw_dialog_minimize_state=0,this.getpwchangeaid=function(){return o},this.phone_home=function(e,t,i){if(!i)return!1;t||(t=_);var n=(new Date).getTime(),o=(n-CPWbot_bg.get_timestamp("dopwchange"))/1e3;(o<0||isNaN(o))&&(o=0);var a=(n-CPWbot_bg.get_timestamp("initial_cycle"))/1e3;(a<0||isNaN(a))&&(a=0);var r=CPWbot_bg.get_last_timestamp(!0),l=i.severity?i.severity:"",s=i.msg?i.msg:"",c=sprintf("[%s][%s][R=%s][L=%s][M=%s][%6.2fsec elapsed][%2.1f TF][%6.2fsec TiE]","cpw",l,t?an(t):"bad-recipe",r,s,o,Zi,a);return L(c),lpReportError(c,null),!0},this.warning_phone_home=function(e){return _n(e)},this.site_html_url="","undefined"!=typeof g_iscasper&&g_iscasper&&(this.get_validate_timeout=function(e){return Ut.apply(this,arguments)},this.get_symbolic=function(e){return an.apply(this,arguments)},this.get_logout_url=function(e){return Ce.apply(this,arguments)},this.get_generate_prefs_from_recipe=function(e){return Ht.apply(this,arguments)},this.set_last_overlay_message=function(e){return ge.apply(this,arguments)},this.clear_last_overlay_message=function(e){return pe.apply(this,arguments)},this.validate_xpath=function(e){return ai.apply(this,arguments)},this.validate_recipe=function(e){return ri(e)},this.get_cpw_login_password_field=function(e){return Ne.apply(this,arguments)},this.get_cpw_login_username_field=function(e){return Se.apply(this,arguments)},this.get_login_submit_field=function(e){return we.apply(this,arguments)},this.get_login_reveal_field=function(e){return Ie.apply(this,arguments)},this.replace_constants=function(e){return replace_constants.apply(this,arguments)},this.set_pwchangestate=function(e){return t=e,!0},this.in_wait_for_click=function(){return si()},this.submit_login_form=function(e,t,i){return ft(e,t)},this.fill_login_form=function(e,t,i){return dt(e,t,i)},this.clear_wait_for_clicks=function(){return ci()},this.get_event_queue=function(){return hi},this.reset_private_test_vars=function(){V=!1,vi=!1,Wi=!1},this.should_click_on_fill=function(e){return Qt(e)},this.should_fill_password_fields_via_keys=function(e){return Zt(e)},this.get_fill_delay=function(e){return $t(e)},this.random_delay=function(e){return rn(e)},this.random_sleep=function(e,t){return e||100,!1},this.get_cpw_session_timeout=function(e){return Xt(e)},this.fill_login_entry_form=function(e,t,i){return gt(e,t,i)},this.submit_login_entry_form=function(e,t,i){return pt(e,t)},this.set_pwchange_validate_desc=function(e){return l=e,!0},this.check_recipe_symbols=function(e){return li(e)},this.set_in_validate_outer=function(){return vi=!0,Wi=!0,!0},this.set_in_validate_inner=function(t,i){a={cmd:"cpwbot_validate_state",desc:i,id:t},r=t,e.set_pwchange_validate_desc(i),null===d&&(d=[])},this.get_in_sleep=function(){return m},this.clear_sleeps=function(){wi=!1,Ii=!1,Ai=!1,Ti=!1,Oi=!1,ki=!1,m=!1}),!0}function get_recipe_for_url(e,t){var i,n;lp_gettld_url(e);return g_isfirefox?(i=LP.lpMakeRequest,n=LP.lp_base):(i=lpMakeRequest,n=base_url),void i(n+"get_recipe.php","url="+encodeURIComponent(e),function(e){if(4==e.readyState){if(200==e.status&&null!=e.responseXML&&null!=e.responseXML.documentElement){var i=e.responseXML.documentElement.getElementsByTagName("result");if(i.length>0){var n=i[0].getAttribute("recipe");if(""!=n)return void t(replace_constants(JSON.parse(n)));CPWbatch&&CPWbatch.cpw_get_batchjob_state()||CPWbot_bg.alert("This url is not supported yet");CPWbot_bg.do_milestone(null,128,null,"no recipe")}}t(null)}},function(){t(null)})}function ping_ack_handler(e,t){var i=t.docnum,n=t.url,_=t.id,o=t.delta,a=(new Date).getTime()-t.timestamp;debug&&L("received ping response from [tabid:"+e+"][docnum:"+i+"][id:"+_+" sent: "+o+"ms, response: "+a+"ms docstate="+t.docstate+" url="+n);var r=getcsinfo(e,i);r||((r=new CS_t).docnum=i,r.tabid=e),r.url=n,r.docstate=t.docstate,r.flags=t.flags,setcsinfo(e,i,r)}function ping(e,t){var i=(new Date).getTime(),n=!1;void 0!==e&&null!==e||(n=!0),void 0!==t&&null!==t||(t="all");var _=("function"==typeof lp_sha256?lp_sha256:SHA256)(g_username+""+e+t+i);if(debug&&L("sending ping id="+_),n)for(e in g_CS)void 0!==e&&null!==e&&sendCS(e,{cmd:"ping_req",id:_,timestamp:i},t);else sendCS(e,{cmd:"ping_req",id:_,timestamp:i},t)}function cpwbot_getpwchangestate(){return g_cpwbot&&CPWbot_bg?"Bagration"==CPWbot_bg.get_pwchangestate()?!0===CPWbot_bg.get_failstate()?!0===CPWbot_bg.get_failpwsavedstate()?"FAIL_PW_SAVED":"FAIL":!0===CPWbot_bg.get_okstate()?"OK":null:!0===CPWbot_bg.get_captchastate()?"CAPTCHA":!0===CPWbot_bg.get_docaptchastate()?"DOCAPTCHA":!0===CPWbot_bg.get_brokenheartstate()?"TIMEOUT":"preinit"==CPWbot_bg.get_pwchangestate()?null:!0===CPWbot_bg.get_failstate()?!0===CPWbot_bg.get_failpwsavedstate()?"FAIL_PW_SAVED":"FAIL":!0===CPWbot_bg.get_okstate()?"OK":CPWbot_bg.get_pwchangestate():"FAIL"}function cpwbot_preinit(){CPWbot_bg&&CPWbot_bg.preinit()}function cpwbot_get_user_debug_messages(){if(CPWbot_bg)return CPWbot_bg.get_user_debug_messages()}function cpwbot_get_dialog_msg(){if(CPWbot_bg)return CPWbot_bg.get_dialog_msg()}function cpwbot_halt(){if(CPWbot_bg)return CPWbot_bg.halt()}function cpwbot_minimize_dialog(){CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=1)}function cpwbot_maximize_dialog(){CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=0)}function cpwbot_get_minimize_dialog_state(){if(CPWbot_bg)return CPWbot_bg.cpw_dialog_minimize_state}
//# sourceMappingURL=sourcemaps/cpwbot_bg.js.map
