var SharedFolderAccessDialog=function(e){ContainerSelectionDialog.call(this,e),this.member=null,this.selectedAids=null,this.noLocalRestrictedVaultItems=[],this.leftHeader=null,this.leftHeaderText=null,this.rightHeader=null,this.rightHeaderText=null};SharedFolderAccessDialog.prototype=Object.create(ContainerSelectionDialog.prototype),SharedFolderAccessDialog.prototype.constructor=SharedFolderAccessDialog,function(){SharedFolderAccessDialog.prototype.initialize=function(e){var t;ContainerSelectionDialog.prototype.initialize.apply(this,arguments),this.leftHeader=e.find(".identityLeft .header"),this.leftHeaderText=this.leftHeader.text(),this.leftPlaceHolder=e.find(".availableSearch"),this.leftPlaceHolderText=this.leftPlaceHolder.attr("placeholder"),this.rightHeader=e.find(".identityRight .header"),this.rightHeaderText=this.rightHeader.text(),this.rightPlaceHolder=e.find(".selectedSearch"),this.rightPlaceHolderText=this.rightPlaceHolder.attr("placeholder"),this.otherMembersElement=$("#sharedFolderAccessOtherUsers"),(t=this).inputFields.hidebydefault.onChange(function(e){e?(t.leftHeader.text(t.rightHeaderText),t.leftPlaceHolder.attr("placeholder",t.rightPlaceHolderText),t.rightHeader.text(t.leftHeaderText),t.rightPlaceHolder.attr("placeholder",t.leftPlaceHolderText)):(t.leftHeader.text(t.leftHeaderText),t.leftPlaceHolder.attr("placeholder",t.leftPlaceHolderText),t.rightHeader.text(t.rightHeaderText),t.rightPlaceHolder.attr("placeholder",t.rightPlaceHolderText))}),t.inputFields.applyToOthers.onChange(function(e){e?t.otherMembersElement.show():t.otherMembersElement.hide()})},SharedFolderAccessDialog.prototype.setup=function(){ContainerSelectionDialog.prototype.setup.apply(this,arguments);for(var e=[],t=dialogs.sharedFolder.getDialog().containers.existingMembers.getItemChildren(),r=0,a=t.length;r<a;++r){var i=t[r];i!==this.member&&e.push(new SharedFolderAccessCheckbox(i))}e.length>0&&(this.containers.otherMembers=new Container(e,{allowDrag:!1,searchInput:"sharedFolderAccessOtherUsersSearch",publishSelect:!1}),this.containers.otherMembers.initialize(document.getElementById("sharedFolderAccessOtherUsersContainer")))};var e=function(e){for(var t={},r=0,a=e.length;r<a;++r)t[e[r]]=!0;return t};SharedFolderAccessDialog.prototype.open=function(t,r){var a,i,o,l,s=this;return void 0===r?(a=s,o={shareid:(i=t).getShareID()},i instanceof SharedFolderUser?o.uid=i.getID():o.cgid=i.getID(),void LPRequest.makeDataRequest(LPProxy.getSharedFolderRestrictions,{params:o,success:a.createDynamicHandler(function(e){a.open(i,e)})})):t._sharedGroup.isDownloaded()?(function(t,r,a){t.member=a,t.selectedAids=e(r.aids);var i=LPProxy.getItemsByShareID(t.member._sharedGroup.getID());0!==i.length?function(e,t,r){e.noLocalRestrictedVaultItems=[];for(var a=0;a<r.restrictedItems.length;a++)if(-1===t.indexOf(r.restrictedItems[a].id)){var i=(o=e,l=r.restrictedItems[a],s=void 0,(s=new(l.sn?Note:Account)(l,o.member._sharedGroup))._data.aid=l.id,s._data.name=LPProxy.decryptMobile(s._data.name,!1,s.getKey()),s._data.group=o.member._sharedGroup.getName()+"\\"+LPProxy.decryptMobile(l.group,!1,s.getKey()),s);e.noLocalRestrictedVaultItems.push(i.newDisplayObject())}var o,l,s}(t,function(e){var t=[];e.availableAids={};for(var r=0,a=i.length;r<a;++r){var o=i[r].getID();t.push(o),void 0===e.selectedAids[o]&&(e.availableAids[o]=!0)}return t}(t),r):dialogs.alert.open({title:Strings.translateString("Edit Access"),text:Strings.translateString("Please add items to this folder before editing a member's access.")})}(s,r,t),void ContainerSelectionDialog.prototype.open.apply(this,[{title:"Edit Access: "+t.toString(),defaultData:{hidebydefault:"1"===r.hidebydefault}}])):(l=s.member._sharedGroup,void dialogs.confirmation.open({title:Strings.translateString("Error"),text:Strings.translateString("Folder must be downloaded in order to edit a member's access. Would you like to download now?"),handler:function(){l._sharedFolderItem.startDownloading(),Dialog.prototype.closeAllDialogs()}}))};var t=function(e,t){var r={filter:e},a=LPProxy.getSites(r).concat(LPProxy.getNotes(r)).concat(t);return LPProxy.assignItemsToGroups(a,!1)};SharedFolderAccessDialog.prototype.getAvailableItems=function(){return t(this.availableAids,[])},SharedFolderAccessDialog.prototype.getSelectedItems=function(){return t(this.selectedAids,this.noLocalRestrictedVaultItems)};var r=function(e){for(var t=[],r=0,a=e.length;r<a;++r)t.push(e[r].getID());return t.join(",")};SharedFolderAccessDialog.prototype.getData=function(e){var t=ContainerSelectionDialog.prototype.getData.apply(this,arguments);return t.aids="",this.containers.selected&&(t.aids=r(this.containers.selected.getItemModelChildren())),t.additionaluids="",t.applyToOthers&&this.containers.otherMembers&&(t.additionaluids=r(this.containers.otherMembers.getSelectedModelItems())),t},SharedFolderAccessDialog.prototype.handleSubmit=function(e){LPRequest.makeRequest(LPProxy.updateSharedFolderRestrictions,{params:$.extend(e,{uid:this.member.getID(!0),shareid:this.member._sharedGroup.getID()})})}}();
//# sourceMappingURL=sourcemaps/sharedFolderAccessDialog.js.map
