var CreateAccountDialog=function(e){Dialog.call(this,e,{views:[{selector:"#dataEntry"},{selector:"#confirmation",title:Strings.translateString("Confirm Password")}],dynamicHeight:!0,additionalHeaderClasses:["icon"],nextButtonText:Strings.translateString("Create Account"),largeButtons:!0,title:Strings.translateString("Create Account"),consentDetails:{countryCode:"",defaultConsentValue:null,ip:""}})};CreateAccountDialog.prototype=Object.create(Dialog.prototype),CreateAccountDialog.prototype.constructor=CreateAccountDialog,function(){var e,t,a=!1,r=[];CreateAccountDialog.prototype.initialize=function(t){Dialog.prototype.initialize.apply(this,arguments);var a,r=document.getElementById("GdprEula");if(r)if(LPTools.getOption(this.data,"isGdprEnabled",!1)){var s=document.getElementById("createAccountDialog"),n=document.getElementById("chooseOtherwise"),o=document.getElementById("contactPermission"),i=document.getElementById("contactPermissionCheckbox"),l=document.getElementById("contactPermissionContainer"),c=document.getElementById("marketingOptOutSeen");s.classList.add("loading"),this.getConsentDetails(function(t){c.value="0",o.value=t.defaultConsentValue,e=!0,n.addEventListener("click",function(){"0"===c.value&&(i.checked="1"===n.getAttribute("data-default-opt-out-value"),c.value="1",l.classList.add("is-expanded"))}),i.addEventListener("change",function(){i.checked?o.value="0":o.value="1"}),document.getElementById("oldEula").remove(),s.classList.remove("loading")})}else r.remove();this.inputFields.password.getElement().LP_addPasswordMeter(),(a=this).inputFields.email.onChange(function(e){e&&getBG().LPServer.textRequest({type:"GET",url:"create_account.php",CSRFToken:!1,data:{username:e,check:"avail",mistype:1},success:function(e){0===e.indexOf("mistype:")?a.addError("email",e.substring(8)):"no"===e&&a.addError("email",Strings.translateString("Email already in use."))}})})},CreateAccountDialog.prototype.getConsentDetails=function(e){var t,s=this;if(a)return e(this.consentDetails);r.push(e),t=function(e){for(a=!0,s.consentDetails=e;r.length>0;){var t=r.pop();t&&t(e)}},("undefined"==typeof bg?getBG():bg).LPServer.jsonRequest({url:"lmiapi/create-account/details",type:"GET",CSRFToken:!1,success:function(e){t&&t(e)},error:function(e){t&&t(null)}})},CreateAccountDialog.prototype.close=function(e){var t;e?Dialog.prototype.close.apply(this,arguments):(t=this,LPTools.getOption(t.data,"showcloseconfirm",!0)?dialogs.confirmation.open({title:"LastPass",text:Strings.translateString("Do you really want to quit?  You cannot use LastPass without creating an account."),handler:function(){dialogs.alert.open({title:"LastPass",text:Strings.translateString("Please visit https://lastpass.com to create an account at a later time."),handler:function(){t.close(!0)}})}}):t.close(!0))},CreateAccountDialog.prototype.validate=function(t){var a=Dialog.prototype.validate.apply(this,arguments);return t.email.length<5&&(this.addError("email",Strings.translateString("It looks like you've entered an invalid or incomplete email address. Please try again.")),a=!1),e||t.agreeTerms||(this.addError("agreeTerms",Strings.translateString("You must agree to the Terms and Conditions in order to continue")),a=!1),t.password.length<8&&(this.addError("password",Strings.translateString("Sorry, your password is too short. It must be a minimum of 8 characters long for security reasons.")),a=!1),t.password&&t.password===t.email&&(this.addError("password",Strings.translateString("Sorry, your password can not be the same as your email address.")),a=!1),(t.password.match(/^password\d{0,3}$/i)||"12345678"===t.password||"123456789"===t.password||"1234567890"===t.password||t.password.match(/^lastpass\d{0,3}$/i)||"lastpass.com"===t.password||"qwertyuiop"===t.password||"abcd1234"===t.password)&&(this.addError("password",Strings.translateString("Your password is easily guessable, avoid simple runs of characters, or variations of 'password' or 'lastpass'.")),a=!1),t.password&&-1!==t.reminder.toLowerCase().indexOf(t.password.toLowerCase())&&(this.addError("reminder",Strings.translateString("Your Password Reminder can not be the same as your chosen Master Password for security reasons. Please edit your Reminder so that it does not contain your Master Password.")),a=!1),this.currentViewIndex===this.views.length-1&&t.password!==t.reconfirm&&(this.addError("reconfirm",Strings.translateString("Your Master Password and Confirm Master Password entries do not match, please enter them again.")),a=!1),a},CreateAccountDialog.prototype.handleSubmit=(t=function(e,t,a){Topics.get(Topics.ERROR).publish(e),Topics.get(Topics.REQUEST_ERROR).publish({requestID:a})},function(e){e.email=bg.fix_username(e.email);var a,r,s=LPRequest.getNewRequestID();a=bg,r=this,a.make_lp_key_hash(e.email,e.password,function(n,o,i){var l={username:e.email,email:e.email,hash:o,password_hint:e.reminder,improve:1,loglogins:1,iterations:i,xml:1};l.contactPermission=e.contactPermission,l.marketingOptOutSeen=e.marketingOptOutSeen,BuildVariables&&BuildVariables.createSource&&(l[BuildVariables.createSource]=1),Topics.get(Topics.REQUEST_START).publish({requestID:s}),a.create_account_safe($.param(l),function(n){!function(e,a,r,s,n){var o="";if(e){var i=e;if(i.indexOf("ok")>=0)r.set("g_manual_login",!0),r.LP_do_login(a.email,a.password,!0,!1,null,!0,null,null,function(){n.close(!0)});else if(i.indexOf("usernametaken")>=0)o=Strings.translateString("Email already in use, have you forgotten your password?");else if(i.indexOf("usernameinvalid")>=0||i.indexOf("emailfailed")>=0)o=Strings.translateString("Invalid email address, try again");else{var l=jQuery.parseXML(e);if(l&&l.documentElement){var c=l.getElementsByTagName("error");c&&c.length>0&&c[0].getAttribute("msg")&&(o=c[0].getAttribute("msg"))}""===o&&(o=Strings.translateString("A server error occurred while processing your request."))}}else o=Strings.translateString("Received empty response from server.");o&&t(o,a,s)}(n,e,a,s,r)},t)})})}();
//# sourceMappingURL=sourcemaps/createAccountDialog.js.map
