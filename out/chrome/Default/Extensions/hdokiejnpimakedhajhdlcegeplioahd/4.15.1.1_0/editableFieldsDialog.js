EditableFieldsDialog=function(e,t){(t=t||{}).views=[{selector:".mainView"},{selector:".formFieldsView",title:Strings.translateString("Edit Form Fields"),dynamicHeight:!1}],DialogWithGroupInput.call(this,e,t),this.fieldsElement=null,this.addFieldsButton=null,this.fieldsTable=null,this.postSetupData=null,this.editFormFieldsButton=$(LPTools.buildItemButton(Constants.ACTION_EDIT)),this.editFormFieldsButton.attr("title",Strings.translateString("Edit Form Fields"))},EditableFieldsDialog.prototype=Object.create(DialogWithGroupInput.prototype),EditableFieldsDialog.prototype.constructor=EditableFieldsDialog,function(){var e=function(e,t){DialogInput.Input.call(this,void 0),this.fieldElements=[],this.container=e,this.parentDialog=t};(e.prototype=Object.create(DialogInput.Input.prototype)).constructor=e,e.prototype.clear=function(){LPTools.removeDOMChildren(this.container)},e.prototype.getValue=function(){for(var e=[],t=0,i=this.fieldElements.length;t<i;++t){var l=this.fieldElements[t];l.data.value=l.input.getValue(),e.push($.extend({},l.data))}return e},e.prototype.setValue=function(e){LPTools.removeDOMChildren(this.container),this.fieldElements=[];for(var t=0,i=e.length;t<i;++t)this.addField(e[t]);LPTools.addZebraStriping(this.container)},e.prototype.addField=function(e){if("hidden"!==e.type){var i=LPTools.createElement("tr","settingsRow");i.appendChild(LPTools.createElement("td","settingLabel",e.name));var l="Form Field "+e.name,a=null;switch(e.type){case"radio":case"select":case"select-one":a=LPTools.createElement("input",{class:"dialogInput",type:"text","aria-label":l});break;case"checkbox":a=LPTools.buildCheckbox(void 0,{checkboxAttributes:{"aria-label":l}});break;default:a=LPTools.createElement("input",{class:"dialogInput",type:e.type,"aria-label":l})}var o=(u=$(a)).is("input")?a:u.find("input").get(0),s=new DialogInput.Input(o);this.fieldElements.push({data:e,input:s}),s.setValue(e.value);var d=LPTools.createElement("td","formFieldValue"),n=LPTools.createElement("div");d.appendChild(n),n.appendChild(a),i.appendChild(d);var r=LPTools.createElement("div","rightItemButtons"),p=LPTools.buildItemButton(Constants.ACTION_REMOVE);$(p).bind("click",t(this.parentDialog,this.container,i,this.fieldElements,e)),r.appendChild(p),n.appendChild(r),this.container.appendChild(i),"password"===e.type&&s.getElement().LP_addPasswordEye({checkPermissionHandler:this.parentDialog.checkViewPasswordHandler})}var u};var t=function(e,t,i,l,a){return function(){for(var o=null,s=0,d=l.length;s<d;++s)if(l[s].data===a){o=s;break}if(null!==o){var n=function(){t.removeChild(i),LPTools.addZebraStriping(t),l.splice(o,1)};e.vaultItem?LPRequest.makeUpdateRequest(LPProxy.deleteField,{parameters:[e.vaultItem,e.vaultItem._data.fields[o]],requestSuccessOptions:{closeDialog:!1},success:function(){n(),e.vaultItem.removeField(o),e.originalData=e.getData(!1)},confirm:{title:Strings.Vault.DELETE,text:Strings.translateString("Are you sure you want to delete field %1?",a.name)}}):n()}}};EditableFieldsDialog.prototype.initialize=function(t){var i;DialogWithGroupInput.prototype.initialize.apply(this,arguments),this.formFieldsView=t.find(".formFieldsView"),this.fieldsTable=t.find(".fieldsTable"),this.fieldsElement=t.find(".fieldsElement"),this.addFieldsButton=t.find(".addFormFieldButton"),this.inputFields.fields=new e(this.fieldsElement.get(0),this),this.addFieldsButton.bind("click",(i=this,function(){dialogs.addFormField.open({sourceDialog:i})}))},EditableFieldsDialog.prototype.getNextViewButton=function(){return this.editFormFieldsButton},EditableFieldsDialog.prototype.setNextView=function(e){DialogWithGroupInput.prototype.setNextView.apply(this,arguments),e>0?this.editFormFieldsButton.hide():this.editFormFieldsButton.show()},EditableFieldsDialog.prototype.postSetup=function(){DialogWithGroupInput.prototype.postSetup.apply(this,arguments),this.postSetupData=this.getData()},EditableFieldsDialog.prototype.clearFields=function(){DialogWithGroupInput.prototype.clearFields.apply(this,arguments),this.postSetupData=null},EditableFieldsDialog.prototype.getData=function(){var e=DialogWithGroupInput.prototype.getData.apply(this,arguments),t=this.postSetupData;if(t&&t.fields&&e.fields)for(var i=e.unencryptedUsername!==t.unencryptedUsername,l=e.password!==t.password,a=null,o=null,s=0;s<e.fields.length;++s){var d=e.fields[s],n=t.fields[s];if(n){var r=d.value!==n.value;t.unencryptedUsername&&t.unencryptedUsername===n.value?i?d.value=e.unencryptedUsername:r&&null===a?e.unencryptedUsername=a=d.value:null!==a&&(d.value=a):t.password&&t.password===n.value&&(l?d.value=e.password:r&&null===o?e.password=o=d.value:null!==o&&(d.value=o))}}return e},EditableFieldsDialog.prototype.setup=function(e,t){if(t.vaultItem?this.addFieldsButton.LP_show():this.addFieldsButton.LP_hide(),this.editFormFieldsButton.LP_hide(),this.$element.removeClass("saveAll"),this.fieldsTable.append(this.fieldsElement),this.formFieldsView.append(this.addFieldsButton),t.defaultData&&t.defaultData.save_all||t.vaultItem&&t.vaultItem._data.save_all){this.$element.addClass("saveAll");var i=e.find(".saveAllFields");i.append(this.fieldsElement),i.after(this.addFieldsButton)}else t.vaultItem&&this.editFormFieldsButton.LP_show();DialogWithGroupInput.prototype.setup.apply(this,arguments)},EditableFieldsDialog.prototype.checkViewPassword=function(e){var t;this.vaultItem?this.vaultItem.canViewPassword()?LPProxy.reprompt((t=this,function(){e(),bg.loglogin(t.vaultItem.getID())}),{types:AccountBaseWithFields.prototype.REPROMPT_TYPE_VIEW_PW}):Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to view the password.")):e()}}();var AddFormFieldDialog=function(e){Dialog.call(this,e,{closeButtonEnabled:!0,nextButtonText:Strings.translateString("Add"),title:Strings.translateString("Add Form Field"),dynamicHeight:!0,overlayDialog:!0}),this.fieldsInput=null};AddFormFieldDialog.prototype=Object.create(Dialog.prototype),AddFormFieldDialog.prototype.constructor=AddFormFieldDialog,AddFormFieldDialog.prototype.initialize=function(e){var t,i;Dialog.prototype.initialize.apply(this,arguments),(t=this).inputFields.type.onChange((i=!1,function(e){var l="checkbox"===e;if(l!==i){var a=document.getElementById("addFormFieldDialogValue");if(LPTools.removeDOMChildren(a),i=l,l){var o=LPTools.buildCheckbox();a.appendChild(o),t.inputFields.value.setElement($(o).find("input"))}else{var s=LPTools.createElement("input",{class:"dialogInput",type:"text"});a.appendChild(s),t.inputFields.value.setElement(s)}}}))},AddFormFieldDialog.prototype.setup=function(e,t){t.sourceDialog&&t.sourceDialog.vaultItem&&t.sourceDialog.vaultItem._data.save_all?$("#addFormFieldDialogFormName").LP_show():$("#addFormFieldDialogFormName").LP_hide(),Dialog.prototype.setup.apply(this,arguments)},AddFormFieldDialog.prototype.validate=function(e){var t=Dialog.prototype.validate.apply(this,arguments);if(e.name)for(var i=this.data.sourceDialog.inputFields.fields.getValue(),l=0,a=i.length;l<a;++l)i[l].name===e.name&&(this.addError("name","A field with this name already exists."),t=!1);else this.addError("name","Field Name is required."),t=!1;return e.type||(this.addError("type","Field Type is required."),t=!1),t},AddFormFieldDialog.prototype.handleSubmit=function(e){var t,i;t=this.data.sourceDialog,i=$.extend({},e),t.vaultItem.processEnteredFieldData(e),LPRequest.makeUpdateRequest(LPProxy.addField,{parameters:[t.vaultItem,e],success:function(){t.vaultItem.addField(e),t.inputFields.fields.addField(i),t.originalData=t.getData(!1)}})};
//# sourceMappingURL=sourcemaps/editableFieldsDialog.js.map
