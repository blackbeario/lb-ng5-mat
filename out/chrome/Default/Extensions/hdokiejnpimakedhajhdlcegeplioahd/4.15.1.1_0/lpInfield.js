"use strict";function sendRequest(e){if(null!=e)if(e.cmd&&"popupfillinputget"!=e.cmd&&"popupfilliconnumber"!=e.cmd&&L("IF -> BG : cmd="+e.cmd),g_ischrome)try{chrome_runtime_sendMessage(e,function(){})}catch(e){}else g_issafari?safari.self.tab?safari.self.tab.dispatchMessage(e.cmd,e):safari.extension&&safari.extension.globalPage&&safari.extension.globalPage.contentWindow&&safari.extension.globalPage.contentWindow.message_handler({name:e.cmd,message:e,target:window}):g_isfirefoxsdk?(e.messagetype=e.cmd,send_message(e)):g_iscasper&&"function"==typeof t_sendmsg&&t_sendmsg(e)}var g_reference_url="",InfieldIcons={globe:"images/Globe.png",profile:"images/Profile.png",other:"images/Other.png",mastercard:"images/Mastercard.png",visa:"images/Visa.png",amex:"images/Amex.png",discover:"images/Discover.png"},InfieldCommands=function(){function e(e){csTop.LPInfieldFrame.close(e)}function n(e,n){bg.sendLpImprove(e,n)}return{closePopup:e,copyToClipboard:function(e,t){bg.copytoclipboard(e),n("copypass",{action:t,source:"formv2"})},editSite:function(e){bg.InfieldCommands.editSite(e,!0)},fillUsernamePass:function(n){bg.InfieldCommands.fillUserData(n,!0),e("action")},copyUrl:function(e){bg.InfieldCommands.copyUrl(e,!0)},copyUserName:function(e){bg.InfieldCommands.copyUserName(e,!0)},copyPassword:function(e){bg.InfieldCommands.copyPassword(e,!0,"formv2")},editFormFill:function(n){bg.InfieldCommands.editFormFill(n,!0,"formv2"),e("action")},fillForm:function(n){bg.InfieldCommands.fillForm(n,!0,"formv2"),e("action")},getGeneratePrefs:function(e){bg.InfieldCommands.getGeneratePasswordPrefs(e)},writeAllPrefs:function(e,n){bg.InfieldCommands.setGeneratePasswordPrefs({prefstr:e,genpwstr:n})},fillGeneratedPassword:function(n,t){bg.InfieldCommands.fillGeneratedPassword(n,t,!0),e("action")},searchVault:function(e,n,t){bg.InfieldCommands.searchVault(e,n,t)},getInitialData:function(e){bg.InfieldCommands.getPopupFillData(e)},sendLpImprove:n,sendTimingEvent:function(e,n,t,i){bg.sendTimingEvent(e,n,t,i?{numberOfItems:i}:{})}}}();!function(e){var n=function(n,t,i){var r=this;r._onResizeCallback=i,n&&(n instanceof jQuery?r._triggerElement=n:r._triggerElement=e("#"+n),t?(r._triggerElement.click(function(e){r.show(),r._setPosition(e)}),r._triggerElement.keypress(function(n){r.show(),e(r._menuElement[0]).children().children()[0].focus(),r._setPosition(n)})):(r._triggerElement.children().click(function(e){r.show()}),r._triggerElement.children().keypress(function(n){r.show(),e(r._menuElement[0]).children().children()[0].focus()})))};n.prototype._setPosition=function(n){var t=e(n.currentTarget).offset();t.top+=20,t.left+=20,this._menuElement.offset(t)},n.prototype.show=function(){e(".dropdown").hide(),e(".menuTriggered").removeClass("menuTriggered");var n=this;n._triggerElement.closest(".tile").addClass("menuTriggered"),n._triggerElement.addClass("menuTriggered"),this._menuElement&&this._menuElement.show(0,function(){n._onResizeCallback&&n._onResizeCallback(n._menuElement.height(),90)})},n.prototype.hide=function(e){this._triggerElement.closest(".tile").removeClass("menuTriggered"),this._triggerElement.removeClass("menuTriggered"),this._triggerElement.blur(),this._menuElement&&(this._menuElement.hide(e),this._onResizeCallback())},n.prototype.resetTimer=function(e){var n=this;n._menuElement&&(n._menuTimer=setTimeout(function(){n.hide()},e||1e3))},n.prototype.createMenu=function(n,t,i){var r=this;return r._menuElement=e("<div></div>").attr("id",n+"Menu").addClass("dropdown").addClass(t).hide().hover(function(){r._triggerElement.closest(".tile");clearTimeout(r._menuTimer)},function(){r.resetTimer(300)}).append(r._createMenuItems(i)),r._menuElement},n.prototype._createMenuItems=function(n){var t=this;t._menuItems=n;for(var i=e("<ul></ul>").addClass("menuList"),r=0;r<t._menuItems.length;r++){var o=e("<li></li>").attr("data-viewId",t._menuItems[r].id).attr("tabindex","1").click(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).focus(function(){clearTimeout(t._menuTimer)}).keypress(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).append(e("<p></p>").text(t._menuItems[r].text));i.append(o)}return i},n.prototype._findMenu=function(n){var t=e.grep(this._menuItems,function(e){return e.id===n});return t&&t.length>0?t[0]:null},n.prototype.select=function(e,n){var t=this._findMenu(e);t&&this._triggerElement&&this._triggerElement.find("p").text(t.selectedText),!0===n&&t&&t.action&&t.action()},window.InfieldMenu=n}(jQuery);var InfieldView=function(e){var n=[];function t(){e.each(n,function(n,t){e("#"+t).hide()})}return{init:function(e){Array.isArray(e)&&e.length>0&&(n=e,t())},show:function(i){-1!=n.indexOf(i)&&(t(),e("#"+i).show())}}}(jQuery),InfieldGeneratePassword=function(e){var n={};function t(){e("#generatedPasswordCount").val(function(){return parseInt(e("#generatedPasswordCount").val())+1});var n=lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"));e("#password").val(n).change()}function i(){e("#generatedPasswordLength").text(e("#length").val()),e("#sliderFill").width(e("#length").val()+"%")}return{init:function(r,o,a){e("#moreOptions, #hideOptions").click(function(){e("#advancedView").toggle(),e("#generateAndFillView").toggle(),e("#generateBtnContainer").toggle(),e("#moreOptions").toggle(),a&&a()}),e("#length").on("input",function(){InfieldSearch.debounce(i(),500)}),e(".pwgen").change(t),e("#generateBtn").click(t),e("#pronounceable").click(function(){e("#pronounceable").prop("checked")?(e("#digits").prop("checked",!1),e("#digits").prop("disabled",!0),e("#special").prop("checked",!1),e("#special").prop("disabled",!0),e("#ambig").prop("checked",!1),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0)):(e("#digits").prop("checked",!0),e("#digits").prop("disabled",!1),e("#special").prop("checked",!0),e("#special").prop("disabled",!1))}),e("#ambig").click(function(){e("#ambig").prop("checked")&&(e("#pronounceable").prop("checked",!1),e("#digits").prop("disabled",!1),e("#special").prop("disabled",!1))}),e("#password").on("copy",function(){bg.LPTabState.setCopiedGeneratedPassword(this.value)}).LP_addGeneratePasswordMeter(),bg.InfieldCommands.canCopy(function(n){n?e("#btnCopy").click(function(){var n=e("#password").val();r.copyToClipboard(n,"generatepassword"),e("#btnCopy").hide(),e("#copied").show(),setTimeout(function(){e("#copied").hide(),e("#btnCopy").show()},1e3),bg.LPTabState.setCopiedGeneratedPassword(n)}):e("#btnCopy").hide()});var s=function(){r.fillGeneratedPassword(e("#password").val(),{pronounceable:e("#pronounceable").prop("checked"),length:e("#password").val().length,expand:e("#moreOptions").is(":hidden"),uppercase:e("#upper").prop("checked"),lowercase:e("#lower").prop("checked"),numeric:e("#digits").prop("checked"),special:e("#special").prop("checked"),avoidAmbiguous:e("#ambig").prop("checked"),source:"formv2",variation:"old",generatedPasswordCount:e("#generatedPasswordCount").val()}),n[Object.keys(n).length]=e("#password").val(),r.writeAllPrefs(JSON.stringify({generate_pronounceable:e("#pronounceable").prop("checked")?1:0,generate_length:e("#length").val(),generate_upper:e("#upper").prop("checked")?1:0,generate_lower:e("#lower").prop("checked")?1:0,generate_digits:e("#digits").prop("checked")?1:0,generate_special:e("#special").prop("checked")?1:0,generate_ambig:e("#ambig").prop("checked")?1:0,generate_mindigits:2,generate_reqevery:0}),LPJSON.stringify(n))};e("#fillPasswordBtn").click(s),e("#generateAndFillBtn").click(s),e("#generateAndFillBtn").keypress(s),e("#advancedView").hide(),e("#generateBtnContainer").hide()},setup:function(t){n=LPJSON.parse(t.genpwstr);var r=JSON.parse(t.prefstr);e("#length").val(parseInt(r.generate_length)),i(),e("#upper").prop("checked",!!parseInt(r.generate_upper)),e("#lower").prop("checked",!!parseInt(r.generate_lower)),e("#digits").prop("checked",!!parseInt(r.generate_digits)),e("#special").prop("checked",!!parseInt(r.generate_special)),e("#ambig").prop("checked",!!parseInt(r.generate_ambig)),e("#advancedView").hide(),e("#generateAndFillView").show(),parseInt(r.generate_pronounceable)?e("#pronounceable").click():e("#pronounceable").prop("pronounceable",!1),e("#password").val(lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"))).change()},show:function(){e("#moreOptions").show(),e("#generateBtnContainer").hide()},hide:function(){e("#moreOptions").hide(),e("#generateBtnContainer").hide()}}}(jQuery),InfieldTiles=function(e,n,t,i){var r;return{setup:function(o,a,s,c,l,d){r=l;var p=[];if(e("#menuContainer").empty(),e("#"+o).empty().append(e('<p class="italic"></p>').text(d)),s){var u=e.map(s,function(e,n){return e});u.sort(function(e,n){return e}),e.each(u,function(o,s){var l=!1;o+1===u.length&&(l=!0);var d=function(i,o){if(!o)return null;var a=null,s=e("<div></div>").addClass("col-8 text full-height"),c=e("<button></button>").attr("id",o.id+"btn").attr("tabindex","1").text(o.moreText);switch(i){case"formfills":s.append(e("<span></span>").text(o.name)),o.description&&s.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").addClass("small").text(o.description));break;case"sites":s.append(e("<span></span>").addClass("small").text(o.name)),o.description&&s.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").text(o.description)),a=new t(c,!0,r);var l=[{id:"editSite",text:"Edit",action:function(){n.editSite(o.id)}}];bg.InfieldCommands.canCopy(function(t){t&&(l.push({id:"copyPassword",text:"Copy password",action:function(){n.copyPassword(o.id)}}),l.push({id:"copyUsername",text:"Copy username",action:function(){n.copyUserName(o.id)}}),l.push({id:"copyURL",text:"Copy URL",action:function(){n.copyUrl(o.id)}})),e("#menuContainer").append(a.createMenu(o.id+"btn","tileDropdown",l))})}o.moreHandler&&c.click(o.moreHandler);var d,p=e("<div></div>").addClass("col-2 no-right-gutter no-left-gutter pull-right more").append(c),u=(d=[o.icons.normalEl],e("<div></div>").addClass("col-2 no-left-gutter no-right-gutter").append(e("<div></div>").addClass("icon").append(d)));u.click(o.clickHandler),s.click(o.clickHandler);var f=e("<div></div>").addClass("tile col-12").attr("id",o.id).attr("tabindex","1").append(e("<div></div>").addClass("row").append(u,s,p)).hover(function(){},function(){f.removeClass("triggered")});return o.lastTile&&f.addClass("lastTile"),c.focus(function(){f.addClass("triggered")}).blur(function(){f.removeClass("triggered")}).click(function(){f.addClass("menuTriggered"),f.removeClass("triggered")}),f}(a,{id:"sites"===a?s.aid:s.ffid,name:"sites"===a?s.name:s.decprofilename,description:"sites"===a?s.unencryptedUsername:1==s.profiletype?s.formattedCCNum:null,icons:function(t,i,r){var o="",a="";if("formfills"===i)if(0==r.profiletype)o=InfieldIcons.profile;else switch(r.ccType){case"VISA":o=InfieldIcons.visa;break;case"AMEX":o=InfieldIcons.amex;break;case"MC":o=InfieldIcons.mastercard;break;case"DISC":o=InfieldIcons.discover;break;default:o=InfieldIcons.other}else a="icon-site",t&&r.aid&&t[r.aid]?o=t[r.aid]:(o=InfieldIcons.globe,n.sendLpImprove("iconnotfound",{domain:r.tld}));return{normalEl:e("<img/>").attr("src",o).addClass("icon-default "+a)}}(c,a,s),moreText:"sites"===a?i.translateString("More"):i.translateString("Edit"),moreHandler:"sites"===a?null:function(){n.editFormFill(s.ffid)},clickHandler:"sites"===a?function(){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_FILLED),n.fillUsernamePass(s.aid)}:function(){n.fillForm(s.ffid)},lastTile:l});d&&p.push(d)}),p.length>0&&e("#"+o).empty().append(p)}return p.length}}}(jQuery,InfieldCommands,InfieldMenu,Strings),InfieldSearch=function(e){var n,t,i,r,o,a;function s(e,n){var t;return function(){var i=this,r=arguments;clearTimeout(t),t=setTimeout(function(){t=null,e.apply(i,r)},n)}}function c(){t.fadeOut(),n.show(),n.animate({width:"360px"},250,function(){o.show(),r.fadeIn().focus()}),a.addClass("searchBtnActive")}function l(){r.val(""),r.hide(),o.fadeOut(),n.show(),n.animate({width:"16px"},250,function(){i.fadeOut(),t.fadeIn()}),a.removeClass("searchBtnActive")}function d(){n.show()}function p(){r.hide(),i.hide(),o.hide(),n.hide()}return{init:function(d){if(n=e("#searchContainer"),t=e("#currentTab"),i=e("#searchBtnContainer"),r=e("#inlineSearch"),o=e("#searchCloseBtn"),a=e("#searchBtn"),r.hide(),o.hide(),n.show().css({width:"16px"}),i.hide(),t.show(),a.removeClass("searchBtnActive"),e("#searchBtn").click(function(){c()}).keypress(function(){c()}),e("#searchCloseBtn").click(function(){l(),d("")}).keypress(function(){l(),d("")}),d){var p=s(function(n){d(e(n.currentTarget).val())},500);r.keyup(p)}},debounce:s,showIcon:d,hideIcon:p,display:function(e){e&&!0===e?d():p()}}}(jQuery),lpInfield=function(e,n,t,i,r,o,a,s,c){var l,d,p,u=c.translateString("No sites found for this web address. You can log in to this website to save your credentials"),f=c.translateString("No sites found matching your search."),g=c.translateString("No Form Fills saved. You can add one in your Vault."),m=c.translateString("No Form Fills found matching your search.");function h(n){p&&n&&n.position&&e.isNumeric(n.position)&&n.position>10&&n.position<370&&p.show("top",n.position)}function w(e){n.searchVault(e,d.type,v)}function v(e){var n=d.type;if(e){var t=JSON.parse(e);if(t)switch(n){case"sites":r.setup("sitesView",n,t.sites,t.bigicons,b,f);break;case"formfills":r.setup("formFillView",n,t.formfills,null,b,m)}}}function b(n,t){var i=e(".infield-dialog").outerHeight()+20,r=e(".infield-dialog").outerWidth()+10;n&&e.isNumeric(n)&&(i+=n),t&&e.isNumeric(t)&&(r+=t),csTop.LPInfieldFrame.resizeFrame(i,r)}function I(t,s){if(s=!!s,t){d=t;var c=0;if(t.type){switch(t.type){case"sites":if(t.fillData.sites){var p=JSON.parse(t.fillData.sites),f=t.fillData.bigIcons?JSON.parse(t.fillData.bigIcons):null,m=r.setup("sitesView",t.type,p,f,b,u);l.select("sitesView"),i.show("sitesView"),o.display(m>2),a.hide(),c=Object.keys(p).length}break;case"formfills":var h=t.fillData.formFills?JSON.parse(t.fillData.formFills):{};m=r.setup("formFillView",t.type,h,null,b,g);l.select("formFillView"),i.show("formFillView"),o.display(m>2),a.hide(),c=Object.keys(h).length;break;case"generate":n.getGeneratePrefs(a.setup),l.select("generatePassView"),i.show("generatePassView"),o.display(!1),a.show()}s&&n.sendTimingEvent("loadInfield","stop",null,c)}csTop.LPInfieldFrame.positionFrame(function(e){csTop.Topics.publish(Topics.INFIELD_NOTIFICATION_OPENED,e)}),csTop.LPInfieldFrame.show(),e(".infield-dialog").show()}else n.closePopup("close")}return{init:function(){var r=Date.now();document.addEventListener("DOMContentLoaded",function(){!function(e){document.body.style.setProperty("display","none","important");var n=document.createElement("iframe");n.setAttribute("class","backgroundFrame"),n.src="backgroundFrame.html",n.style.display="none",n.addEventListener("load",function(){n.contentWindow.LPPlatform.getBackgroundInterface({mainRequestFramework:!1,interfaceDefinition:Interfaces.InfieldPopupInterface,context:"infieldPopup",callback:function(e){window.bg=e}}),n.contentWindow.Topics.get(n.contentWindow.Topics.REQUEST_FRAMEWORK_INITIALIZED).subscribe(function(n,t){var i=parseInt(n.topFrameID);window.csTop=Interfaces.createInstance(Interfaces.ContentScriptInterface,{direct:!1,context:"infieldPopup",requestFunction:function(e){t.sendRequest({type:"contentScriptRequest",data:e,frameID:i})}}),window.csTop.LPFrame.initializeRequestFramework(LPTools.getURLParams().dialogID,function(n){n&&(document.body.style.removeProperty("display"),e&&e())})})}),document.body.appendChild(n)}(function(){var u;n.sendTimingEvent("loadInfield","start",r),c.translate(document.body),p=new s({$parentEl:e(".infield-dialog")}),h({position:360}),e("#btnClose").click(function(){n.closePopup("close")}),e("#btnClose").keypress(function(){n.closePopup("close")}),i.init(["sitesView","formFillView","generatePassView"]),u=(l=new t("currentTab",null,b)).createMenu("navigation",null,[{id:"sitesView",text:c.translateString("Log in"),selectedText:c.translateString("Log in as"),action:function(){d.type="sites",I(d,!1)}},{id:"formFillView",text:c.translateString("Fill form"),selectedText:c.translateString("Fill form with"),action:function(){d.type="formfills",I(d,!1)}},{id:"generatePassView",text:c.translateString("Generate a password"),selectedText:c.translateString("Generate a password"),action:function(){d.type="generate",I(d,!1)}}]),e("#navigationPlaceholder").append(u),o.init(w),a.init(n,l,b),new MutationObserver(function(){b()}).observe(e(".infield-dialog")[0],{subtree:!0,childList:!0}),n.getInitialData(I),e("#currentTabText").focus()})})},setArrowPosition:h}}(jQuery,InfieldCommands,InfieldMenu,InfieldView,InfieldTiles,InfieldSearch,InfieldGeneratePassword,lpArrow,Strings);lpInfield&&lpInfield.init();
//# sourceMappingURL=sourcemaps/lpInfield.js.map
